=====================================
 Reservations database control panel
=====================================

This test is are adapted from that in plone.app.controlpanel 

First some initial setup code:

    >>> from zope.component import getUtility
    >>> from optilux.cinemacontent.interfaces import IDatabaseSettings
    >>> settings = getUtility(IDatabaseSettings)
    >>> self.loginAsManager()

    >>> settings.driver = 'mysql'
    >>> settings.hostname = 'localhost'
    >>> settings.username = 'root'
    >>> settings.database = 'optilux'

Viewing the reservations database control panel
-----------------------------------------------

    >>> self.browser.open('http://nohost/plone/@@reservations-database-controlpanel')
    >>> self.browser.url
    'http://nohost/plone/@@reservations-database-controlpanel'

Click the save button without making any changes:

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('reservations-database-controlpanel')
    True

We should get a status message:

    >>> 'No changes made.' in self.browser.contents
    True

Now click the cancel button:

    >>> self.browser.getControl(name="form.actions.cancel").click()
    >>> self.browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in self.browser.contents
    True

Make some changes
-----------------

    >>> self.browser.open('http://nohost/plone/@@reservations-database-controlpanel')
    >>> self.browser.url.endswith('reservations-database-controlpanel')
    True

    >>> self.browser.getControl(name='form.drivername').value = 'mysql'
    >>> self.browser.getControl(name='form.hostname').value = 'localhost'
    >>> self.browser.getControl(name='form.port').value = '3306'
    >>> self.browser.getControl(name='form.username').value = 'root'
    >>> self.browser.getControl(name='form.password').value = ''
    >>> self.browser.getControl(name='form.database').value = 'optilux_test'

Click the save button:

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('reservations-database-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in self.browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> settings.drivername
    'mysql'
    >>> settings.hostname
    'localhost'
    >>> settings.port
    3306
    >>> settings.username
    'root'
    >>> settings.password
    >>> settings.database
    'optilux_test'