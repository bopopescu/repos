<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Affymetrix Fusion SDK: C:/Fusion/affy/sdk/file/TsvFile/TsvJoin.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_bf9711affed8fadbfc99a525fa5a7338.html">Fusion</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e3d1e36c55cb197f2802acb5cfa4ef00.html">affy</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_52c1af13ea9e7313b6a8487f1168739d.html">sdk</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e98753d679513daec07063dcab000802.html">file</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da8ac9858cc68ceebb8caafe1448f037.html">TsvFile</a></div>
<h1>TsvJoin.cpp</h1><a href="_tsv_join_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2006 Affymetrix, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This library is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">// it under the terms of the GNU Lesser General Public License </span>
<a name="l00007"></a>00007 <span class="comment">// (version 2.1) as published by the Free Software Foundation.</span>
<a name="l00008"></a>00008 <span class="comment">// </span>
<a name="l00009"></a>00009 <span class="comment">// This library is distributed in the hope that it will be useful, but</span>
<a name="l00010"></a>00010 <span class="comment">// WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00011"></a>00011 <span class="comment">// or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License</span>
<a name="l00012"></a>00012 <span class="comment">// for more details.</span>
<a name="l00013"></a>00013 <span class="comment">// </span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00015"></a>00015 <span class="comment">// along with this library; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00016"></a>00016 <span class="comment">// 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA </span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_tsv_join_8h.html" title="Headers for TsvJoin.cpp.">TsvJoin.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="_guid_8h.html">util/Guid.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_util_8h.html" title="General Utilities.">util/Util.h</a>"</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">using namespace </span>std;
<a name="l00031"></a>00031 <span class="keyword">using namespace </span>affx;
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="_tsv_join_8cpp.html#3ce845b2bb4dbfdb4ecad7af70914b09">00033</a> <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="_dump_pgf_8cpp.html#3ce845b2bb4dbfdb4ecad7af70914b09">usage</a> =
<a name="l00034"></a>00034   <span class="stringliteral">"apt-tsv-join - Merge multiple tab separated text files into a single file.\n"</span>
<a name="l00035"></a>00035   <span class="stringliteral">"Usage:\n"</span>
<a name="l00036"></a>00036   <span class="stringliteral">"   apt-tsv-join -o data.txt -k column-name file1.txt file2.txt [...]"</span>;
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="_tsv_join_8cpp.html#ff2e40673f3ab2e09a8e4898b4596fca">00038</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> <a class="code" href="_tsv_join_8cpp.html#ff2e40673f3ab2e09a8e4898b4596fca">KEY_OPT</a> = {
<a name="l00039"></a>00039   <span class="stringliteral">"k"</span>, <span class="stringliteral">"key"</span>, <a class="code" href="class_pg_options.html#c5eb8c7883596eb79a81aca4892553e435c88827c724ea3751de619b75064c2e">PgOptions::STRING_OPT</a>,
<a name="l00040"></a>00040   <span class="stringliteral">"Name of the column to use to join the various files."</span>,
<a name="l00041"></a>00041   <span class="stringliteral">""</span>, NULL
<a name="l00042"></a>00042 };
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="_tsv_join_8cpp.html#390c104984c4ed8ccea46b362f724032">00044</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> <a class="code" href="_dump_pgf_8cpp.html#390c104984c4ed8ccea46b362f724032">OUTFILE_OPT</a> = {
<a name="l00045"></a>00045   <span class="stringliteral">"o"</span>, <span class="stringliteral">"out-file"</span>, <a class="code" href="class_pg_options.html#c5eb8c7883596eb79a81aca4892553e435c88827c724ea3751de619b75064c2e">PgOptions::STRING_OPT</a>,
<a name="l00046"></a>00046   <span class="stringliteral">"Output file to send the merged results to."</span>,
<a name="l00047"></a>00047   <span class="stringliteral">""</span>, NULL
<a name="l00048"></a>00048 };
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="_tsv_join_8cpp.html#9da7f0cb155304f9398d96c371697cf1">00050</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> <a class="code" href="_tsv_join_8cpp.html#9da7f0cb155304f9398d96c371697cf1">PREPEND_OPT</a> =
<a name="l00051"></a>00051   {
<a name="l00052"></a>00052     <span class="stringliteral">"p"</span>, <span class="stringliteral">"prepend-filename"</span>, <a class="code" href="class_pg_options.html#c5eb8c7883596eb79a81aca4892553e4fbf1c466b06c34435a84d0a298129ec7">PgOptions::BOOL_OPT</a>,
<a name="l00053"></a>00053     <span class="stringliteral">"Prepend the filename to the column header."</span>,
<a name="l00054"></a>00054     <span class="stringliteral">"false"</span>, NULL
<a name="l00055"></a>00055   };
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="_tsv_join_8cpp.html#ee30aa3f77c859209baede70342e44d7">00057</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> <a class="code" href="_dump_pgf_8cpp.html#ee30aa3f77c859209baede70342e44d7">VERSION_OPT</a> = {
<a name="l00058"></a>00058   <span class="stringliteral">""</span>, <span class="stringliteral">"version"</span>, <a class="code" href="class_pg_options.html#c5eb8c7883596eb79a81aca4892553e4fbf1c466b06c34435a84d0a298129ec7">PgOptions::BOOL_OPT</a>,
<a name="l00059"></a>00059   <span class="stringliteral">"Display version information."</span>,
<a name="l00060"></a>00060   <span class="stringliteral">"false"</span>, NULL
<a name="l00061"></a>00061 };
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="_tsv_join_8cpp.html#9d2d6a00b2a9ab067baf1470475c3f0f">00063</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> <a class="code" href="_dump_pgf_8cpp.html#9d2d6a00b2a9ab067baf1470475c3f0f">HELP_OPT</a> =
<a name="l00064"></a>00064   {
<a name="l00065"></a>00065     <span class="stringliteral">"h"</span>, <span class="stringliteral">"help"</span>, <a class="code" href="class_pg_options.html#c5eb8c7883596eb79a81aca4892553e4fbf1c466b06c34435a84d0a298129ec7">PgOptions::BOOL_OPT</a>,
<a name="l00066"></a>00066     <span class="stringliteral">"Print help message."</span>,
<a name="l00067"></a>00067     <span class="stringliteral">"false"</span>, NULL
<a name="l00068"></a>00068   };
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="_tsv_join_8cpp.html#bde4aa6d93630934cfcaa4b4145fae34">00070</a> <span class="keyword">static</span> <a class="code" href="class_pg_options_1_1_pg_opt.html" title="Individual option that can be specifed on command line.">PgOptions::PgOpt</a> *<a class="code" href="_dump_pgf_8cpp.html#bde4aa6d93630934cfcaa4b4145fae34">options</a>[] = {
<a name="l00071"></a>00071   &amp;<a class="code" href="_tsv_join_8cpp.html#ff2e40673f3ab2e09a8e4898b4596fca">KEY_OPT</a>,
<a name="l00072"></a>00072   &amp;<a class="code" href="_dump_pgf_8cpp.html#390c104984c4ed8ccea46b362f724032">OUTFILE_OPT</a>,
<a name="l00073"></a>00073   &amp;<a class="code" href="_tsv_join_8cpp.html#9da7f0cb155304f9398d96c371697cf1">PREPEND_OPT</a>,
<a name="l00074"></a>00074   &amp;<a class="code" href="_dump_pgf_8cpp.html#ee30aa3f77c859209baede70342e44d7">VERSION_OPT</a>,
<a name="l00075"></a>00075   &amp;<a class="code" href="_dump_pgf_8cpp.html#9d2d6a00b2a9ab067baf1470475c3f0f">HELP_OPT</a>,
<a name="l00076"></a>00076   NULL
<a name="l00077"></a>00077 };
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00090"></a><a class="code" href="classtsv_join.html#5967954fc348734ee13838e866c09651">00090</a> <a class="code" href="classtsv_join.html#5967954fc348734ee13838e866c09651" title="Constructor.">tsvJoin::tsvJoin</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[], <span class="keyword">const</span> std::string&amp; version, <span class="keyword">const</span> std::string&amp; cvsId)
<a name="l00091"></a>00091   : m_Version (version), m_CvsId (cvsId),
<a name="l00092"></a>00092   m_CommentLine (<span class="stringliteral">"############################################################\n"</span>)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">// Prefer throw() to exit().</span>
<a name="l00096"></a>00096   <a class="code" href="class_err.html#1ecad8c0ca7179708caa761441f9ca4b">Err::setThrowStatus</a> (<span class="keyword">true</span>);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <a class="code" href="class_pg_options.html#db39b1c1d10375a15a4d0eb3bf00f937">PgOptions::hack_resetOptionsList</a>(<a class="code" href="_dump_pgf_8cpp.html#bde4aa6d93630934cfcaa4b4145fae34">options</a>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a> = <span class="keyword">new</span> <a class="code" href="class_pg_options.html" title="Holds all command line arguments, parses options and keeps arguments.">PgOptions</a> (<a class="code" href="_dump_pgf_8cpp.html#3ce845b2bb4dbfdb4ecad7af70914b09">usage</a>, <a class="code" href="_dump_pgf_8cpp.html#bde4aa6d93630934cfcaa4b4145fae34">options</a>);
<a name="l00101"></a>00101   <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#160163a9c5959055d8066d5ae7cbdd88">parseOptions</a> (argc, argv);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="comment">// Optionally display usage message.</span>
<a name="l00104"></a>00104   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#4faecb19647227dd27e11f83b11de18a">boolOpt</a> (<span class="stringliteral">"help"</span>) || argc == 1)
<a name="l00105"></a>00105   {
<a name="l00106"></a>00106     <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#da18bd8d5b64cf07665e679cc85875c0">usage</a>();
<a name="l00107"></a>00107     <span class="keywordtype">string</span> msg = <span class="stringliteral">"version:\n"</span>;
<a name="l00108"></a>00108     msg += <span class="stringliteral">"   "</span> + version + <span class="stringliteral">"\n"</span>;
<a name="l00109"></a>00109     msg += <span class="stringliteral">"   "</span> + cvsId;
<a name="l00110"></a>00110     cout &lt;&lt; msg;
<a name="l00111"></a>00111     exit(0);
<a name="l00112"></a>00112   }
<a name="l00113"></a>00113   <span class="comment">// Optionally display version.</span>
<a name="l00114"></a>00114   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#4faecb19647227dd27e11f83b11de18a">boolOpt</a> (<span class="stringliteral">"version"</span>))
<a name="l00115"></a>00115   {
<a name="l00116"></a>00116     <span class="keywordtype">string</span> msg = <span class="stringliteral">"version: "</span> + version + <span class="stringliteral">"   "</span> + cvsId;
<a name="l00117"></a>00117     cout &lt;&lt; msg;
<a name="l00118"></a>00118     exit(0);
<a name="l00119"></a>00119   }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="comment">// Require key.</span>
<a name="l00122"></a>00122   <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a> = <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#98e863ac9b92ec47e8260c75d41fccaa">strOpt</a> (<span class="stringliteral">"key"</span>);
<a name="l00123"></a>00123   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>.empty())
<a name="l00124"></a>00124   {
<a name="l00125"></a>00125     <span class="keywordtype">string</span> msg = <span class="stringliteral">"FATAL: Must provide --key option."</span>;
<a name="l00126"></a>00126     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (msg);
<a name="l00127"></a>00127   }
<a name="l00128"></a>00128   <span class="comment">// Require at least two input files.</span>
<a name="l00129"></a>00129   <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> = (<span class="keywordtype">unsigned</span> int)<a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#6eca55587cbb88b628d7d10c3c0bb32b">getNumArgs</a>();
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> &lt; 2)
<a name="l00131"></a>00131   {
<a name="l00132"></a>00132     <span class="keywordtype">string</span> msg = <span class="stringliteral">"FATAL: Must provide 2 or more files to merge."</span>;
<a name="l00133"></a>00133     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (msg);
<a name="l00134"></a>00134   }
<a name="l00135"></a>00135   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a>; ++i)
<a name="l00136"></a>00136     <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>.push_back (string (<a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#5061ce9cc7b4d687856ceee3cbad2dff">getArg</a>(i)));
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="comment">// Require writeable output file.</span>
<a name="l00139"></a>00139   <a class="code" href="classtsv_join.html#c64ac1ea5ac3e1d97f901fa53704d6d5" title="Output file name.">m_Outfile</a> = <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#98e863ac9b92ec47e8260c75d41fccaa">strOpt</a> (<span class="stringliteral">"out-file"</span>);
<a name="l00140"></a>00140   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#c64ac1ea5ac3e1d97f901fa53704d6d5" title="Output file name.">m_Outfile</a>.empty())
<a name="l00141"></a>00141   {
<a name="l00142"></a>00142     <span class="keywordtype">string</span> msg = <span class="stringliteral">"FATAL: Must provide -out-file output file."</span>;
<a name="l00143"></a>00143     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (msg);
<a name="l00144"></a>00144   }
<a name="l00145"></a>00145   <span class="keywordflow">else</span>
<a name="l00146"></a>00146     <a class="code" href="class_util.html#be89fde973f382c16c3fccd1b0080019">Util::mustOpenToWrite</a> (<a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a>, <a class="code" href="classtsv_join.html#c64ac1ea5ac3e1d97f901fa53704d6d5" title="Output file name.">m_Outfile</a>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">// Save prepend status.</span>
<a name="l00149"></a>00149   <a class="code" href="classtsv_join.html#1d246c997da662c7a175230d35916202" title="Should filenames be prepended?">m_Prepend</a> = <a class="code" href="classtsv_join.html#2559030f01337dc3906f20c097492d2e" title="Command line options.">m_Opts</a>-&gt;<a class="code" href="class_pg_options.html#4faecb19647227dd27e11f83b11de18a">boolOpt</a> (<span class="stringliteral">"prepend-filename"</span>);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <span class="comment">// The command line is copied to the output file header.</span>
<a name="l00152"></a>00152   assert (argc &gt; 0);
<a name="l00153"></a>00153   <a class="code" href="classtsv_join.html#2dd99afbdd9f30d192fac80570a24cbb" title="Command line as a string.">m_CommandLine</a> = argv [0];
<a name="l00154"></a>00154   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i)
<a name="l00155"></a>00155     <a class="code" href="classtsv_join.html#2dd99afbdd9f30d192fac80570a24cbb" title="Command line as a string.">m_CommandLine</a> += <span class="stringliteral">" "</span> + <span class="keywordtype">string</span> (argv [i]);
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00163"></a><a class="code" href="classtsv_join.html#3fa7930803fe74052b7efc6f9c70d1df">00163</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#3fa7930803fe74052b7efc6f9c70d1df" title="Read, process data, write output.">tsvJoin::run</a> (<span class="keywordtype">void</span>)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165   <span class="comment">// Write initial output.</span>
<a name="l00166"></a>00166   <a class="code" href="classtsv_join.html#d620fcd0025d65a04bd234e0318e7650" title="Begin output.">beginOutput</a>();
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="comment">// Open input files.</span>
<a name="l00169"></a>00169   <a class="code" href="classtsv_join.html#17e2f04018c31f1804f1b3ee8255c6b3" title="Open input files.">openInputFiles</a>();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="comment">// Generate initial output header lines.</span>
<a name="l00172"></a>00172   <a class="code" href="classtsv_join.html#30f1146ffd0208134e7728164527c608" title="Begin output file header.">beginOutputHeader</a>();
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="comment">// Write file specific header lines.</span>
<a name="l00175"></a>00175   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;
<a name="l00176"></a>00176   <a class="code" href="classtsv_join.html#8947507dfb669427fa0b70e7b78cce04" title="Write header lines copied from input file.">writeHeadersFromFile</a> (<a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>, idx, <a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>);
<a name="l00177"></a>00177   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> - 1; ++idx)
<a name="l00178"></a>00178     <a class="code" href="classtsv_join.html#8947507dfb669427fa0b70e7b78cce04" title="Write header lines copied from input file.">writeHeadersFromFile</a> (*<a class="code" href="classtsv_join.html#8ef9ee6fc0d562ffca55884a09227b32" title="Index mode input file tsv objects.">m_IndexTsvs</a>[idx], idx + 1, <a class="code" href="classtsv_join.html#b0faf12bceb0286ae879325663c826a7" title="Index mode input file column names.">m_IndexColNames</a>[idx]);
<a name="l00179"></a>00179   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#5efb00078ac5f1403a0f793045897bd9" title="Output section separator.">m_CommentLine</a>;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="comment">// Write matching lines.</span>
<a name="l00182"></a>00182   <a class="code" href="classtsv_join.html#3e873462303a9af1b55cd223b6bca6af" title="Write matching lines.">writeMatches</a>();
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">// Close output file.</span>
<a name="l00185"></a>00185   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a>.close();
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00191"></a><a class="code" href="classtsv_join.html#d620fcd0025d65a04bd234e0318e7650">00191</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#d620fcd0025d65a04bd234e0318e7650" title="Begin output.">tsvJoin::beginOutput</a> (<span class="keywordtype">void</span>)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"MODULE: "</span> + <a class="code" href="classtsv_join.html#b71d961d3bb7ecb6960d8c6d8b456c43">m_Version</a> + <span class="stringliteral">" "</span> + <a class="code" href="classtsv_join.html#30b8dbf6c7fcab5a40d9a186a6a04667" title="CVS id string.">m_CvsId</a>);
<a name="l00194"></a>00194   <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"CMD: "</span> + <a class="code" href="classtsv_join.html#2dd99afbdd9f30d192fac80570a24cbb" title="Command line as a string.">m_CommandLine</a>);
<a name="l00195"></a>00195   <a class="code" href="classtsv_join.html#66d0abde26a7780781b129e9eb1866c8" title="Execution guid.">m_ExecGuid</a> = <a class="code" href="classaffxutil_1_1_guid.html#2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>();
<a name="l00196"></a>00196   <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"exec_guid "</span> + <a class="code" href="classtsv_join.html#66d0abde26a7780781b129e9eb1866c8" title="Execution guid.">m_ExecGuid</a>);
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00205"></a><a class="code" href="classtsv_join.html#17e2f04018c31f1804f1b3ee8255c6b3">00205</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#17e2f04018c31f1804f1b3ee8255c6b3" title="Open input files.">tsvJoin::openInputFiles</a> (<span class="keywordtype">void</span>)
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207   <span class="keywordtype">string</span>&amp; streamFileName = <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[0];
<a name="l00208"></a>00208   <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"Opening stream file "</span> + streamFileName + <span class="stringliteral">"."</span>);
<a name="l00209"></a>00209   <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">open</a> (streamFileName) != <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00210"></a>00210     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Problem opening file "</span> + streamFileName);
<a name="l00211"></a>00211   <span class="comment">// Allow comment lines within data.</span>
<a name="l00212"></a>00212   <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#fd8c4cd62d243dbc8dd6ac152fec7d65" title="Options which can be set. allow comments mixed in with data?">m_optAllowDataComment</a> = <span class="keyword">true</span>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="keywordtype">bool</span> foundKey = <span class="keyword">false</span>;
<a name="l00215"></a>00215   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> colCount = <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(0);
<a name="l00216"></a>00216   <a class="code" href="classtsv_join.html#afabe2ced91328ac29f6fe62cc6712be" title="Number of data columns in stream file.">m_StreamDataColCount</a> = colCount - 1;
<a name="l00217"></a>00217   <a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>.resize (colCount);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; colCount; ++i)
<a name="l00220"></a>00220   {
<a name="l00221"></a>00221     <span class="keywordtype">string</span> colName;
<a name="l00222"></a>00222     <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b" title="Get the name of a column by its level and index.">cidx2cname</a> (0, i, colName);
<a name="l00223"></a>00223     <a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>[i] = colName;
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (colName == <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>)
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226       <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#578b02d3fde0c3b4dca497a600a6bbe6">bind</a> (0, i, &amp;<a class="code" href="classtsv_join.html#3c67934fcb228454ef453170d487e103" title="Stream mode input file key value for row.">m_StreamKeyValue</a>);
<a name="l00227"></a>00227       foundKey = <span class="keyword">true</span>;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230   <span class="comment">// Abort if key not found.</span>
<a name="l00231"></a>00231   <span class="keywordflow">if</span> (! foundKey)
<a name="l00232"></a>00232     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Key "</span> + <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a> + <span class="stringliteral">" not found in file "</span> + streamFileName);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="comment">// Bind to data vector after checking column names - binds must follow</span>
<a name="l00235"></a>00235   <span class="comment">// resize(), which may trigger reallocation, which would invalidate the</span>
<a name="l00236"></a>00236   <span class="comment">// addresses passed in the bind.</span>
<a name="l00237"></a>00237   <a class="code" href="classtsv_join.html#ff244fcfc16963fb26ae4f36132299db" title="Stream mode input file data values for row.">m_StreamData</a>.resize (colCount - 1);
<a name="l00238"></a>00238   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0;
<a name="l00239"></a>00239   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; colCount; ++i)
<a name="l00240"></a>00240   {
<a name="l00241"></a>00241     <span class="keywordtype">string</span> colName;
<a name="l00242"></a>00242     <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b" title="Get the name of a column by its level and index.">cidx2cname</a> (0, i, colName);
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (colName != <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>)
<a name="l00244"></a>00244       <a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#578b02d3fde0c3b4dca497a600a6bbe6">bind</a> (0, i, &amp;<a class="code" href="classtsv_join.html#ff244fcfc16963fb26ae4f36132299db" title="Stream mode input file data values for row.">m_StreamData</a>[k++]);
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="comment">// Required in the constructor that at least two input file names were provided.</span>
<a name="l00248"></a>00248   assert (<a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> &gt; 1);
<a name="l00249"></a>00249   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> - 1; ++i)
<a name="l00250"></a>00250   {
<a name="l00251"></a>00251     <span class="keywordtype">string</span>&amp; indexFileName = <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[i + 1];
<a name="l00252"></a>00252     <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"Opening file "</span> + indexFileName + <span class="stringliteral">" for indexing."</span>);
<a name="l00253"></a>00253     <a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">TsvFile</a>* indexTsv = <span class="keyword">new</span> <a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">TsvFile</a>;
<a name="l00254"></a>00254     <span class="keywordflow">if</span> (indexTsv-&gt;<a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">open</a> (indexFileName) != <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00255"></a>00255       <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Problem opening file "</span> + indexFileName);
<a name="l00256"></a>00256     indexTsv-&gt;<a class="code" href="classaffx_1_1_tsv_file.html#fd8c4cd62d243dbc8dd6ac152fec7d65" title="Options which can be set. allow comments mixed in with data?">m_optAllowDataComment</a> = <span class="keyword">true</span>;
<a name="l00257"></a>00257     <a class="code" href="classtsv_join.html#8ef9ee6fc0d562ffca55884a09227b32" title="Index mode input file tsv objects.">m_IndexTsvs</a>.push_back (indexTsv);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     colCount = indexTsv-&gt;<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(0);
<a name="l00260"></a>00260     <a class="code" href="classtsv_join.html#b0faf12bceb0286ae879325663c826a7" title="Index mode input file column names.">m_IndexColNames</a>.push_back (vector&lt;string&gt; (colCount));
<a name="l00261"></a>00261     <a class="code" href="classtsv_join.html#8cae80f3f3089ce74a731b7e1f948477" title="Index mode input file data values.">m_IndexData</a>.push_back (vector&lt;string&gt; (colCount - 1));
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     foundKey = <span class="keyword">false</span>;
<a name="l00264"></a>00264     k = 0;
<a name="l00265"></a>00265     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; colCount; ++j)
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267       <span class="keywordtype">string</span> colName;
<a name="l00268"></a>00268       indexTsv-&gt;<a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b" title="Get the name of a column by its level and index.">cidx2cname</a> (0, j, colName);
<a name="l00269"></a>00269       <a class="code" href="classtsv_join.html#b0faf12bceb0286ae879325663c826a7" title="Index mode input file column names.">m_IndexColNames</a>[i][j] = colName;
<a name="l00270"></a>00270       <span class="keywordflow">if</span> (colName == <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>)
<a name="l00271"></a>00271         foundKey = <span class="keyword">true</span>;
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273     <span class="keywordflow">if</span> (! foundKey)
<a name="l00274"></a>00274       <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Key "</span> + <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a> + <span class="stringliteral">" not found in file "</span> + indexFileName);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="comment">// Set up index.</span>
<a name="l00277"></a>00277     indexTsv-&gt;<a class="code" href="classaffx_1_1_tsv_file.html#bc70cebd4314ec2e324179b5cf08e365" title="Creates an index object.">defineIndex</a> (0, <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>, <a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde0752a4477d57a28231801839cff95671">TSV_INDEX_STRING</a>, 0);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     <span class="comment">// Remember the number of data columns.</span>
<a name="l00280"></a>00280     <a class="code" href="classtsv_join.html#708cafd6d30e9f6151e5f8912c9dceb4" title="Number of data columns in index files.">m_IndexDataColCount</a>.push_back (colCount - 1);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   }  <span class="comment">// end for (unsigned int i = 0; i &lt; m_FileCount - 1; ++i)</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <span class="comment">// Bind to the data vectors after setting up them up: push_back()</span>
<a name="l00285"></a>00285   <span class="comment">// and resize() may cause reallocation, which will change the addresses.</span>
<a name="l00286"></a>00286   <a class="code" href="classtsv_join.html#75b8a02a049ded644b9b9facada54172" title="Index mode input file key values.">m_IndexKeyValues</a>.resize (m_FileCount - 1);
<a name="l00287"></a>00287   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; m_FileCount - 1; ++i)
<a name="l00288"></a>00288   {
<a name="l00289"></a>00289     <a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">TsvFile</a>* indexTsv = <a class="code" href="classtsv_join.html#8ef9ee6fc0d562ffca55884a09227b32" title="Index mode input file tsv objects.">m_IndexTsvs</a>[i];
<a name="l00290"></a>00290     k = 0;
<a name="l00291"></a>00291     <span class="comment">// Add one since had stored number of data columns.</span>
<a name="l00292"></a>00292     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> colCount = <a class="code" href="classtsv_join.html#708cafd6d30e9f6151e5f8912c9dceb4" title="Number of data columns in index files.">m_IndexDataColCount</a>[i] + 1;
<a name="l00293"></a>00293     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; colCount; ++j)
<a name="l00294"></a>00294     {
<a name="l00295"></a>00295       <span class="keywordtype">string</span> colName;
<a name="l00296"></a>00296       indexTsv-&gt;cidx2cname (0, j, colName);
<a name="l00297"></a>00297       <span class="keywordflow">if</span> (colName == <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>)
<a name="l00298"></a>00298         indexTsv-&gt;bind (0, j, &amp;<a class="code" href="classtsv_join.html#75b8a02a049ded644b9b9facada54172" title="Index mode input file key values.">m_IndexKeyValues</a>[i]);
<a name="l00299"></a>00299       <span class="keywordflow">else</span>
<a name="l00300"></a>00300         indexTsv-&gt;bind (0, j, &amp;<a class="code" href="classtsv_join.html#8cae80f3f3089ce74a731b7e1f948477" title="Index mode input file data values.">m_IndexData</a>[i][k++]);
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00308"></a><a class="code" href="classtsv_join.html#30f1146ffd0208134e7728164527c608">00308</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#30f1146ffd0208134e7728164527c608" title="Begin output file header.">tsvJoin::beginOutputHeader</a> (<span class="keywordtype">void</span>)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310   <span class="keyword">const</span> <span class="keywordtype">string</span> guid = <a class="code" href="classaffxutil_1_1_guid.html#2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>();
<a name="l00311"></a>00311   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"#%guid="</span> &lt;&lt; guid &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00312"></a>00312   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"#%exec_guid="</span> &lt;&lt; <a class="code" href="classtsv_join.html#66d0abde26a7780781b129e9eb1866c8" title="Execution guid.">m_ExecGuid</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00313"></a>00313   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"#%exec_version="</span> &lt;&lt; <a class="code" href="classtsv_join.html#b71d961d3bb7ecb6960d8c6d8b456c43">m_Version</a> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classtsv_join.html#30b8dbf6c7fcab5a40d9a186a6a04667" title="CVS id string.">m_CvsId</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00314"></a>00314   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"#%create_date="</span> &lt;&lt; <a class="code" href="class_util.html#ccf4f30492f3726aac3197a37b3f77cc">Util::getTimeStamp</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00315"></a>00315   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"#%cmd="</span> &lt;&lt; <a class="code" href="classtsv_join.html#2dd99afbdd9f30d192fac80570a24cbb" title="Command line as a string.">m_CommandLine</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00321"></a><a class="code" href="classtsv_join.html#8947507dfb669427fa0b70e7b78cce04">00321</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#8947507dfb669427fa0b70e7b78cce04" title="Write header lines copied from input file.">tsvJoin::writeHeadersFromFile</a> (<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">TsvFile</a>&amp; tsv, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx,
<a name="l00322"></a>00322                                     std::vector&lt;std::string&gt;&amp; columnNames)
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#5efb00078ac5f1403a0f793045897bd9" title="Output section separator.">m_CommentLine</a>;
<a name="l00325"></a>00325   <a class="code" href="classtsv_join.html#339310966c5225b1b9082b71175cd974">headerLine</a> (idx);
<a name="l00326"></a>00326   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"name="</span> &lt;&lt; <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[idx] &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00327"></a>00327   <a class="code" href="classtsv_join.html#339310966c5225b1b9082b71175cd974">headerLine</a> (idx);
<a name="l00328"></a>00328   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"cols="</span>;
<a name="l00329"></a>00329   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> colCount = columnNames.size();
<a name="l00330"></a>00330   <span class="comment">// Need the key column at least.</span>
<a name="l00331"></a>00331   assert (colCount &gt; 0);
<a name="l00332"></a>00332   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; columnNames[0];
<a name="l00333"></a>00333   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; colCount; ++i)
<a name="l00334"></a>00334     <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; columnNames[i];
<a name="l00335"></a>00335   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="comment">// Finished with the key column name - delete it.</span>
<a name="l00338"></a>00338   columnNames.erase (<span class="keyword">remove</span> (columnNames.begin(), columnNames.end(), <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>), columnNames.end());
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">// Copy file header meta tags to output.</span>
<a name="l00341"></a>00341   <span class="keywordtype">string</span> key, value;
<a name="l00342"></a>00342   tsv.<a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b" title="Start at the beginning of the headers.">headersBegin</a>();
<a name="l00343"></a>00343   <span class="keywordflow">while</span> (tsv.<a class="code" href="classaffx_1_1_tsv_file.html#86c80445dd06ed593e194f85e8ad8946" title="Advance to the next header of the file and set the values.">headersNext</a> (key, value) == <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00344"></a>00344     <span class="comment">// Comment lines among the headers give rise to a pair with a null key.</span>
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (! key.empty())
<a name="l00346"></a>00346     {
<a name="l00347"></a>00347       <a class="code" href="classtsv_join.html#339310966c5225b1b9082b71175cd974">headerLine</a> (idx);
<a name="l00348"></a>00348       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; key &lt;&lt; <span class="stringliteral">"="</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00355"></a><a class="code" href="classtsv_join.html#6922f45771e136093b3f8e7371f06cea">00355</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#6922f45771e136093b3f8e7371f06cea" title="Write output column names.">tsvJoin::writeColumnNames</a> (<span class="keywordtype">void</span>)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <span class="comment">// Key first.</span>
<a name="l00358"></a>00358   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="comment">// Remaining columns of the stream file.</span>
<a name="l00361"></a>00361   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> streamColCount = <a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>.size();
<a name="l00362"></a>00362   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; streamColCount; ++i)
<a name="l00363"></a>00363     <span class="comment">// Write key only once.</span>
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>[i] != m_Key)
<a name="l00365"></a>00365     {
<a name="l00366"></a>00366       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\t"</span>;
<a name="l00367"></a>00367       <span class="comment">// Prepend file name if requested.</span>
<a name="l00368"></a>00368       <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#1d246c997da662c7a175230d35916202" title="Should filenames be prepended?">m_Prepend</a>)
<a name="l00369"></a>00369         <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[0] &lt;&lt; <span class="stringliteral">": "</span>;
<a name="l00370"></a>00370       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#71a7c7272f315b81afe421de58365cea" title="Stream mode input file column names.">m_StreamColNames</a>[i];
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="comment">// Remaining columns of index files.</span>
<a name="l00374"></a>00374   <span class="comment">// The key column name has already been deleted, in writeHeadersFromFile().</span>
<a name="l00375"></a>00375   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0; idx &lt; <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> - 1; ++idx)
<a name="l00376"></a>00376   {
<a name="l00377"></a>00377     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexColCount = <a class="code" href="classtsv_join.html#b0faf12bceb0286ae879325663c826a7" title="Index mode input file column names.">m_IndexColNames</a>[idx].size();
<a name="l00378"></a>00378     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; indexColCount; ++i)
<a name="l00379"></a>00379     {
<a name="l00380"></a>00380       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\t"</span>;
<a name="l00381"></a>00381       <span class="keywordflow">if</span> (<a class="code" href="classtsv_join.html#1d246c997da662c7a175230d35916202" title="Should filenames be prepended?">m_Prepend</a>)
<a name="l00382"></a>00382         <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[idx + 1] &lt;&lt; <span class="stringliteral">": "</span>;
<a name="l00383"></a>00383       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#b0faf12bceb0286ae879325663c826a7" title="Index mode input file column names.">m_IndexColNames</a>[idx][i];
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386   <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 
<a name="l00392"></a><a class="code" href="classtsv_join.html#3e873462303a9af1b55cd223b6bca6af">00392</a> <span class="keywordtype">void</span> <a class="code" href="classtsv_join.html#3e873462303a9af1b55cd223b6bca6af" title="Write matching lines.">tsvJoin::writeMatches</a> (<span class="keywordtype">void</span>)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a> (1, <span class="stringliteral">"Done indexing files. Generating merged file."</span>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396   <span class="comment">// Write column names only if find at least one match.</span>
<a name="l00397"></a>00397   <span class="keywordtype">bool</span> columnNamesWritten = <span class="keyword">false</span>;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   <span class="comment">// Read stream file.</span>
<a name="l00400"></a>00400   <span class="keywordflow">while</span> (<a class="code" href="classtsv_join.html#def8a8bdf9af5d6f50a6476592ffbd50" title="Stream mode input file tsv object.">m_StreamTsv</a>.<a class="code" href="classaffx_1_1_tsv_file.html#2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl.">nextLevel</a> (0) == <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00401"></a>00401   {
<a name="l00402"></a>00402     <span class="keywordtype">bool</span> foundMatch = <span class="keyword">false</span>;
<a name="l00403"></a>00403     <span class="comment">// Look for matches in each index file.</span>
<a name="l00404"></a>00404     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0; idx &lt; <a class="code" href="classtsv_join.html#d69e08e52de7ed0aeed44c0c2837aa4e" title="Number of input files.">m_FileCount</a> - 1; ++idx)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406       <a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">TsvFile</a>* indexTsv = <a class="code" href="classtsv_join.html#8ef9ee6fc0d562ffca55884a09227b32" title="Index mode input file tsv objects.">m_IndexTsvs</a>[idx];
<a name="l00407"></a>00407       <span class="keywordflow">if</span> (indexTsv-&gt;findBegin (0, <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a>, <a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe3c186fb0fb46b08561498444e7cafe097">TSV_OP_EQ</a>, <a class="code" href="classtsv_join.html#3c67934fcb228454ef453170d487e103" title="Stream mode input file key value for row.">m_StreamKeyValue</a>) != <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00408"></a>00408         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Problem reading index file "</span> + <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[idx + 1]);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410       <span class="keyword">const</span> <span class="keywordtype">int</span> resultCount = indexTsv-&gt;findResultsCount();
<a name="l00411"></a>00411       <span class="comment">// Require a match in all index files.</span>
<a name="l00412"></a>00412       <span class="keywordflow">if</span> (resultCount == 0)
<a name="l00413"></a>00413       {
<a name="l00414"></a>00414         foundMatch = <span class="keyword">false</span>;
<a name="l00415"></a>00415         <span class="keywordflow">break</span>;
<a name="l00416"></a>00416       }
<a name="l00417"></a>00417       <span class="comment">// Fatal error if more than one match was found.</span>
<a name="l00418"></a>00418       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resultCount &gt; 1)
<a name="l00419"></a>00419       {
<a name="l00420"></a>00420         <span class="keywordtype">string</span> msg = <span class="stringliteral">"FATAL: key '"</span> + <a class="code" href="classtsv_join.html#f7acea0e4a3bd115817562f4134ce426" title="Key.">m_Key</a> + <span class="stringliteral">"' is not a unique index. Duplicate key found, ["</span>;
<a name="l00421"></a>00421         msg += <a class="code" href="classtsv_join.html#3c67934fcb228454ef453170d487e103" title="Stream mode input file key value for row.">m_StreamKeyValue</a> + <span class="stringliteral">"] for file "</span> + <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[idx + 1] + <span class="stringliteral">"."</span>;
<a name="l00422"></a>00422         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (msg);
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424       <span class="comment">// Found one match - read data</span>
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (indexTsv-&gt;findNext() != <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)
<a name="l00426"></a>00426         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a> (<span class="stringliteral">"Problem reading index file "</span> + <a class="code" href="classtsv_join.html#a3ec9bba53cf90d0f7f64a56a1f5ea2e" title="Input file names.">m_FileNames</a>[idx + 1]);
<a name="l00427"></a>00427       foundMatch = <span class="keyword">true</span>;
<a name="l00428"></a>00428     } <span class="comment">// end for (unsigned int idx = 0; idx &lt; m_FileCount - 1; ++idx)</span>
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (foundMatch)
<a name="l00431"></a>00431     {
<a name="l00432"></a>00432       <span class="comment">// Found match - write column names once.</span>
<a name="l00433"></a>00433       <span class="keywordflow">if</span> (! columnNamesWritten)
<a name="l00434"></a>00434       {
<a name="l00435"></a>00435         <a class="code" href="classtsv_join.html#6922f45771e136093b3f8e7371f06cea" title="Write output column names.">writeColumnNames</a>();
<a name="l00436"></a>00436         columnNamesWritten = <span class="keyword">true</span>;
<a name="l00437"></a>00437       }
<a name="l00438"></a>00438       <span class="comment">// Write key.</span>
<a name="l00439"></a>00439       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <a class="code" href="classtsv_join.html#3c67934fcb228454ef453170d487e103" title="Stream mode input file key value for row.">m_StreamKeyValue</a>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       <span class="comment">// Write columns from stream file.</span>
<a name="l00442"></a>00442       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtsv_join.html#afabe2ced91328ac29f6fe62cc6712be" title="Number of data columns in stream file.">m_StreamDataColCount</a>; ++i)
<a name="l00443"></a>00443         <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; <a class="code" href="classtsv_join.html#ff244fcfc16963fb26ae4f36132299db" title="Stream mode input file data values for row.">m_StreamData</a>[i];
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       <span class="comment">// Write columns from index files.</span>
<a name="l00446"></a>00446       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0; idx &lt; m_FileCount - 1; ++idx)
<a name="l00447"></a>00447       {
<a name="l00448"></a>00448         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtsv_join.html#708cafd6d30e9f6151e5f8912c9dceb4" title="Number of data columns in index files.">m_IndexDataColCount</a>[idx]; ++i)
<a name="l00449"></a>00449           <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; <a class="code" href="classtsv_join.html#8cae80f3f3089ce74a731b7e1f948477" title="Index mode input file data values.">m_IndexData</a>[idx][i];
<a name="l00450"></a>00450       }
<a name="l00451"></a>00451       <a class="code" href="classtsv_join.html#35304f6edb0e5f41fee697d67bafcd6c" title="Output file stream.">m_Out</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00452"></a>00452     } <span class="comment">// end if (foundMatch)</span>
<a name="l00453"></a>00453   } <span class="comment">// end while (m_StreamTsv.nextLevel (0) == TSV_OK)</span>
<a name="l00454"></a>00454 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 14 09:01:16 2007 for Affymetrix Fusion SDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
