<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Affymetrix Fusion SDK: C:/Fusion/affy/sdk/file/TsvFile/TsvFile.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_bf9711affed8fadbfc99a525fa5a7338.html">Fusion</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e3d1e36c55cb197f2802acb5cfa4ef00.html">affy</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_52c1af13ea9e7313b6a8487f1168739d.html">sdk</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e98753d679513daec07063dcab000802.html">file</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da8ac9858cc68ceebb8caafe1448f037.html">TsvFile</a></div>
<h1>TsvFile.cpp</h1><a href="_tsv_file_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2005 Affymetrix, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This library is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">// it under the terms of the GNU Lesser General Public License</span>
<a name="l00007"></a>00007 <span class="comment">// (version 2.1) as published by the Free Software Foundation.</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// This library is distributed in the hope that it will be useful, but</span>
<a name="l00010"></a>00010 <span class="comment">// WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00011"></a>00011 <span class="comment">// or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License</span>
<a name="l00012"></a>00012 <span class="comment">// for more details.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00015"></a>00015 <span class="comment">// along with this library; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00016"></a>00016 <span class="comment">// 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00030"></a>00030 <span class="comment">//</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_convert_8h.html" title="Utility functions for converting between types.">util/Convert.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_err_8h.html" title="Some utility error functions, currently prints message and aborts().">util/Err.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="_verbose_8h.html" title="Class for doing logging and some command line ui.">util/Verbose.h</a>"</span>
<a name="l00034"></a>00034 <span class="comment">//</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="_tsv_file_8h.html" title="Headers for the TsvFile classes. Read the TsvFile format  for an overview.">file/TsvFile/TsvFile.h</a>"</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">//</span>
<a name="l00038"></a>00038 <span class="keyword">using namespace </span>std;
<a name="l00039"></a>00039 <span class="keyword">using namespace </span>affx;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">// macros for TSV_ERR_AT stringification.</span>
<a name="l00042"></a><a class="code" href="_tsv_file_8cpp.html#34da4220cf3b66ee80e2e80f9e2ad12a">00042</a> <span class="preprocessor">#define TSV_STRINGIFY(str) #str</span>
<a name="l00043"></a><a class="code" href="_tsv_file_8cpp.html#030db339a6e6f0d546828f568504c909">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define TSV_TOSTR(sym)   TSV_STRINGIFY(sym)</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="comment">// used to report where the error occured.</span>
<a name="l00045"></a><a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">00045</a> <span class="preprocessor">#define TSV_ERR_AT(msg) ToStr((__FILE__ ":" TSV_TOSTR(__LINE__) ": " msg))</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a>00047 <span class="preprocessor">#ifdef TSV_USE_RDBUF</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#define M_GETC()    (m_rdbuf-&gt;sbumpc())</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#define M_PEEK()    (m_rdbuf-&gt;sgetc())</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define M_UNGETC(c) (m_rdbuf-&gt;sputbackc(c))</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00052"></a><a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define M_GETC()    (m_fileStream.get())</span>
<a name="l00053"></a><a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define M_PEEK()    (m_fileStream.peek())</span>
<a name="l00054"></a><a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define M_UNGETC(c) (m_fileStream.putback(c))</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="comment">// #define TSV_SET_ERR(err) (setError(err)))</span>
<a name="l00058"></a><a class="code" href="_tsv_file_8cpp.html#f18bc2d86fc50e4c66bfc6e31a94a1da">00058</a> <span class="preprocessor">#define TSV_SET_ERR(err)    (m_errno=err)</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="comment">// Chars literials in numeric form (so they arent converted</span>
<a name="l00061"></a>00061 <span class="comment">// by the compiler) should be an enum?</span>
<a name="l00062"></a>00062 
<a name="l00064"></a><a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908">00064</a> <span class="preprocessor">#define TSV_CHAR_TAB     (0x09)</span>
<a name="l00066"></a><a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634">00066</a> <span class="preprocessor">#define TSV_CHAR_LF      (0x0a)</span>
<a name="l00068"></a><a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4">00068</a> <span class="preprocessor">#define TSV_CHAR_CR      (0x0d)</span>
<a name="l00070"></a><a class="code" href="_tsv_file_8cpp.html#3b3196c94ae6effc5a468d04951e89ef">00070</a> <span class="preprocessor">#define TSV_CHAR_COMMENT (0x23)</span>
<a name="l00072"></a><a class="code" href="_tsv_file_8cpp.html#ee68c7c932b5a2b564037447fcacfe2f">00072</a> <span class="preprocessor">#define TSV_CHAR_SPACE   (0x20)</span>
<a name="l00074"></a><a class="code" href="_tsv_file_8cpp.html#3c0e67c8dabd0e0c9bee6968768ae42c">00074</a> <span class="preprocessor">#define TSV_STRING_COMMENT  "#"</span>
<a name="l00076"></a><a class="code" href="_tsv_file_8cpp.html#01c57b92ec758290af280577d7e8ca1e">00076</a> <span class="preprocessor">#define TSV_STRING_META     "#%"</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>
<a name="l00079"></a><a class="code" href="_tsv_file_8cpp.html#c34e5500f92145ed5f1ac06074b40c1e">00079</a> <span class="preprocessor">#define TSV_EOL_UNIX   "\n"</span>
<a name="l00081"></a><a class="code" href="_tsv_file_8cpp.html#9a89c4b2e4127b0e7f6996169c8305a4">00081</a> <span class="preprocessor">#define TSV_EOL_WIN    "\r\n"</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a>00083 <span class="comment">// be nice to less fortunate users...</span>
<a name="l00084"></a>00084 <span class="comment">// use the native line endings</span>
<a name="l00085"></a>00085 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#define TSV_EOL TSV_EOL_WIN</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00088"></a><a class="code" href="_tsv_file_8cpp.html#b5bf1f987bbcb6e0ae190b58b9093c0d">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define TSV_EOL TSV_EOL_UNIX</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00092"></a>00092 
<a name="l00095"></a>00095 <span class="keywordtype">void</span>
<a name="l00096"></a><a class="code" href="namespaceaffx.html#9c9d69e0bcf728404dca5a3f8448c90d">00096</a> <a class="code" href="namespaceaffx.html#9c9d69e0bcf728404dca5a3f8448c90d" title="Trim whitespace from the left of a string.">affx::ltrim</a>(std::string&amp; str)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   string::size_type pos=str.find_first_not_of(<span class="stringliteral">" \t"</span>);
<a name="l00099"></a>00099   <span class="keywordflow">if</span> (pos==std::string::npos) {
<a name="l00100"></a>00100     str.erase();
<a name="l00101"></a>00101   } <span class="keywordflow">else</span> {
<a name="l00102"></a>00102     str.erase(0,pos);
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00108"></a>00108 <span class="keywordtype">void</span>
<a name="l00109"></a><a class="code" href="namespaceaffx.html#fba51719c7e92c971c7dea4ba1bafd69">00109</a> <a class="code" href="namespaceaffx.html#fba51719c7e92c971c7dea4ba1bafd69" title="Trim whitespace from the right of a string.">affx::rtrim</a>(std::string&amp; str)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   string::size_type pos=str.find_last_not_of(<span class="stringliteral">" \t"</span>);
<a name="l00112"></a>00112   <span class="keywordflow">if</span> (pos==std::string::npos) {
<a name="l00113"></a>00113     str.erase();
<a name="l00114"></a>00114   } <span class="keywordflow">else</span> {
<a name="l00115"></a>00115     str.erase(pos+1);
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00121"></a>00121 <span class="keywordtype">void</span>
<a name="l00122"></a><a class="code" href="namespaceaffx.html#54628348fb76ebbdb02a5b9aad4e720d">00122</a> <a class="code" href="namespaceaffx.html#54628348fb76ebbdb02a5b9aad4e720d" title="Trim whitespace from both sides of a string.">affx::trim</a>(std::string&amp; str)
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124   <a class="code" href="namespaceaffx.html#9c9d69e0bcf728404dca5a3f8448c90d" title="Trim whitespace from the left of a string.">ltrim</a>(str);
<a name="l00125"></a>00125   <a class="code" href="namespaceaffx.html#fba51719c7e92c971c7dea4ba1bafd69" title="Trim whitespace from the right of a string.">rtrim</a>(str);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00130"></a>00130 <span class="keywordtype">void</span>
<a name="l00131"></a><a class="code" href="namespaceaffx.html#af1add79d80b3f2800698a791a26a2a6">00131</a> <a class="code" href="namespaceaffx.html#af1add79d80b3f2800698a791a26a2a6" title="Remove quotes from a string if they are matching.">affx::dequote</a>(std::string&amp; str)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133   <span class="comment">// we only trim paired quotes</span>
<a name="l00134"></a>00134   <span class="keywordtype">size_t</span> str_size=str.size();
<a name="l00135"></a>00135   <span class="keywordflow">if</span> (str_size&lt;2) {
<a name="l00136"></a>00136     <span class="keywordflow">return</span>;
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138   <span class="comment">// pick out first and last char</span>
<a name="l00139"></a>00139   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c_begin=str[0];
<a name="l00140"></a>00140   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c_end=str[str_size-1];
<a name="l00141"></a>00141   <span class="comment">// paired quotes?</span>
<a name="l00142"></a>00142   <span class="keywordflow">if</span> (((c_begin==<span class="charliteral">'"'</span>)||(c_begin==<span class="charliteral">'\''</span>))&amp;&amp;(c_begin==c_end)) {
<a name="l00143"></a>00143     str.erase(str.size()-1,1); <span class="comment">// remove last quote</span>
<a name="l00144"></a>00144     str.erase(0,1);            <span class="comment">// remove first quote</span>
<a name="l00145"></a>00145   }
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00153"></a>00153 <span class="keywordtype">int</span>
<a name="l00154"></a><a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951">00154</a> <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">affx::splitstr</a>(std::string str,<span class="keywordtype">char</span> c,std::vector&lt;std::string&gt;&amp; vec)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   string::size_type pos1=0;
<a name="l00157"></a>00157   string::size_type pos2=0;
<a name="l00158"></a>00158   <span class="keywordtype">int</span> num=0;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   vec.clear();
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   <span class="keywordflow">while</span> (1) {
<a name="l00163"></a>00163     pos2=str.find(c,pos1);
<a name="l00164"></a>00164     <span class="keywordflow">if</span> (pos2==string::npos) {
<a name="l00165"></a>00165       vec.resize(num+1);
<a name="l00166"></a>00166       vec[num].assign(str,pos1,str.size()-pos1);
<a name="l00167"></a>00167       <span class="keywordflow">break</span>;
<a name="l00168"></a>00168     } <span class="keywordflow">else</span> {
<a name="l00169"></a>00169       vec.resize(num+1);
<a name="l00170"></a>00170       vec[num].assign(str,pos1,pos2-pos1);
<a name="l00171"></a>00171       pos1=pos2+1;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     ++num;
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175   <span class="keywordflow">return</span> num;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00181"></a>00181 <span class="keywordtype">int</span>
<a name="l00182"></a><a class="code" href="namespaceaffx.html#c9a7c6ec010d5df798fe0f30e5dc09d2">00182</a> <a class="code" href="namespaceaffx.html#c9a7c6ec010d5df798fe0f30e5dc09d2" title="Convert the escaped char to the char which it represents.">affx::unescapechar</a>(<span class="keywordtype">int</span> c)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184   <span class="keywordflow">switch</span> (c) {
<a name="l00185"></a>00185   <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>: <span class="keywordflow">return</span> <span class="charliteral">'\\'</span> ;
<a name="l00186"></a>00186   <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <span class="keywordflow">return</span> <span class="charliteral">'\a'</span> ;
<a name="l00187"></a>00187   <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: <span class="keywordflow">return</span> <a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a> ;
<a name="l00188"></a>00188   <span class="keywordflow">case</span> <span class="charliteral">'r'</span>: <span class="keywordflow">return</span> <a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a> ;
<a name="l00189"></a>00189   <span class="keywordflow">case</span> <span class="charliteral">'t'</span>: <span class="keywordflow">return</span> <a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a>;
<a name="l00190"></a>00190     <span class="comment">//case '': return '\\' ;</span>
<a name="l00191"></a>00191     <span class="comment">// return the character unchanged.</span>
<a name="l00192"></a>00192   <span class="keywordflow">default</span>: <span class="keywordflow">return</span> c;
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00197"></a>00197 
<a name="l00200"></a><a class="code" href="classaffx_1_1_tsv_file_binding.html#40f00c44c316e7185f7a3b2b91343bc7">00200</a> <a class="code" href="classaffx_1_1_tsv_file_binding.html#40f00c44c316e7185f7a3b2b91343bc7" title="Create a new Binding to map a column to a lvalue.">affx::TsvFileBinding::TsvFileBinding</a>()
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <a class="code" href="classaffx_1_1_tsv_file_binding.html#f4fe728be834f9aa1d9ade18cc28d74b" title="Clear all the members of the binding.">clear</a>();
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00207"></a>00207 <span class="keywordtype">void</span>
<a name="l00208"></a><a class="code" href="classaffx_1_1_tsv_file_binding.html#f4fe728be834f9aa1d9ade18cc28d74b">00208</a> <a class="code" href="classaffx_1_1_tsv_file_binding.html#f4fe728be834f9aa1d9ade18cc28d74b" title="Clear all the members of the binding.">affx::TsvFileBinding::clear</a>()
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   <a class="code" href="classaffx_1_1_tsv_file_binding.html#9a4b0b31ab384e644713d078816466ca" title="The column level.">m_bindto_clvl</a>=0;
<a name="l00211"></a>00211   <a class="code" href="classaffx_1_1_tsv_file_binding.html#c2e68d6dc7ff4cdeadc061c7fccdb24f" title="Is is bound by index or name?">m_bindto_type</a>=<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f77cb60d71ffa9a0dbe3aed31f6f50216d9" title="The binding wont be bound.">TSV_BINDTO_NONE</a>;
<a name="l00212"></a>00212   <a class="code" href="classaffx_1_1_tsv_file_binding.html#e9966ad979ba3dc6f8315cbbebf36681" title="The index of the bound column.">m_bindto_cidx</a>=0;
<a name="l00213"></a>00213   <a class="code" href="classaffx_1_1_tsv_file_binding.html#ac455f6a60e8b99aabcafecf41c70c90" title="The name of the bound column.">m_bindto_cname</a>=<span class="stringliteral">""</span>;
<a name="l00214"></a>00214   <a class="code" href="classaffx_1_1_tsv_file_binding.html#d3d649b755ece186f0da17f90bd8897d" title="How many strings should be interned (reuse the storage).">m_interncache_size</a>=0;
<a name="l00215"></a>00215   <a class="code" href="classaffx_1_1_tsv_file_binding.html#3ffe4b5f3fae287df13ac209b376230c" title="Is this linked to a column?">islinked</a>=<span class="keyword">false</span>;
<a name="l00216"></a>00216   <span class="comment">//</span>
<a name="l00217"></a>00217   <a class="code" href="classaffx_1_1_tsv_file_binding.html#b645c1f479f1df659190be4827c7a4ce" title="pointer to std::string">m_ptr_string</a>=NULL;
<a name="l00218"></a>00218   <a class="code" href="classaffx_1_1_tsv_file_binding.html#d0f6436ab92f2668989de612add2552a" title="pointer to int">m_ptr_int</a>=NULL;
<a name="l00219"></a>00219   <a class="code" href="classaffx_1_1_tsv_file_binding.html#5ecaf1707f7ec4be58344091eabc2055" title="pointer to double">m_ptr_double</a>=NULL;
<a name="l00220"></a>00220   <a class="code" href="classaffx_1_1_tsv_file_binding.html#bf04ab56ecc2081738b76f57713c80f0" title="pointer to float">m_ptr_float</a>=NULL;
<a name="l00221"></a>00221   <a class="code" href="classaffx_1_1_tsv_file_binding.html#f7ddf4c1841cdc104b1ce41a73bd191e" title="pointer to unsigned int">m_ptr_uint</a>=NULL;
<a name="l00222"></a>00222   <a class="code" href="classaffx_1_1_tsv_file_binding.html#a02f1268b68cb5b6b1547edbfefa13e7" title="pointer to unsigned long long">m_ptr_ulonglong</a>=NULL;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00226"></a>00226 
<a name="l00229"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#e591d2a578b7e10916770d37fa378a40">00229</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#e591d2a578b7e10916770d37fa378a40" title="Creator of TsvFileField.">affx::TsvFileField::TsvFileField</a>()
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   <span class="comment">// set default</span>
<a name="l00232"></a>00232   <a class="code" href="classaffx_1_1_tsv_file_field.html#626af5e1a7aec6a055e638fcf86c5bdd" title="Automatically strip quotes?">m_optAutoDequote</a>=<span class="keyword">true</span>;
<a name="l00233"></a>00233   <a class="code" href="classaffx_1_1_tsv_file_field.html#27cd59097350dc8890396589ea39be4e" title="Clear the members of the object. Set to null.">clear</a>();
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#cbdf5663af0cad053db9f49de8d99e7c">00236</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#cbdf5663af0cad053db9f49de8d99e7c">affx::TsvFileField::~TsvFileField</a>()
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00241"></a>00241 <span class="keywordtype">void</span>
<a name="l00242"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#27cd59097350dc8890396589ea39be4e">00242</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#27cd59097350dc8890396589ea39be4e" title="Clear the members of the object. Set to null.">affx::TsvFileField::clear</a>()
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>=<span class="stringliteral">""</span>;
<a name="l00245"></a>00245   <a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>=<span class="keyword">true</span>;
<a name="l00246"></a>00246   <span class="comment">//</span>
<a name="l00247"></a>00247   <a class="code" href="classaffx_1_1_tsv_file_field.html#ec54d3e773138c82a58f1003f6eba594" title="The cached value.">m_value_int</a>=-1;
<a name="l00248"></a>00248   <a class="code" href="classaffx_1_1_tsv_file_field.html#7b48a036e802d472010db5ba2e0b2865" title="Has this value been converted?">m_value_int_done</a>=<span class="keyword">false</span>;
<a name="l00249"></a>00249   <a class="code" href="classaffx_1_1_tsv_file_field.html#67d3749860dd2b42c40d183d4f8bb903" title="The return value for the conversion.">m_value_int_rv</a>=0;
<a name="l00250"></a>00250   <a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>=0.0;
<a name="l00251"></a>00251   <a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>=<span class="keyword">false</span>;
<a name="l00252"></a>00252   <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>=0;
<a name="l00253"></a>00253   <a class="code" href="classaffx_1_1_tsv_file_field.html#25f859eb00ba64fd5a85a3b074c23e63" title="Cached "unsigned int" conversions. same as int.">m_value_uint</a>=0;
<a name="l00254"></a>00254   <a class="code" href="classaffx_1_1_tsv_file_field.html#9c669ccb764d7fca501769672425c675" title="same as int">m_value_uint_done</a>=<span class="keyword">false</span>;
<a name="l00255"></a>00255   <a class="code" href="classaffx_1_1_tsv_file_field.html#ffdc2970b7a7f28cc5cd4e13018e2dea" title="same as int">m_value_uint_rv</a>=0;
<a name="l00256"></a>00256   <a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>=0;
<a name="l00257"></a>00257   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5df0c230a1c20cbf8b6c867737a5039" title="same as int">m_value_ulonglong_done</a>=<span class="keyword">false</span>;
<a name="l00258"></a>00258   <a class="code" href="classaffx_1_1_tsv_file_field.html#9886a0822af4a93e0a58aa0f97cd8b1f" title="same as int">m_value_ulonglong_rv</a>=0;
<a name="l00259"></a>00259   <span class="comment">// default is 0.000</span>
<a name="l00260"></a>00260   <a class="code" href="classaffx_1_1_tsv_file_field.html#e5c387a2a33e3ccb147912e311bf8197" title="the output precision">m_precision</a>=<a class="code" href="_tsv_file_8h.html#97ae84b230b9317c3cf279322ea93224" title="The default number of decimal places in output.">TSV_DEFAULT_PRECISION</a>;
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00265"></a>00265 <span class="keywordtype">bool</span>
<a name="l00266"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#b0572fe67759a7b839a52b5fb968769a">00266</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#b0572fe67759a7b839a52b5fb968769a" title="Is the Column null?">affx::TsvFileField::isNull</a>()
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00273"></a>00273 <span class="keywordtype">int</span>
<a name="l00274"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303">00274</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">affx::TsvFileField::setBuffer</a>(std::string str)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276   <span class="comment">// dont alias the buffer. "m_buffer=str;" might leave m_buffer as a reference</span>
<a name="l00277"></a>00277   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.erase();
<a name="l00278"></a>00278   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.append(str.begin(),str.end());
<a name="l00279"></a>00279   <a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>=<span class="keyword">false</span>;
<a name="l00280"></a>00280   <a class="code" href="classaffx_1_1_tsv_file_field.html#7b48a036e802d472010db5ba2e0b2865" title="Has this value been converted?">m_value_int_done</a>=<span class="keyword">false</span>;
<a name="l00281"></a>00281   <a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>=<span class="keyword">false</span>;
<a name="l00282"></a>00282   <a class="code" href="classaffx_1_1_tsv_file_field.html#9c669ccb764d7fca501769672425c675" title="same as int">m_value_uint_done</a>=<span class="keyword">false</span>;
<a name="l00283"></a>00283   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5df0c230a1c20cbf8b6c867737a5039" title="same as int">m_value_ulonglong_done</a>=<span class="keyword">false</span>;
<a name="l00284"></a>00284   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keywordtype">int</span>
<a name="l00288"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#53ce0151fd54a224b2b67d6423271837">00288</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#53ce0151fd54a224b2b67d6423271837">affx::TsvFileField::setPrecision</a>(<span class="keywordtype">int</span> places)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290   <a class="code" href="classaffx_1_1_tsv_file_field.html#e5c387a2a33e3ccb147912e311bf8197" title="the output precision">m_precision</a>=places;
<a name="l00291"></a>00291   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00295"></a><a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2">00295</a> <span class="preprocessor">#define TSV_NULL_RETURN(RV)  if (m_isnull) { val=RV; return TSV_ERR_NULL; }</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>
<a name="l00300"></a>00300 <span class="keywordtype">int</span>
<a name="l00301"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc">00301</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(std::string&amp; val)
<a name="l00302"></a>00302 {
<a name="l00303"></a>00303   <a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2" title="handy macro for code.">TSV_NULL_RETURN</a>(<span class="stringliteral">""</span>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <span class="comment">// Avoid data sharing by clearing then appending the contents.</span>
<a name="l00306"></a>00306   val.erase();
<a name="l00307"></a>00307   val.append(<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.begin(),<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.end());
<a name="l00308"></a>00308   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00314"></a>00314 <span class="keywordtype">int</span>
<a name="l00315"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#2f776949f07867c4eaae5b046814b6de">00315</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(<span class="keywordtype">int</span>&amp; val)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317   <a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2" title="handy macro for code.">TSV_NULL_RETURN</a>(0);
<a name="l00318"></a>00318   <span class="comment">// done already?</span>
<a name="l00319"></a>00319   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_field.html#7b48a036e802d472010db5ba2e0b2865" title="Has this value been converted?">m_value_int_done</a>) {
<a name="l00320"></a>00320     val=<a class="code" href="classaffx_1_1_tsv_file_field.html#ec54d3e773138c82a58f1003f6eba594" title="The cached value.">m_value_int</a>;
<a name="l00321"></a>00321     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#67d3749860dd2b42c40d183d4f8bb903" title="The return value for the conversion.">m_value_int_rv</a>;
<a name="l00322"></a>00322   }
<a name="l00323"></a>00323   <span class="comment">//</span>
<a name="l00324"></a>00324   <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr_start=<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.c_str();
<a name="l00325"></a>00325   <span class="keywordtype">char</span>* ptr_end=NULL;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="comment">// do the conversion (Force base 10)</span>
<a name="l00328"></a>00328   <a class="code" href="classaffx_1_1_tsv_file_field.html#ec54d3e773138c82a58f1003f6eba594" title="The cached value.">m_value_int</a>=strtol(ptr_start,&amp;ptr_end,10);
<a name="l00329"></a>00329   <span class="comment">// If m_ptr_end is not NULL then there was an invalid character.</span>
<a name="l00330"></a>00330   <span class="comment">// If m_ptr_end == m_ptr_start then it was the null string. ("")</span>
<a name="l00331"></a>00331   <span class="keywordflow">if</span> ((*ptr_end!=0)||(ptr_end==ptr_start)) {
<a name="l00332"></a>00332     <a class="code" href="classaffx_1_1_tsv_file_field.html#ec54d3e773138c82a58f1003f6eba594" title="The cached value.">m_value_int</a>=-1; <span class="comment">// fill in with something off the end</span>
<a name="l00333"></a>00333     <a class="code" href="classaffx_1_1_tsv_file_field.html#67d3749860dd2b42c40d183d4f8bb903" title="The return value for the conversion.">m_value_int_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395d6a1575ed312e3b4a5570e34a91550c0" title="The value could not be converted.">TSV_ERR_CONVERSION</a>; <span class="comment">// signal an error</span>
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335   <span class="keywordflow">else</span> {
<a name="l00336"></a>00336     <a class="code" href="classaffx_1_1_tsv_file_field.html#67d3749860dd2b42c40d183d4f8bb903" title="The return value for the conversion.">m_value_int_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <a class="code" href="classaffx_1_1_tsv_file_field.html#7b48a036e802d472010db5ba2e0b2865" title="Has this value been converted?">m_value_int_done</a>=<span class="keyword">true</span>;
<a name="l00340"></a>00340   val=<a class="code" href="classaffx_1_1_tsv_file_field.html#ec54d3e773138c82a58f1003f6eba594" title="The cached value.">m_value_int</a>;
<a name="l00341"></a>00341   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#67d3749860dd2b42c40d183d4f8bb903" title="The return value for the conversion.">m_value_int_rv</a>;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00347"></a>00347 <span class="keywordtype">int</span>
<a name="l00348"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#87113962370b5fa82fce048895ec73ff">00348</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(<span class="keywordtype">double</span>&amp; val)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350   <a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2" title="handy macro for code.">TSV_NULL_RETURN</a>(0.0);
<a name="l00351"></a>00351   <span class="comment">// done already?</span>
<a name="l00352"></a>00352   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>) {
<a name="l00353"></a>00353     val=<a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>;
<a name="l00354"></a>00354     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>;
<a name="l00355"></a>00355   }
<a name="l00356"></a>00356   <span class="comment">//</span>
<a name="l00357"></a>00357   <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr_start=<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.c_str();
<a name="l00358"></a>00358   <span class="keywordtype">char</span>* ptr_end=NULL;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="comment">// do the conversion</span>
<a name="l00361"></a>00361   <a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>=strtod(ptr_start,&amp;ptr_end);
<a name="l00362"></a>00362   <span class="comment">// same checks as strtol</span>
<a name="l00363"></a>00363   <span class="keywordflow">if</span> ((*ptr_end!=0)||(ptr_end==ptr_start)) {
<a name="l00364"></a>00364     <a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>=-1.0; <span class="comment">// bad value</span>
<a name="l00365"></a>00365     <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395d6a1575ed312e3b4a5570e34a91550c0" title="The value could not be converted.">TSV_ERR_CONVERSION</a>; <span class="comment">// signal an error</span>
<a name="l00366"></a>00366   } <span class="keywordflow">else</span> {
<a name="l00367"></a>00367     <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00368"></a>00368   }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>=<span class="keyword">true</span>;
<a name="l00371"></a>00371   val=<a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>;
<a name="l00372"></a>00372   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00379"></a>00379 <span class="keywordtype">int</span>
<a name="l00380"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#5324ebcd7b826871d53ba8f34b0db551">00380</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(<span class="keywordtype">float</span>&amp; val)
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>) {
<a name="l00383"></a>00383     val=(float)<a class="code" href="classaffx_1_1_tsv_file_field.html#a47e61b1f9e36517d0b2cf00aba5fa7b" title="Cached "double" conversions. same as int.">m_value_double</a>;
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#11508229494de49175135186ad2a7b77" title="same as int">m_value_double_rv</a>;
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386   <span class="comment">// Get the double value and cast it.</span>
<a name="l00387"></a>00387   <span class="keywordtype">double</span> tmp_double;
<a name="l00388"></a>00388   <span class="keywordtype">int</span> rv;
<a name="l00389"></a>00389   rv=<span class="keyword">get</span>(tmp_double);
<a name="l00390"></a>00390   val=(float)tmp_double;
<a name="l00391"></a>00391   <span class="keywordflow">return</span> rv;
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00397"></a>00397 <span class="keywordtype">int</span>
<a name="l00398"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#bb1a547bd973bd9bbfd933fbd0153212">00398</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; val)
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400   <a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2" title="handy macro for code.">TSV_NULL_RETURN</a>(0);
<a name="l00401"></a>00401   <span class="comment">// done already?</span>
<a name="l00402"></a>00402   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_field.html#9c669ccb764d7fca501769672425c675" title="same as int">m_value_uint_done</a>) {
<a name="l00403"></a>00403     val=<a class="code" href="classaffx_1_1_tsv_file_field.html#25f859eb00ba64fd5a85a3b074c23e63" title="Cached "unsigned int" conversions. same as int.">m_value_uint</a>;
<a name="l00404"></a>00404     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#ffdc2970b7a7f28cc5cd4e13018e2dea" title="same as int">m_value_uint_rv</a>;
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406   <span class="comment">//</span>
<a name="l00407"></a>00407   <span class="keyword">const</span> <span class="keywordtype">char</span>* m_ptr_start=<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.c_str();
<a name="l00408"></a>00408   <span class="keywordtype">char</span>* m_ptr_end=NULL;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="comment">// do the conversion</span>
<a name="l00411"></a>00411   <a class="code" href="classaffx_1_1_tsv_file_field.html#25f859eb00ba64fd5a85a3b074c23e63" title="Cached "unsigned int" conversions. same as int.">m_value_uint</a>=strtoul(m_ptr_start,&amp;m_ptr_end,10);
<a name="l00412"></a>00412   <span class="keywordflow">if</span> ((*m_ptr_end)!=0) {
<a name="l00413"></a>00413     <a class="code" href="classaffx_1_1_tsv_file_field.html#25f859eb00ba64fd5a85a3b074c23e63" title="Cached "unsigned int" conversions. same as int.">m_value_uint</a>=0; <span class="comment">// fill in zero on error.</span>
<a name="l00414"></a>00414     <a class="code" href="classaffx_1_1_tsv_file_field.html#ffdc2970b7a7f28cc5cd4e13018e2dea" title="same as int">m_value_uint_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395d6a1575ed312e3b4a5570e34a91550c0" title="The value could not be converted.">TSV_ERR_CONVERSION</a>; <span class="comment">// signal it.</span>
<a name="l00415"></a>00415   } <span class="keywordflow">else</span> {
<a name="l00416"></a>00416     <a class="code" href="classaffx_1_1_tsv_file_field.html#ffdc2970b7a7f28cc5cd4e13018e2dea" title="same as int">m_value_uint_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00417"></a>00417   }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   <a class="code" href="classaffx_1_1_tsv_file_field.html#9c669ccb764d7fca501769672425c675" title="same as int">m_value_uint_done</a>=<span class="keyword">true</span>;
<a name="l00420"></a>00420   val=<a class="code" href="classaffx_1_1_tsv_file_field.html#25f859eb00ba64fd5a85a3b074c23e63" title="Cached "unsigned int" conversions. same as int.">m_value_uint</a>;
<a name="l00421"></a>00421   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#ffdc2970b7a7f28cc5cd4e13018e2dea" title="same as int">m_value_uint_rv</a>;
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00427"></a>00427 <span class="keywordtype">int</span>
<a name="l00428"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#10bc4ee7af928cb219b0daccecb8ee80">00428</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">affx::TsvFileField::get</a>(uint64_t&amp; val)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430   <a class="code" href="_tsv_file_8cpp.html#add30a14c9d17539d55f7eea0b5d1af2" title="handy macro for code.">TSV_NULL_RETURN</a>(0);
<a name="l00431"></a>00431   <span class="comment">// done already?</span>
<a name="l00432"></a>00432   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_field.html#a5df0c230a1c20cbf8b6c867737a5039" title="same as int">m_value_ulonglong_done</a>) {
<a name="l00433"></a>00433     val=<a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>;
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#9886a0822af4a93e0a58aa0f97cd8b1f" title="same as int">m_value_ulonglong_rv</a>;
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436   <span class="comment">//</span>
<a name="l00437"></a>00437   <span class="keyword">const</span> <span class="keywordtype">char</span>* m_ptr_start=<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.c_str();
<a name="l00438"></a>00438   <span class="keywordtype">char</span>* m_ptr_end=NULL;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <span class="comment">// do the conversion</span>
<a name="l00441"></a>00441 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00442"></a>00442 <span class="preprocessor"></span>  <a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>=strtoull(m_ptr_start,&amp;m_ptr_end,10);
<a name="l00443"></a>00443 <span class="preprocessor">#else</span>
<a name="l00444"></a>00444 <span class="preprocessor"></span>  <a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>=_strtoui64(m_ptr_start,&amp;m_ptr_end,10);
<a name="l00445"></a>00445 <span class="preprocessor">#endif</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>  <span class="keywordflow">if</span> ((*m_ptr_end)!=0) {
<a name="l00447"></a>00447     <a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>=0; <span class="comment">// fill in zero on error.</span>
<a name="l00448"></a>00448     <a class="code" href="classaffx_1_1_tsv_file_field.html#9886a0822af4a93e0a58aa0f97cd8b1f" title="same as int">m_value_ulonglong_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395d6a1575ed312e3b4a5570e34a91550c0" title="The value could not be converted.">TSV_ERR_CONVERSION</a>; <span class="comment">// signal it.</span>
<a name="l00449"></a>00449   } <span class="keywordflow">else</span> {
<a name="l00450"></a>00450     <a class="code" href="classaffx_1_1_tsv_file_field.html#9886a0822af4a93e0a58aa0f97cd8b1f" title="same as int">m_value_ulonglong_rv</a>=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <a class="code" href="classaffx_1_1_tsv_file_field.html#a5df0c230a1c20cbf8b6c867737a5039" title="same as int">m_value_ulonglong_done</a>=<span class="keyword">true</span>;
<a name="l00454"></a>00454   val=<a class="code" href="classaffx_1_1_tsv_file_field.html#33a2aeb60b80407135f04814ccf0f9bc" title="Cached "uint64_t" conversions. same as int.">m_value_ulonglong</a>;
<a name="l00455"></a>00455   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#9886a0822af4a93e0a58aa0f97cd8b1f" title="same as int">m_value_ulonglong_rv</a>;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00460"></a>00460 
<a name="l00464"></a>00464 <span class="keywordtype">int</span>
<a name="l00465"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff">00465</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff" title="set the val">affx::TsvFileField::set</a>(<span class="keyword">const</span> std::string&amp; val)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">setBuffer</a>(val);
<a name="l00468"></a>00468 }
<a name="l00473"></a>00473 <span class="keywordtype">int</span>
<a name="l00474"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#5ee7b7d881b4f8bcd84614bab94792df">00474</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff" title="set the val">affx::TsvFileField::set</a>(<span class="keywordtype">int</span> val)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476   std::ostringstream stream;
<a name="l00477"></a>00477   stream &lt;&lt; val;
<a name="l00478"></a>00478   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">setBuffer</a>(stream.str());
<a name="l00479"></a>00479 }
<a name="l00484"></a>00484 <span class="keywordtype">int</span>
<a name="l00485"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#4d2152a49d312aa77c69ed7b448decad">00485</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff" title="set the val">affx::TsvFileField::set</a>(<span class="keywordtype">double</span> val)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487   std::ostringstream stream;
<a name="l00488"></a>00488   stream.setf(ios::fixed, ios::floatfield);
<a name="l00489"></a>00489   stream.precision(<a class="code" href="classaffx_1_1_tsv_file_field.html#e5c387a2a33e3ccb147912e311bf8197" title="the output precision">m_precision</a>);
<a name="l00490"></a>00490   stream &lt;&lt; val;
<a name="l00491"></a>00491   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">setBuffer</a>(stream.str());
<a name="l00492"></a>00492 }
<a name="l00497"></a>00497 <span class="keywordtype">int</span>
<a name="l00498"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#74a38a3650f1c576e9004047a977f4a3">00498</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff" title="set the val">affx::TsvFileField::set</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500   std::ostringstream stream;
<a name="l00501"></a>00501   stream &lt;&lt; val;
<a name="l00502"></a>00502   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">setBuffer</a>(stream.str());
<a name="l00503"></a>00503 }
<a name="l00508"></a>00508 <span class="keywordtype">int</span>
<a name="l00509"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#b02c21bcb0cf9084c8e840f4edcb3e4b">00509</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#35ebd76cdbcab2896c18d20e1fbcddff" title="set the val">affx::TsvFileField::set</a>(uint64_t val)
<a name="l00510"></a>00510 {
<a name="l00511"></a>00511   std::ostringstream stream;
<a name="l00512"></a>00512   stream &lt;&lt; val;
<a name="l00513"></a>00513   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_field.html#85d880d26aad9de5b13708c0f3346303" title="Set the buffer value of the column.">setBuffer</a>(stream.str());
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00517"></a>00517 
<a name="l00520"></a>00520 <span class="keywordtype">void</span>
<a name="l00521"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#a21e692c8100fe710697a689307bea1a">00521</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#a21e692c8100fe710697a689307bea1a" title="Add the var to the collection of linked vars.">affx::TsvFileField::linkedvar_push</a>(<a class="code" href="classaffx_1_1_tsv_file_binding.html">affx::TsvFileBinding</a>* var)
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523   <a class="code" href="classaffx_1_1_tsv_file_field.html#a630472501511fe634a3901e168d6860" title="Linked bindings.">m_linkedvar_vec</a>.push_back(var);
<a name="l00524"></a>00524 }
<a name="l00526"></a>00526 <span class="keywordtype">void</span>
<a name="l00527"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#8d9e2579412aafc2bc2fd7a0ac7aaabc">00527</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#8d9e2579412aafc2bc2fd7a0ac7aaabc" title="Clear the linkages to bound variables.">affx::TsvFileField::linkedvars_clear</a>()
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529   <a class="code" href="classaffx_1_1_tsv_file_field.html#a630472501511fe634a3901e168d6860" title="Linked bindings.">m_linkedvar_vec</a>.clear();
<a name="l00530"></a>00530 }
<a name="l00532"></a>00532 <span class="keywordtype">void</span>
<a name="l00533"></a><a class="code" href="classaffx_1_1_tsv_file_field.html#09720778f8f0291ed2368f44411bddb9">00533</a> <a class="code" href="classaffx_1_1_tsv_file_field.html#09720778f8f0291ed2368f44411bddb9" title="Assign each linked var a value.">affx::TsvFileField::linkedvars_assign</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>* tsvfile)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535   <span class="comment">// Assign to the linked vars</span>
<a name="l00536"></a>00536   <span class="keywordtype">size_t</span> lvar_vec_size=<a class="code" href="classaffx_1_1_tsv_file_field.html#a630472501511fe634a3901e168d6860" title="Linked bindings.">m_linkedvar_vec</a>.size();
<a name="l00537"></a>00537   <span class="keywordtype">int</span> rv=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> vi=0;vi&lt;lvar_vec_size;vi++) {
<a name="l00540"></a>00540     <a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>* var=<a class="code" href="classaffx_1_1_tsv_file_field.html#a630472501511fe634a3901e168d6860" title="Linked bindings.">m_linkedvar_vec</a>[vi];
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (var!=NULL) {
<a name="l00542"></a>00542       <span class="comment">// These are sorted by frequency of use.</span>
<a name="l00543"></a>00543       <span class="keywordflow">if</span> (var-&gt;m_ptr_int!=NULL) {
<a name="l00544"></a>00544         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_int);
<a name="l00545"></a>00545       }
<a name="l00546"></a>00546       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;m_ptr_string!=NULL) {
<a name="l00547"></a>00547         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_string);
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;m_ptr_float!=NULL) {
<a name="l00550"></a>00550         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_float);
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;m_ptr_double!=NULL) {
<a name="l00553"></a>00553         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_double);
<a name="l00554"></a>00554       }
<a name="l00555"></a>00555       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;m_ptr_uint!=NULL) {
<a name="l00556"></a>00556         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_uint);
<a name="l00557"></a>00557       }
<a name="l00558"></a>00558       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;m_ptr_ulonglong!=NULL) {
<a name="l00559"></a>00559         rv=<span class="keyword">get</span>(*var-&gt;m_ptr_ulonglong);
<a name="l00560"></a>00560       }
<a name="l00561"></a>00561       <span class="keywordflow">else</span> {
<a name="l00562"></a>00562         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"Internal error: Binding does not have a pointer!"</span>));
<a name="l00563"></a>00563       }
<a name="l00564"></a>00564       <span class="comment">//</span>
<a name="l00565"></a>00565       <span class="keywordflow">if</span> ((rv!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>)&amp;&amp;(var-&gt;m_flags&amp;<a class="code" href="namespaceaffx.html#8f36853f1d3b6cfb79edebd82760691df605fbe0e244c4a604d176991d8df2c6" title="warn if not bound">TSV_BIND_REQUIRED</a>)) {
<a name="l00566"></a>00566         <span class="comment">// We say "data line" to make it clear we arent counting header lines.</span>
<a name="l00567"></a>00567         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"Conversion of required field failed!"</span>)
<a name="l00568"></a>00568                       +<span class="stringliteral">"(on data line "</span>+<a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(tsvfile-&gt;lineNumber()+1)+<span class="stringliteral">")"</span>);
<a name="l00569"></a>00569       }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571   }
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">/* Unused -- code which wants this generally uses &lt;std::map&gt;</span>
<a name="l00575"></a>00575 <span class="comment">int</span>
<a name="l00576"></a>00576 <span class="comment">affx::TsvFileField::setInternCacheSize(int size)</span>
<a name="l00577"></a>00577 <span class="comment">{</span>
<a name="l00578"></a>00578 <span class="comment">  int old_size=m_interncache_size;</span>
<a name="l00579"></a>00579 <span class="comment">  // -1 means ignore this setting.</span>
<a name="l00580"></a>00580 <span class="comment">  if (size==TSV_INTERNSIZE_UNSET) {</span>
<a name="l00581"></a>00581 <span class="comment">    return old_size;</span>
<a name="l00582"></a>00582 <span class="comment">  }</span>
<a name="l00583"></a>00583 <span class="comment">  // Zero disables it, positive size enables it</span>
<a name="l00584"></a>00584 <span class="comment">  m_interncache_size=size;</span>
<a name="l00585"></a>00585 <span class="comment">  m_interncache_vec.reserve(size);</span>
<a name="l00586"></a>00586 <span class="comment">  if (size&lt;(int)m_interncache_vec.size()) {</span>
<a name="l00587"></a>00587 <span class="comment">    // this is not random replacement but is quick.</span>
<a name="l00588"></a>00588 <span class="comment">    m_interncache_vec.resize(size);</span>
<a name="l00589"></a>00589 <span class="comment">  }</span>
<a name="l00590"></a>00590 <span class="comment">  //</span>
<a name="l00591"></a>00591 <span class="comment">  return old_size;</span>
<a name="l00592"></a>00592 <span class="comment">}</span>
<a name="l00593"></a>00593 <span class="comment">*/</span>
<a name="l00594"></a>00594 
<a name="l00596"></a>00596 
<a name="l00598"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#3cc3ad7c155ad5882adb9adef7dbf682">00598</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#3cc3ad7c155ad5882adb9adef7dbf682" title="Create a TsvFileIndex.">affx::TsvFileIndex::TsvFileIndex</a>()
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600   <a class="code" href="classaffx_1_1_tsv_file_index.html#2baeb0a7d3e9a0273c02d4ab342f073b" title="Init the member vars to known values.">init</a>();
<a name="l00601"></a>00601 }
<a name="l00603"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#52a1702190457d9c85b71a24ff686187">00603</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#52a1702190457d9c85b71a24ff686187" title="Destroy a TsvFileIndex.">affx::TsvFileIndex::~TsvFileIndex</a>()
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00608"></a>00608 <span class="keywordtype">void</span>
<a name="l00609"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#2baeb0a7d3e9a0273c02d4ab342f073b">00609</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#2baeb0a7d3e9a0273c02d4ab342f073b" title="Init the member vars to known values.">affx::TsvFileIndex::init</a>()
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611   <a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>=-1;
<a name="l00612"></a>00612   <a class="code" href="classaffx_1_1_tsv_file_index.html#857dff7db112983051637e63606887ff" title="Is is bound by index or name?">m_bindto_type</a>=<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f77cb60d71ffa9a0dbe3aed31f6f50216d9" title="The binding wont be bound.">TSV_BINDTO_NONE</a>;
<a name="l00613"></a>00613   <a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>=-1;
<a name="l00614"></a>00614   <a class="code" href="classaffx_1_1_tsv_file_index.html#262b51aaf06c8c90645986c670981843" title="The name of the bound column.">m_bindto_cname</a>=<span class="stringliteral">""</span>;
<a name="l00615"></a>00615   <a class="code" href="classaffx_1_1_tsv_file_index.html#0de3ff913576f001420ec842b9536da6" title="Clear the contents of the index.">clear</a>();
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00619"></a>00619 <span class="keywordtype">void</span>
<a name="l00620"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#0de3ff913576f001420ec842b9536da6">00620</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#0de3ff913576f001420ec842b9536da6" title="Clear the contents of the index.">affx::TsvFileIndex::clear</a>()
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622   <a class="code" href="classaffx_1_1_tsv_file_index.html#dc2e204e4bc9c62caf61da363791f949" title="has the index been populated?">m_done</a>=<span class="keyword">false</span>;
<a name="l00623"></a>00623   <a class="code" href="classaffx_1_1_tsv_file_index.html#d1d91e785ab7b331d81b9ec54dcb6c72" title="map ofstring value to lines">m_index_str2line</a>.clear();
<a name="l00624"></a>00624   <a class="code" href="classaffx_1_1_tsv_file_index.html#2542d33af9d4aee9942b533af41b60da" title="map of int values to lines">m_index_int2line</a>.clear();
<a name="l00625"></a>00625   <a class="code" href="classaffx_1_1_tsv_file_index.html#b9cc5416c84aaae5cfc59dd6dbe561fc" title="map of double values to lines">m_index_double2line</a>.clear();
<a name="l00626"></a>00626   <a class="code" href="classaffx_1_1_tsv_file_index.html#d13fddeeaf1ab9b928ee500ed0ef11d1" title="map of unsigned int values to lines">m_index_uint2line</a>.clear();
<a name="l00627"></a>00627   <a class="code" href="classaffx_1_1_tsv_file_index.html#ee5d4572614e4e077f1e2a3db49bba71" title="map of uint64_t values to lines">m_index_ulonglong2line</a>.clear();
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00633"></a>00633 <span class="keywordtype">void</span>
<a name="l00634"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#84f008400f7208f86b35272f29590036">00634</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#84f008400f7208f86b35272f29590036" title="Add the data from field to the index.">affx::TsvFileIndex::data_add</a>(<a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* field,<a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a> line)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636   <span class="comment">//assert(field!=NULL);</span>
<a name="l00637"></a>00637   <a class="code" href="class_err.html#d1a633f602fe60689cdc12d9ca1842e9">Err::check</a>(field!=NULL,<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"data_add: field is null."</span>));
<a name="l00638"></a>00638   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde0752a4477d57a28231801839cff95671">TSV_INDEX_STRING</a>) {
<a name="l00639"></a>00639     <span class="comment">// WARNING: field-&gt;m_buffer is reused and will be overwritten.</span>
<a name="l00640"></a>00640     <span class="comment">// So we need to force a fresh copy to be made by modifying the string.</span>
<a name="l00641"></a>00641     <span class="comment">// so first we "copy" the string.</span>
<a name="l00642"></a>00642     <span class="comment">// std::string str_copy=field-&gt;m_buffer;</span>
<a name="l00643"></a>00643     <span class="comment">// then we modify it -- this forces a copy</span>
<a name="l00644"></a>00644     <span class="comment">// str_copy.append(1,' ');</span>
<a name="l00645"></a>00645     <span class="comment">// then we undo the modification</span>
<a name="l00646"></a>00646     <span class="comment">// str_copy.resize(str_copy.size()-1);</span>
<a name="l00647"></a>00647     <span class="comment">// now we can use it in our map</span>
<a name="l00648"></a>00648     std::string str_copy;
<a name="l00649"></a>00649     str_copy.append(field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.begin(),field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.end());
<a name="l00650"></a>00650     <a class="code" href="classaffx_1_1_tsv_file_index.html#d1d91e785ab7b331d81b9ec54dcb6c72" title="map ofstring value to lines">m_index_str2line</a>.insert(make_pair(str_copy,line));
<a name="l00651"></a>00651     <span class="keywordflow">return</span>;
<a name="l00652"></a>00652   }
<a name="l00653"></a>00653   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde39cd17e4abd754e8a89d12696f884dcd">TSV_INDEX_INT</a>) {
<a name="l00654"></a>00654     <span class="keywordtype">int</span> tmp_int;
<a name="l00655"></a>00655     <span class="keywordflow">if</span> (field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">get</a>(tmp_int)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l00656"></a>00656       <a class="code" href="classaffx_1_1_tsv_file_index.html#2542d33af9d4aee9942b533af41b60da" title="map of int values to lines">m_index_int2line</a>.insert(make_pair(tmp_int,line));
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658     <span class="keywordflow">return</span>;
<a name="l00659"></a>00659   }
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fded10c38eff0744c579861fd8fc8d28be7">TSV_INDEX_DOUBLE</a>) {
<a name="l00661"></a>00661     <span class="keywordtype">double</span> tmp_double;
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">get</a>(tmp_double)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l00663"></a>00663       <a class="code" href="classaffx_1_1_tsv_file_index.html#b9cc5416c84aaae5cfc59dd6dbe561fc" title="map of double values to lines">m_index_double2line</a>.insert(make_pair(tmp_double,line));
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     <span class="keywordflow">return</span>;
<a name="l00666"></a>00666   }
<a name="l00667"></a>00667   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fdea1d767928435e2bd1ef9fc8a6c5648a0">TSV_INDEX_UINT</a>) {
<a name="l00668"></a>00668     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_uint;
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">get</a>(tmp_uint)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l00670"></a>00670       <a class="code" href="classaffx_1_1_tsv_file_index.html#d13fddeeaf1ab9b928ee500ed0ef11d1" title="map of unsigned int values to lines">m_index_uint2line</a>.insert(make_pair(tmp_uint,line));
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <span class="keywordflow">return</span>;
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde2508bed5b4f250e5a0ef3fc94b300130">TSV_INDEX_ULONGLONG</a>) {
<a name="l00675"></a>00675     uint64_t tmp_ulonglong;
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (field-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#658a51d80d1831599873a54115d728bc" title="Get the value as a string.">get</a>(tmp_ulonglong)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l00677"></a>00677       <a class="code" href="classaffx_1_1_tsv_file_index.html#ee5d4572614e4e077f1e2a3db49bba71" title="map of uint64_t values to lines">m_index_ulonglong2line</a>.insert(make_pair(tmp_ulonglong,line));
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679     <span class="keywordflow">return</span>;
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00690"></a>00690 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> linenum_t&gt;
<a name="l00691"></a>00691 <span class="keywordtype">int</span>
<a name="l00692"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2">00692</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">affx::TsvFileIndex::results_append_tmpl</a>(std::vector&lt;linenum_t&gt;&amp; results,
<a name="l00693"></a>00693                                      std::multimap&lt;T1,linenum_t&gt;&amp; mmap,
<a name="l00694"></a>00694                                      <span class="keywordtype">int</span> op,
<a name="l00695"></a>00695                                      T1&amp; val)
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697   <span class="keyword">typename</span> std::multimap&lt;T1,linenum_t&gt;::iterator r_start,r_end;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="keywordflow">if</span> (op==<a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe368ba07b720d784f7e9431022e90d4e95">TSV_OP_LT</a>) {
<a name="l00700"></a>00700     r_start=mmap.begin();
<a name="l00701"></a>00701     r_end=mmap.lower_bound(val);
<a name="l00702"></a>00702   }
<a name="l00703"></a>00703   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op==<a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe3eadb142e6844038a7674056f9b92163a">TSV_OP_LTEQ</a>) {
<a name="l00704"></a>00704     r_start=mmap.begin();
<a name="l00705"></a>00705     r_end=mmap.upper_bound(val);
<a name="l00706"></a>00706   }
<a name="l00707"></a>00707   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op==<a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe3c186fb0fb46b08561498444e7cafe097">TSV_OP_EQ</a>) {
<a name="l00708"></a>00708     r_start=mmap.lower_bound(val);
<a name="l00709"></a>00709     r_end=mmap.upper_bound(val);
<a name="l00710"></a>00710   }
<a name="l00711"></a>00711   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op==<a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe3519b70d4394b5db04e25a50885033518">TSV_OP_GTEQ</a>) {
<a name="l00712"></a>00712     r_start=mmap.lower_bound(val);
<a name="l00713"></a>00713     r_end=mmap.end();
<a name="l00714"></a>00714   }
<a name="l00715"></a>00715   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op==<a class="code" href="namespaceaffx.html#bbf11d47722d5167973c58b2ae5fffe3f67adf0786758e89ee7c39f78236bc30">TSV_OP_GT</a>) {
<a name="l00716"></a>00716     r_start=mmap.upper_bound(val);
<a name="l00717"></a>00717     r_end=mmap.end();
<a name="l00718"></a>00718   } <span class="keywordflow">else</span> {
<a name="l00719"></a>00719     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"Invalid operation in results_append."</span>));
<a name="l00720"></a>00720     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3956da9440b3dacaf83f00b29b50f00d7ef" title="An otherwise unknown error.">TSV_ERR_UNKNOWN</a>;
<a name="l00721"></a>00721   }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="comment">// Stick the range into find_result</span>
<a name="l00724"></a>00724   <span class="keywordflow">while</span> (r_start!=r_end) {
<a name="l00725"></a>00725     <span class="comment">//printf("r_start=(%4d,%4d)\n",(*r_start).first,(int)(*r_start).second);</span>
<a name="l00726"></a>00726     results.push_back((*r_start).second);
<a name="l00727"></a>00727     r_start++;
<a name="l00728"></a>00728   }
<a name="l00729"></a>00729   <span class="comment">//</span>
<a name="l00730"></a>00730   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00738"></a>00738 <span class="keywordtype">int</span>
<a name="l00739"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b">00739</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">affx::TsvFileIndex::results_append</a>(std::vector&lt;linenum_t&gt;&amp; results,<span class="keywordtype">int</span> op,std::string val)
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741   <span class="comment">// Use the template for the different types</span>
<a name="l00742"></a>00742   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">results_append_tmpl</a>(results,<a class="code" href="classaffx_1_1_tsv_file_index.html#d1d91e785ab7b331d81b9ec54dcb6c72" title="map ofstring value to lines">m_index_str2line</a>,op,val);
<a name="l00743"></a>00743 }
<a name="l00749"></a>00749 <span class="keywordtype">int</span>
<a name="l00750"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#ceedfaf4f00c9bc9b751d487abed441c">00750</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">affx::TsvFileIndex::results_append</a>(std::vector&lt;linenum_t&gt;&amp; results,<span class="keywordtype">int</span> op,<span class="keywordtype">int</span> val)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">results_append_tmpl</a>(results,<a class="code" href="classaffx_1_1_tsv_file_index.html#2542d33af9d4aee9942b533af41b60da" title="map of int values to lines">m_index_int2line</a>,op,val);
<a name="l00753"></a>00753 }
<a name="l00759"></a>00759 <span class="keywordtype">int</span>
<a name="l00760"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#ea4a7a4620bde9f6e6b4053bbeca2098">00760</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">affx::TsvFileIndex::results_append</a>(std::vector&lt;linenum_t&gt;&amp; results,<span class="keywordtype">int</span> op,<span class="keywordtype">double</span> val)
<a name="l00761"></a>00761 {
<a name="l00762"></a>00762   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">results_append_tmpl</a>(results,<a class="code" href="classaffx_1_1_tsv_file_index.html#b9cc5416c84aaae5cfc59dd6dbe561fc" title="map of double values to lines">m_index_double2line</a>,op,val);
<a name="l00763"></a>00763 }
<a name="l00769"></a>00769 <span class="keywordtype">int</span>
<a name="l00770"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#2b99b463b1bbbbd02213404d8adfe431">00770</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">affx::TsvFileIndex::results_append</a>(std::vector&lt;linenum_t&gt;&amp; results,<span class="keywordtype">int</span> op,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)
<a name="l00771"></a>00771 {
<a name="l00772"></a>00772   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">results_append_tmpl</a>(results,<a class="code" href="classaffx_1_1_tsv_file_index.html#d13fddeeaf1ab9b928ee500ed0ef11d1" title="map of unsigned int values to lines">m_index_uint2line</a>,op,val);
<a name="l00773"></a>00773 }
<a name="l00779"></a>00779 <span class="keywordtype">int</span>
<a name="l00780"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#113a4acfd9b81ee1a77798446463f91d">00780</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">affx::TsvFileIndex::results_append</a>(std::vector&lt;linenum_t&gt;&amp; results,<span class="keywordtype">int</span> op,uint64_t val)
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file_index.html#a198a523fbd33c778a231664e154cea2" title="Template to query an index for matching values.">results_append_tmpl</a>(results,<a class="code" href="classaffx_1_1_tsv_file_index.html#ee5d4572614e4e077f1e2a3db49bba71" title="map of uint64_t values to lines">m_index_ulonglong2line</a>,op,val);
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00788"></a>00788 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> linenum_t&gt;
<a name="l00789"></a>00789 <span class="keywordtype">void</span>
<a name="l00790"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8">00790</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">affx::TsvFileIndex::dump_map</a>(std::multimap&lt;T1,linenum_t&gt;&amp; mmap)
<a name="l00791"></a>00791 {
<a name="l00792"></a>00792   <span class="keyword">typename</span> std::multimap&lt;T1,linenum_t&gt;::iterator i;
<a name="l00793"></a>00793   <span class="keywordtype">int</span> cnt=0;
<a name="l00794"></a>00794   <span class="keywordflow">for</span> (i=mmap.begin();i!=mmap.end();i++) {
<a name="l00795"></a>00795     cout &lt;&lt; cnt++ &lt;&lt; <span class="stringliteral">" : '"</span> &lt;&lt; (*i).first &lt;&lt; <span class="stringliteral">"' : '"</span> &lt;&lt; (*i).second &lt;&lt; <span class="stringliteral">"'\n"</span>;
<a name="l00796"></a>00796   }
<a name="l00797"></a>00797 }
<a name="l00798"></a>00798 
<a name="l00800"></a>00800 <span class="keywordtype">void</span>
<a name="l00801"></a><a class="code" href="classaffx_1_1_tsv_file_index.html#a7b7c514b935d0c19b4d607a33762ecc">00801</a> <a class="code" href="classaffx_1_1_tsv_file_index.html#a7b7c514b935d0c19b4d607a33762ecc" title="Dump the contents of the index.">affx::TsvFileIndex::dump</a>()
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803   printf(<span class="stringliteral">"index (clvl=%2d,cidx=%2d,kind=%2d) ==========\n"</span>,<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>,<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>,<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde0752a4477d57a28231801839cff95671">TSV_INDEX_STRING</a>) {
<a name="l00806"></a>00806     <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">dump_map</a>(<a class="code" href="classaffx_1_1_tsv_file_index.html#d1d91e785ab7b331d81b9ec54dcb6c72" title="map ofstring value to lines">m_index_str2line</a>);
<a name="l00807"></a>00807   }
<a name="l00808"></a>00808   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde39cd17e4abd754e8a89d12696f884dcd">TSV_INDEX_INT</a>) {
<a name="l00809"></a>00809     <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">dump_map</a>(<a class="code" href="classaffx_1_1_tsv_file_index.html#2542d33af9d4aee9942b533af41b60da" title="map of int values to lines">m_index_int2line</a>);
<a name="l00810"></a>00810   }
<a name="l00811"></a>00811   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fded10c38eff0744c579861fd8fc8d28be7">TSV_INDEX_DOUBLE</a>) {
<a name="l00812"></a>00812     <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">dump_map</a>(<a class="code" href="classaffx_1_1_tsv_file_index.html#b9cc5416c84aaae5cfc59dd6dbe561fc" title="map of double values to lines">m_index_double2line</a>);
<a name="l00813"></a>00813   }
<a name="l00814"></a>00814   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fdea1d767928435e2bd1ef9fc8a6c5648a0">TSV_INDEX_UINT</a>) {
<a name="l00815"></a>00815     <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">dump_map</a>(<a class="code" href="classaffx_1_1_tsv_file_index.html#d13fddeeaf1ab9b928ee500ed0ef11d1" title="map of unsigned int values to lines">m_index_uint2line</a>);
<a name="l00816"></a>00816   }
<a name="l00817"></a>00817   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde2508bed5b4f250e5a0ef3fc94b300130">TSV_INDEX_ULONGLONG</a>) {
<a name="l00818"></a>00818     <a class="code" href="classaffx_1_1_tsv_file_index.html#5737655cb5971112386119290aa8f7b8" title="Dump the contents of an index.">dump_map</a>(<a class="code" href="classaffx_1_1_tsv_file_index.html#ee5d4572614e4e077f1e2a3db49bba71" title="map of uint64_t values to lines">m_index_ulonglong2line</a>);
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820 }
<a name="l00821"></a>00821 
<a name="l00823"></a>00823 
<a name="l00825"></a><a class="code" href="classaffx_1_1_tsv_file_header_line.html#ab33abb52dba8ab5356b5c077c5b3f2a">00825</a> <a class="code" href="classaffx_1_1_tsv_file_header_line.html#ab33abb52dba8ab5356b5c077c5b3f2a" title="Init the slots of the object.">affx::TsvFileHeaderLine::TsvFileHeaderLine</a>()
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>=<span class="stringliteral">""</span>;
<a name="l00828"></a>00828   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a>=<span class="stringliteral">""</span>;
<a name="l00829"></a>00829   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>=0;
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00833"></a><a class="code" href="classaffx_1_1_tsv_file_header_line.html#947f9099cb65d0192a61a8bd13058c40">00833</a> <a class="code" href="classaffx_1_1_tsv_file_header_line.html#ab33abb52dba8ab5356b5c077c5b3f2a" title="Init the slots of the object.">affx::TsvFileHeaderLine::TsvFileHeaderLine</a>(std::string key,std::string value,<span class="keywordtype">int</span> order)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>=key;
<a name="l00836"></a>00836   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a>=value;
<a name="l00837"></a>00837   <a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>=order;
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 
<a name="l00841"></a>00841 <span class="keywordtype">bool</span>
<a name="l00842"></a><a class="code" href="classaffx_1_1_tsv_file_header_line.html#248edb82554d5f9b2a14e071ac846832">00842</a> <a class="code" href="classaffx_1_1_tsv_file_header_line.html#248edb82554d5f9b2a14e071ac846832" title="Less than operator for comparing TsvFileHeaderLines.">affx::TsvFileHeaderLine::operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFileHeaderLine</a>&amp; b)<span class="keyword"> const</span>
<a name="l00843"></a>00843 <span class="keyword"></span>{
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>==b.<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>) {
<a name="l00845"></a>00845     <span class="keywordflow">return</span> (<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>&lt;b.<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>);
<a name="l00846"></a>00846   }
<a name="l00847"></a>00847   <span class="keywordflow">return</span> (<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>&lt;b.<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>);
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 
<a name="l00851"></a>00851 <span class="keywordtype">bool</span>
<a name="l00852"></a><a class="code" href="namespaceaffx.html#17913c2098709057f108964add3841e6">00852</a> <a class="code" href="namespaceaffx.html#17913c2098709057f108964add3841e6" title="Function for comparing TsvFileHeaderLine pointers.">affx::header_ptr_less</a>(<span class="keyword">const</span> <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFileHeaderLine</a>* a,<span class="keyword">const</span> <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFileHeaderLine</a>* b)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854   <span class="comment">// sort nulls to the end</span>
<a name="l00855"></a>00855   <span class="keywordflow">if</span> ((a==NULL)&amp;&amp;(b==NULL)) {
<a name="l00856"></a>00856     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00857"></a>00857   }
<a name="l00858"></a>00858   <span class="keywordflow">if</span> (b==NULL) {
<a name="l00859"></a>00859     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861   <span class="keywordflow">if</span> (a==NULL) {
<a name="l00862"></a>00862     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00863"></a>00863   }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865   <span class="keywordflow">return</span> ((*a)&lt;(*b));
<a name="l00866"></a>00866 }
<a name="l00867"></a>00867 
<a name="l00869"></a>00869 
<a name="l00872"></a><a class="code" href="classaffx_1_1_tsv_file.html#d9995ed29856ffb1da0473b53098604c">00872</a> <a class="code" href="classaffx_1_1_tsv_file.html#d9995ed29856ffb1da0473b53098604c" title="Create and clear.">affx::TsvFile::TsvFile</a>()
<a name="l00873"></a>00873 {
<a name="l00874"></a>00874   <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l00875"></a>00875   <a class="code" href="classaffx_1_1_tsv_file.html#e2396be599b2000b3b42a1f652a86f4a" title="Resets the options to the defaults.">default_options</a>();
<a name="l00876"></a>00876 }
<a name="l00880"></a><a class="code" href="classaffx_1_1_tsv_file.html#acb48879f7488bca2cc82c7718f1d8ba">00880</a> <a class="code" href="classaffx_1_1_tsv_file.html#d9995ed29856ffb1da0473b53098604c" title="Create and clear.">affx::TsvFile::TsvFile</a>(std::string filename)
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882   <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l00883"></a>00883   <a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">open</a>(filename);
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00887"></a><a class="code" href="classaffx_1_1_tsv_file.html#679de4fb42a1e058f5d6587a648e14ff">00887</a> <a class="code" href="classaffx_1_1_tsv_file.html#d9995ed29856ffb1da0473b53098604c" title="Create and clear.">affx::TsvFile::TsvFile</a>(<span class="keyword">const</span> <a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; that)
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"Copy of TsvFile not allowed."</span>));
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 <span class="comment">// or an assigment.</span>
<a name="l00893"></a>00893 <span class="comment">//affx::TsvFile::TsvFile&amp; operator=(const affx::TsvFile&amp; that)</span>
<a name="l00894"></a>00894 <span class="comment">//{</span>
<a name="l00895"></a>00895 <span class="comment">//      Err::errAbort("TsvFile: Assigment of TsvFile not allowed.");</span>
<a name="l00896"></a>00896 <span class="comment">//      return *this;</span>
<a name="l00897"></a>00897 <span class="comment">//}</span>
<a name="l00898"></a>00898 
<a name="l00901"></a><a class="code" href="classaffx_1_1_tsv_file.html#9f35df4fab8fa00d47c43ef06992a579">00901</a> <a class="code" href="classaffx_1_1_tsv_file.html#9f35df4fab8fa00d47c43ef06992a579" title="Destroy a TsvFile.">affx::TsvFile::~TsvFile</a>()
<a name="l00902"></a>00902 {
<a name="l00903"></a>00903   <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>(); <span class="comment">// this will close the handle.</span>
<a name="l00904"></a>00904 }
<a name="l00905"></a>00905 
<a name="l00907"></a>00907 <span class="keywordtype">void</span>
<a name="l00908"></a><a class="code" href="classaffx_1_1_tsv_file.html#e2396be599b2000b3b42a1f652a86f4a">00908</a> <a class="code" href="classaffx_1_1_tsv_file.html#e2396be599b2000b3b42a1f652a86f4a" title="Resets the options to the defaults.">affx::TsvFile::default_options</a>()
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910   <a class="code" href="classaffx_1_1_tsv_file.html#fd8c4cd62d243dbc8dd6ac152fec7d65" title="Options which can be set. allow comments mixed in with data?">m_optAllowDataComment</a>=<span class="keyword">true</span>;
<a name="l00911"></a>00911   <a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>=<span class="keyword">true</span>;
<a name="l00912"></a>00912   <a class="code" href="classaffx_1_1_tsv_file.html#c617789f4c2845610f82cd41c0d04bc2" title="add more columns as needed.">m_optAutoColumns</a>=<span class="keyword">false</span>;
<a name="l00913"></a>00913   <a class="code" href="classaffx_1_1_tsv_file.html#aef4dd51e3fb11b8a8093d5080af1bc2" title="remove quotes when reading?">m_optAutoDequote</a>=<span class="keyword">true</span>;
<a name="l00914"></a>00914   <a class="code" href="classaffx_1_1_tsv_file.html#74be4efa43105437fa739c5dff0b6459" title="?">m_optAutoIndex</a>=<span class="keyword">true</span>;
<a name="l00915"></a>00915   <a class="code" href="classaffx_1_1_tsv_file.html#73f5e00e7784ece25072eff00ccc2015" title="Autosense between tabs and commas.">m_optAutoSenseSep</a>=<span class="keyword">true</span>;
<a name="l00916"></a>00916   <a class="code" href="classaffx_1_1_tsv_file.html#0b08c1eea21d4b6a893f57df16521a46" title="remove whitespace from value?">m_optAutoTrim</a>=<span class="keyword">false</span>;
<a name="l00917"></a>00917   <span class="comment">//m_optCommentChar='#';</span>
<a name="l00918"></a>00918   <a class="code" href="classaffx_1_1_tsv_file.html#4dccec8a785c650f376be8702043a984" title="Put quotes on output?">m_optDoQuote</a>=<span class="keyword">false</span>;
<a name="l00919"></a>00919   <a class="code" href="classaffx_1_1_tsv_file.html#8847f8471648053495d0a3f14004c8ae" title="the escape char to use">m_optEscapeChar</a>=<span class="charliteral">'\\'</span>;
<a name="l00920"></a>00920   <a class="code" href="classaffx_1_1_tsv_file.html#3104f733113db8733c335bf425c89a7f" title="Obey the escapechar?">m_optEscapeOk</a>=<span class="keyword">true</span>;
<a name="l00921"></a>00921   <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a>;
<a name="l00922"></a>00922   <a class="code" href="classaffx_1_1_tsv_file.html#f78f63d734799fb71378837d8ef94527" title="read the first line as column headers?">m_optHasColumnHeader</a>=<span class="keyword">true</span>;
<a name="l00923"></a>00923   <a class="code" href="classaffx_1_1_tsv_file.html#8818359ce7433b2d0d9bf1cbd3850306" title="Quote char to use.">m_optQuoteChar</a>=<span class="charliteral">'"'</span>;
<a name="l00924"></a>00924   <a class="code" href="classaffx_1_1_tsv_file.html#9675396a73fe00682c93a3d108d54d7e" title="?">m_optThrowOnError</a>=<span class="keyword">false</span>;
<a name="l00925"></a>00925   <a class="code" href="classaffx_1_1_tsv_file.html#089c5efc9860fa56096672366b0afc1d" title="End of line sequence to use.">m_optEndl</a>=<a class="code" href="_tsv_file_8cpp.html#b5bf1f987bbcb6e0ae190b58b9093c0d">TSV_EOL</a>;
<a name="l00926"></a>00926   <a class="code" href="classaffx_1_1_tsv_file.html#b8765c83cef722427a7b3759ce163732" title="Link variables when calling open().">m_optLinkVarsOnOpen</a> = <span class="keyword">true</span>;
<a name="l00927"></a>00927   <a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a> = <span class="stringliteral">"header"</span>;
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00932"></a>00932 <a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a>
<a name="l00933"></a><a class="code" href="classaffx_1_1_tsv_file.html#2446d70b9be5519f12cfa95b9633f920">00933</a> <a class="code" href="classaffx_1_1_tsv_file.html#2446d70b9be5519f12cfa95b9633f920" title="What line did we just read? (external).">affx::TsvFile::lineNumber</a>()
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935   <span class="comment">// line_num is the NEXT LINE to be read, so subtract one</span>
<a name="l00936"></a>00936   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>-1;
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00941"></a>00941 <span class="keywordtype">int</span>
<a name="l00942"></a><a class="code" href="classaffx_1_1_tsv_file.html#0bc68ccdf8993fd46b812c7743f8ab1d">00942</a> <a class="code" href="classaffx_1_1_tsv_file.html#0bc68ccdf8993fd46b812c7743f8ab1d" title="The indentation level of the line just read.">affx::TsvFile::lineLevel</a>()
<a name="l00943"></a>00943 {
<a name="l00944"></a>00944   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>;
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00950"></a>00950 <span class="keywordtype">int</span>
<a name="l00951"></a><a class="code" href="classaffx_1_1_tsv_file.html#5181dc6d3cc14f16325564481cd8fbe2">00951</a> <a class="code" href="classaffx_1_1_tsv_file.html#5181dc6d3cc14f16325564481cd8fbe2" title="Set the filename for this Tsv.">affx::TsvFile::setFilename</a>(std::string filename)
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953   <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>=filename;
<a name="l00954"></a>00954   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 
<a name="l00959"></a>00959 <span class="keywordtype">void</span>
<a name="l00960"></a><a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7">00960</a> <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">affx::TsvFile::clear</a>()
<a name="l00961"></a>00961 {
<a name="l00962"></a>00962   <span class="comment">// dispose of all the bindings.</span>
<a name="l00963"></a>00963   <a class="code" href="classaffx_1_1_tsv_file.html#22998fcabd807ea874ee58c37e224b15" title="Clear the bindings of columns to variables.">clearBindings</a>();
<a name="l00964"></a>00964   <span class="comment">// and the indexes</span>
<a name="l00965"></a>00965   <a class="code" href="classaffx_1_1_tsv_file.html#97194ae365bc8ef424ac9cd1928a0d49" title="Clear (ie delete) all the indexes.">clearIndexes</a>();
<a name="l00966"></a>00966   <span class="comment">// and the headers</span>
<a name="l00967"></a>00967   <a class="code" href="classaffx_1_1_tsv_file.html#e3c54fb2ea9d12e1345b6f96100b7169" title="clear all the headers.">clearHeaders</a>();
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   <span class="comment">//</span>
<a name="l00970"></a>00970   <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>=0;
<a name="l00971"></a>00971   <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>=0;
<a name="l00972"></a>00972   <a class="code" href="classaffx_1_1_tsv_file.html#aeaef7bc8e0d7ad6c99ecc164fd76e6f" title="Have the indexing been done?">m_index_done</a>=<span class="keyword">false</span>;
<a name="l00973"></a>00973   <span class="comment">// now get rid of the column info.</span>
<a name="l00974"></a>00974   <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.clear();
<a name="l00975"></a>00975   <a class="code" href="classaffx_1_1_tsv_file.html#12a32f0f033ed70cf187ca45de00fc1a" title="Map the columns names to column indexes.">cnametocidx_map</a>.clear();
<a name="l00976"></a>00976   <span class="comment">// and the file</span>
<a name="l00977"></a>00977   <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>.clear();
<a name="l00978"></a>00978   <span class="comment">// close the file</span>
<a name="l00979"></a>00979   <a class="code" href="classaffx_1_1_tsv_file.html#e7932be2156c04a562f327b53833aed7" title="Close the file.">close</a>();
<a name="l00980"></a>00980 }
<a name="l00981"></a>00981 
<a name="l00983"></a>00983 <span class="keywordtype">void</span>
<a name="l00984"></a><a class="code" href="classaffx_1_1_tsv_file.html#22998fcabd807ea874ee58c37e224b15">00984</a> <a class="code" href="classaffx_1_1_tsv_file.html#22998fcabd807ea874ee58c37e224b15" title="Clear the bindings of columns to variables.">affx::TsvFile::clearBindings</a>()
<a name="l00985"></a>00985 {
<a name="l00986"></a>00986   <span class="comment">// clear the linked vars in the columns</span>
<a name="l00987"></a>00987   <a class="code" href="classaffx_1_1_tsv_file.html#133f058f2360984318f649f52a39a384" title="clear all the linkages from columns to vars">linkvars_clear</a>();
<a name="l00988"></a>00988   <span class="comment">// release the memory of the vars</span>
<a name="l00989"></a>00989   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi=0;vi&lt;<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.size();vi++) {
<a name="l00990"></a>00990     <span class="keyword">delete</span> <a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[vi];
<a name="l00991"></a>00991   }
<a name="l00992"></a>00992   <span class="comment">// forget the pointers</span>
<a name="l00993"></a>00993   <a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.clear();
<a name="l00994"></a>00994   <span class="comment">// done because there arent any.</span>
<a name="l00995"></a>00995   <a class="code" href="classaffx_1_1_tsv_file.html#4702836f9d5426c3d0018a2b8d4b1781" title="The state of the bound and linked vars... Are the links up to date.">m_linkvars_done</a>=<span class="keyword">true</span>;
<a name="l00996"></a>00996 }
<a name="l00997"></a>00997 
<a name="l00999"></a>00999 <span class="keywordtype">void</span>
<a name="l01000"></a><a class="code" href="classaffx_1_1_tsv_file.html#97194ae365bc8ef424ac9cd1928a0d49">01000</a> <a class="code" href="classaffx_1_1_tsv_file.html#97194ae365bc8ef424ac9cd1928a0d49" title="Clear (ie delete) all the indexes.">affx::TsvFile::clearIndexes</a>()
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.size();i++) {
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i]!=NULL) {
<a name="l01004"></a>01004       <a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i]-&gt;clear();
<a name="l01005"></a>01005       <span class="keyword">delete</span> <a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007   }
<a name="l01008"></a>01008 }
<a name="l01009"></a>01009 
<a name="l01011"></a>01011 <span class="keywordtype">void</span>
<a name="l01012"></a><a class="code" href="classaffx_1_1_tsv_file.html#31aaf0d13dab55322b5c1904cca41cfe">01012</a> <a class="code" href="classaffx_1_1_tsv_file.html#31aaf0d13dab55322b5c1904cca41cfe" title="Clear all the fields. (set them all to null).">affx::TsvFile::clearFields</a>()
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014   <a class="code" href="classaffx_1_1_tsv_file.html#4b585c99e6fb12527745ac6a417eb3a1" title="Clear the columns at greater indents.">clearFieldsBelowClvl</a>(0);
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 
<a name="l01019"></a>01019 <span class="keywordtype">void</span>
<a name="l01020"></a><a class="code" href="classaffx_1_1_tsv_file.html#4b585c99e6fb12527745ac6a417eb3a1">01020</a> <a class="code" href="classaffx_1_1_tsv_file.html#4b585c99e6fb12527745ac6a417eb3a1" title="Clear the columns at greater indents.">affx::TsvFile::clearFieldsBelowClvl</a>(<span class="keywordtype">int</span> clvl_start)
<a name="l01021"></a>01021 {
<a name="l01022"></a>01022   assert(clvl_start&gt;=0);
<a name="l01023"></a>01023 
<a name="l01024"></a>01024   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size();
<a name="l01025"></a>01025   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=clvl_start;clvl&lt;clvl_size;clvl++) {
<a name="l01026"></a>01026     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cidx_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();
<a name="l01027"></a>01027     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cidx=0;cidx&lt;cidx_size;cidx++) {
<a name="l01028"></a>01028       <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].<a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l01029"></a>01029       <span class="comment">// dont zero out the linked vars -- while they should be zeroed,</span>
<a name="l01030"></a>01030       <span class="comment">// it takes time.</span>
<a name="l01031"></a>01031       <span class="comment">// m_column_map[clvl][cidx].linkedvars_assign();</span>
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01037"></a>01037 
<a name="l01041"></a>01041 <span class="keywordtype">int</span>
<a name="l01042"></a><a class="code" href="classaffx_1_1_tsv_file.html#8bcc35364ff6dcae62f5eb4e70adcff8">01042</a> <a class="code" href="classaffx_1_1_tsv_file.html#8bcc35364ff6dcae62f5eb4e70adcff8" title="Set the error value.">affx::TsvFile::setError</a>(<span class="keywordtype">int</span> err)
<a name="l01043"></a>01043 {
<a name="l01044"></a>01044   <span class="comment">//</span>
<a name="l01045"></a>01045   <a class="code" href="classaffx_1_1_tsv_file.html#ed8b9b98477207f8b6d4c307a8a27dc0" title="The error number.">m_errno</a>=err;
<a name="l01046"></a>01046   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#ed8b9b98477207f8b6d4c307a8a27dc0" title="The error number.">m_errno</a>==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01047"></a>01047     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#ed8b9b98477207f8b6d4c307a8a27dc0" title="The error number.">m_errno</a>;
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   <span class="comment">//</span>
<a name="l01051"></a>01051   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>==<span class="keyword">true</span>) {
<a name="l01052"></a>01052     assert(0);
<a name="l01053"></a>01053   }
<a name="l01054"></a>01054   <span class="comment">//</span>
<a name="l01055"></a>01055   <span class="keywordflow">return</span> err;
<a name="l01056"></a>01056 }
<a name="l01057"></a>01057 
<a name="l01060"></a>01060 <span class="keywordtype">int</span>
<a name="l01061"></a><a class="code" href="classaffx_1_1_tsv_file.html#14be5042ef572205846fbfbf477f1c5b">01061</a> <a class="code" href="classaffx_1_1_tsv_file.html#14be5042ef572205846fbfbf477f1c5b" title="clear the error">affx::TsvFile::clearError</a>()
<a name="l01062"></a>01062 {
<a name="l01063"></a>01063   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#8bcc35364ff6dcae62f5eb4e70adcff8" title="Set the error value.">setError</a>(<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>);
<a name="l01064"></a>01064 }
<a name="l01065"></a>01065 
<a name="l01068"></a>01068 <span class="keywordtype">int</span>
<a name="l01069"></a><a class="code" href="classaffx_1_1_tsv_file.html#fbb5bd46fc9200bf2acdca4c12827077">01069</a> <a class="code" href="classaffx_1_1_tsv_file.html#fbb5bd46fc9200bf2acdca4c12827077" title="Return the current error number.">affx::TsvFile::getError</a>()
<a name="l01070"></a>01070 {
<a name="l01071"></a>01071   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#ed8b9b98477207f8b6d4c307a8a27dc0" title="The error number.">m_errno</a>;
<a name="l01072"></a>01072 }
<a name="l01073"></a>01073 
<a name="l01075"></a>01075 
<a name="l01078"></a>01078 <span class="keywordtype">int</span>
<a name="l01079"></a><a class="code" href="classaffx_1_1_tsv_file.html#8ee65ed4ae51758f3474aa604f031508">01079</a> <a class="code" href="classaffx_1_1_tsv_file.html#8ee65ed4ae51758f3474aa604f031508" title="The level of the current line.">affx::TsvFile::line_level</a>()
<a name="l01080"></a>01080 {
<a name="l01081"></a>01081   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>;
<a name="l01082"></a>01082 }
<a name="l01083"></a>01083 
<a name="l01086"></a>01086 <a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a>
<a name="l01087"></a><a class="code" href="classaffx_1_1_tsv_file.html#235f0c1bb9bf21635417b8b63610c5b4">01087</a> <a class="code" href="classaffx_1_1_tsv_file.html#235f0c1bb9bf21635417b8b63610c5b4" title="The line number of the current line (internal).">affx::TsvFile::line_number</a>()
<a name="l01088"></a>01088 {
<a name="l01089"></a>01089   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>;
<a name="l01090"></a>01090 }
<a name="l01091"></a>01091 
<a name="l01094"></a>01094 <span class="keywordtype">int</span>
<a name="l01095"></a><a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102">01095</a> <a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">affx::TsvFile::getLevelCount</a>()
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size();
<a name="l01098"></a>01098 }
<a name="l01102"></a>01102 <span class="keywordtype">int</span>
<a name="l01103"></a><a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f">01103</a> <a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">affx::TsvFile::getColumnCount</a>(<span class="keywordtype">int</span> clvl)
<a name="l01104"></a>01104 {
<a name="l01105"></a>01105   <span class="keywordflow">if</span> ((clvl&gt;=0)&amp;&amp;(clvl&lt;(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size())) {
<a name="l01106"></a>01106     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();
<a name="l01107"></a>01107   }
<a name="l01108"></a>01108   <span class="keywordflow">return</span> 0;
<a name="l01109"></a>01109 }
<a name="l01110"></a>01110 
<a name="l01113"></a>01113 <span class="keywordtype">bool</span>
<a name="l01114"></a><a class="code" href="classaffx_1_1_tsv_file.html#71317671ce0632bb07c16d99550022a9">01114</a> <a class="code" href="classaffx_1_1_tsv_file.html#71317671ce0632bb07c16d99550022a9" title="Are we looking at the end of a line?">affx::TsvFile::f_lookingat_eol</a>()
<a name="l01115"></a>01115 {
<a name="l01116"></a>01116   <span class="keywordtype">int</span> c;
<a name="l01117"></a>01117   <span class="comment">// the end of a file is the end of a line.</span>
<a name="l01118"></a>01118   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l01119"></a>01119     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121   <span class="comment">//</span>
<a name="l01122"></a>01122   <span class="comment">//c=m_fileStream.peek();</span>
<a name="l01123"></a>01123   c=<a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>();
<a name="l01124"></a>01124   <span class="keywordflow">if</span> (c==EOF) {
<a name="l01125"></a>01125     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01126"></a>01126   }
<a name="l01127"></a>01127   <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>)) {
<a name="l01128"></a>01128     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01129"></a>01129   }
<a name="l01130"></a>01130   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01137"></a>01137 <span class="keywordtype">int</span>
<a name="l01138"></a><a class="code" href="classaffx_1_1_tsv_file.html#19d5e959bf44ce7b2a20a95002fcb27b">01138</a> <a class="code" href="classaffx_1_1_tsv_file.html#19d5e959bf44ce7b2a20a95002fcb27b" title="Read a line from a TsvFile into a string.">affx::TsvFile::f_getline</a>(std::string&amp; line)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140   <span class="keywordtype">int</span> c;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142   line.clear();
<a name="l01143"></a>01143   <span class="comment">// we have some sort of error</span>
<a name="l01144"></a>01144   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l01145"></a>01145     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148   <span class="keywordflow">while</span> (1) {
<a name="l01149"></a>01149     <span class="comment">// get a char...</span>
<a name="l01150"></a>01150     <span class="comment">//c=m_fileStream.get();</span>
<a name="l01151"></a>01151     c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l01152"></a>01152     <span class="comment">// eof?</span>
<a name="l01153"></a>01153     <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l01154"></a>01154       <span class="keywordflow">break</span>;
<a name="l01155"></a>01155     }
<a name="l01156"></a>01156     <span class="comment">// LF ends a line</span>
<a name="l01157"></a>01157     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>) {
<a name="l01158"></a>01158       <span class="keywordflow">break</span>;
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160     <span class="comment">// CR ends a line too.</span>
<a name="l01161"></a>01161     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>) {
<a name="l01162"></a>01162       <span class="comment">// c=m_fileStream.peek();</span>
<a name="l01163"></a>01163       c=<a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>();
<a name="l01164"></a>01164       <span class="comment">// CR could be followed by a LF</span>
<a name="l01165"></a>01165       <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>) {
<a name="l01166"></a>01166         <span class="comment">//c=m_fileStream.get();</span>
<a name="l01167"></a>01167         c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l01168"></a>01168         <span class="keywordflow">break</span>;
<a name="l01169"></a>01169       }
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171     <span class="comment">// push it on</span>
<a name="l01172"></a>01172     line.append(1,(<span class="keywordtype">char</span>)c);
<a name="l01173"></a>01173   }
<a name="l01174"></a>01174   <span class="comment">//</span>
<a name="l01175"></a>01175   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 
<a name="l01181"></a>01181 
<a name="l01183"></a>01183 <span class="keywordtype">void</span>
<a name="l01184"></a><a class="code" href="classaffx_1_1_tsv_file.html#e3c54fb2ea9d12e1345b6f96100b7169">01184</a> <a class="code" href="classaffx_1_1_tsv_file.html#e3c54fb2ea9d12e1345b6f96100b7169" title="clear all the headers.">affx::TsvFile::clearHeaders</a>()
<a name="l01185"></a>01185 {
<a name="l01186"></a>01186   <a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.clear();
<a name="l01187"></a>01187   <span class="comment">//</span>
<a name="l01188"></a>01188   <span class="keywordtype">int</span> v_size=(int)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l01189"></a>01189   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vi=0;vi&lt;v_size;vi++) {
<a name="l01190"></a>01190     <span class="keyword">delete</span> <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[vi];
<a name="l01191"></a>01191     <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[vi]=NULL;
<a name="l01192"></a>01192   }
<a name="l01193"></a>01193   <span class="comment">//</span>
<a name="l01194"></a>01194   <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.clear();
<a name="l01195"></a>01195   <span class="comment">// clear these too...</span>
<a name="l01196"></a>01196   <a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b" title="Start at the beginning of the headers.">headersBegin</a>();
<a name="l01197"></a>01197 }
<a name="l01198"></a>01198 
<a name="l01201"></a>01201 <span class="keywordtype">void</span>
<a name="l01202"></a><a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b">01202</a> <a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b" title="Start at the beginning of the headers.">affx::TsvFile::headersBegin</a>()
<a name="l01203"></a>01203 {
<a name="l01204"></a>01204   <a class="code" href="classaffx_1_1_tsv_file.html#c0bb213119962d8f3ea8fc0632b9fff0" title="Sort the headers of this TSV file by (order,key,value).">resortHeaders</a>();
<a name="l01205"></a>01205   <a class="code" href="classaffx_1_1_tsv_file.html#2beae603d212b76078a07e9bf93a741c">m_headers_idx</a>=0;
<a name="l01206"></a>01206   <a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.begin();
<a name="l01207"></a>01207   <a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>=NULL;
<a name="l01208"></a>01208   <a class="code" href="classaffx_1_1_tsv_file.html#555f9b8bd8333c26d9df7fdb98d0d46e">m_headers_curkey_string</a>=<span class="stringliteral">""</span>;
<a name="l01209"></a>01209 }
<a name="l01210"></a>01210 
<a name="l01212"></a>01212 <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">TsvFileHeaderLine</a>*
<a name="l01213"></a><a class="code" href="classaffx_1_1_tsv_file.html#8a11a4bb9b33060f394f738bad0b7cfe">01213</a> <a class="code" href="classaffx_1_1_tsv_file.html#8a11a4bb9b33060f394f738bad0b7cfe" title="Return the next non-null header pointer. NULL when at or past the end.">affx::TsvFile::nextHeaderPtr</a>()
<a name="l01214"></a>01214 {
<a name="l01215"></a>01215   <span class="keywordflow">while</span> (<a class="code" href="classaffx_1_1_tsv_file.html#2beae603d212b76078a07e9bf93a741c">m_headers_idx</a>&lt;(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size()) {
<a name="l01216"></a>01216     <a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>=<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[<a class="code" href="classaffx_1_1_tsv_file.html#2beae603d212b76078a07e9bf93a741c">m_headers_idx</a>++];
<a name="l01217"></a>01217     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>!=NULL) {
<a name="l01218"></a>01218       <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>;
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220   }
<a name="l01221"></a>01221   <a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>=NULL;
<a name="l01222"></a>01222   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>;
<a name="l01223"></a>01223 }
<a name="l01224"></a>01224 
<a name="l01229"></a>01229 <span class="keywordtype">int</span>
<a name="l01230"></a><a class="code" href="classaffx_1_1_tsv_file.html#b532a197f0935ba1b32d7f33540ce23b">01230</a> <a class="code" href="classaffx_1_1_tsv_file.html#b532a197f0935ba1b32d7f33540ce23b" title="Advance to the next header matching key.">affx::TsvFile::headersFindNext</a>(std::string key,std::string&amp; val)
<a name="l01231"></a>01231 {
<a name="l01232"></a>01232   <span class="comment">// if the key is different that the last, do an implicit begin</span>
<a name="l01233"></a>01233   <span class="keywordflow">if</span> (key!=<a class="code" href="classaffx_1_1_tsv_file.html#555f9b8bd8333c26d9df7fdb98d0d46e">m_headers_curkey_string</a>) {
<a name="l01234"></a>01234     <a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b" title="Start at the beginning of the headers.">headersBegin</a>();
<a name="l01235"></a>01235     <a class="code" href="classaffx_1_1_tsv_file.html#555f9b8bd8333c26d9df7fdb98d0d46e">m_headers_curkey_string</a>=key;
<a name="l01236"></a>01236     <a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.lower_bound(key);
<a name="l01237"></a>01237   }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="comment">// past the end of matching keys?</span>
<a name="l01240"></a>01240   <span class="keywordflow">if</span> ((<a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>==<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.end())||(<a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>-&gt;first!=key)) {
<a name="l01241"></a>01241     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39583ebef75cfbbe0ee92ff658274d39db5" title="Did not read a header line.">TSV_HEADER_LAST</a>;
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="comment">// what we are returning...</span>
<a name="l01245"></a>01245   val=<a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>-&gt;second-&gt;m_value;
<a name="l01246"></a>01246   <span class="comment">// point to the next one...</span>
<a name="l01247"></a>01247   <a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>++;
<a name="l01248"></a>01248   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01249"></a>01249 }
<a name="l01250"></a>01250 
<a name="l01255"></a>01255 <span class="keywordtype">int</span>
<a name="l01256"></a><a class="code" href="classaffx_1_1_tsv_file.html#86c80445dd06ed593e194f85e8ad8946">01256</a> <a class="code" href="classaffx_1_1_tsv_file.html#86c80445dd06ed593e194f85e8ad8946" title="Advance to the next header of the file and set the values.">affx::TsvFile::headersNext</a>(std::string&amp; key,std::string&amp; val)
<a name="l01257"></a>01257 {
<a name="l01258"></a>01258   <span class="comment">// skip comment headers</span>
<a name="l01259"></a>01259   <span class="keywordflow">do</span> {
<a name="l01260"></a>01260     <a class="code" href="classaffx_1_1_tsv_file.html#8a11a4bb9b33060f394f738bad0b7cfe" title="Return the next non-null header pointer. NULL when at or past the end.">nextHeaderPtr</a>();
<a name="l01261"></a>01261     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>==NULL) {
<a name="l01262"></a>01262       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39583ebef75cfbbe0ee92ff658274d39db5" title="Did not read a header line.">TSV_HEADER_LAST</a>;
<a name="l01263"></a>01263     }
<a name="l01264"></a>01264   } <span class="keywordflow">while</span> (<a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>==<span class="stringliteral">""</span>);
<a name="l01265"></a>01265 
<a name="l01266"></a>01266   key=<a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>;
<a name="l01267"></a>01267   val=<a class="code" href="classaffx_1_1_tsv_file.html#36c1d6c1a1b186b859a6bf6630a0fab1">m_headers_curptr</a>-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a>;
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   <span class="comment">// headers next should never return an empty key.</span>
<a name="l01270"></a>01270   assert(key!=<span class="stringliteral">""</span>);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01277"></a>01277 <span class="keywordtype">int</span>
<a name="l01278"></a><a class="code" href="classaffx_1_1_tsv_file.html#0d0a0c19a9531ef873f2f00ddda1b6d5">01278</a> <a class="code" href="classaffx_1_1_tsv_file.html#0d0a0c19a9531ef873f2f00ddda1b6d5" title="How many headers are there?">affx::TsvFile::headersCount</a>()
<a name="l01279"></a>01279 {
<a name="l01280"></a>01280   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l01281"></a>01281 }
<a name="l01282"></a>01282 
<a name="l01286"></a>01286 <span class="keywordtype">int</span>
<a name="l01287"></a><a class="code" href="classaffx_1_1_tsv_file.html#6d7fa43cb3c63790357f2be44ce1560e">01287</a> <a class="code" href="classaffx_1_1_tsv_file.html#6d7fa43cb3c63790357f2be44ce1560e" title="Is the key a legal key to have in a header?">affx::TsvFile::headerKeyLegal</a>(std::string key)
<a name="l01288"></a>01288 {
<a name="l01289"></a>01289   <span class="comment">// We dont allow '=' in the key</span>
<a name="l01290"></a>01290   <span class="keywordflow">if</span> (key.find(<span class="charliteral">'='</span>)!=std::string::npos) {
<a name="l01291"></a>01291     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l01292"></a>01292   }
<a name="l01293"></a>01293   <span class="comment">// Nor do we allow headers which start with "header" -- they are reserved</span>
<a name="l01294"></a>01294   <span class="keywordflow">if</span> ((key.size()==(<a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a>.length()+1))&amp;&amp;(key.find(<a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a>)==0)) {
<a name="l01295"></a>01295     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l01296"></a>01296   }
<a name="l01297"></a>01297   <span class="comment">// if not rejected it is ok...</span>
<a name="l01298"></a>01298   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01299"></a>01299 }
<a name="l01300"></a>01300 
<a name="l01305"></a>01305 <span class="keywordtype">int</span>
<a name="l01306"></a><a class="code" href="classaffx_1_1_tsv_file.html#b3ca5f32523d10c3852d6f89bcbd8919">01306</a> <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">affx::TsvFile::addHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keyword">const</span> std::string&amp; val)
<a name="l01307"></a>01307 {
<a name="l01308"></a>01308   <span class="comment">// should a copy be done here?</span>
<a name="l01309"></a>01309   <span class="comment">// might that be the source of the windows problems?</span>
<a name="l01310"></a>01310   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">addHeader</a>(key,val,(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size());
<a name="l01311"></a>01311 }
<a name="l01312"></a>01312 
<a name="l01318"></a>01318 <span class="keywordtype">int</span>
<a name="l01319"></a><a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557">01319</a> <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">affx::TsvFile::addHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keyword">const</span> std::string&amp; val,<span class="keywordtype">int</span> order)
<a name="l01320"></a>01320 {
<a name="l01321"></a>01321   <span class="keywordtype">int</span> rv;
<a name="l01322"></a>01322   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#6d7fa43cb3c63790357f2be44ce1560e" title="Is the key a legal key to have in a header?">headerKeyLegal</a>(key))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01323"></a>01323     <span class="keywordflow">return</span> rv;
<a name="l01324"></a>01324   }
<a name="l01325"></a>01325   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">addHeader_nocheck</a>(key,val,order);
<a name="l01326"></a>01326 }
<a name="l01327"></a>01327 
<a name="l01332"></a>01332 <span class="keywordtype">int</span>
<a name="l01333"></a><a class="code" href="classaffx_1_1_tsv_file.html#15c5f49c44b68b78b1875fa3e85ed921">01333</a> <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">affx::TsvFile::addHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keywordtype">int</span> val)
<a name="l01334"></a>01334 {
<a name="l01335"></a>01335   <span class="comment">// cast to a string and add it.</span>
<a name="l01336"></a>01336   std::ostringstream stream;
<a name="l01337"></a>01337   stream &lt;&lt; val;
<a name="l01338"></a>01338   <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">addHeader</a>(key,stream.str());
<a name="l01339"></a>01339   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01340"></a>01340 }
<a name="l01341"></a>01341 
<a name="l01346"></a>01346 <span class="keywordtype">int</span>
<a name="l01347"></a><a class="code" href="classaffx_1_1_tsv_file.html#ead7752ee3037bfe9bf04b513e1e0c61">01347</a> <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">affx::TsvFile::addHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keywordtype">double</span> val)
<a name="l01348"></a>01348 {
<a name="l01349"></a>01349   <span class="comment">// cast to a string and add it.</span>
<a name="l01350"></a>01350   std::ostringstream stream;
<a name="l01351"></a>01351   stream &lt;&lt; val;
<a name="l01352"></a>01352   <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">addHeader</a>(key,stream.str());
<a name="l01353"></a>01353   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01354"></a>01354 }
<a name="l01355"></a>01355 
<a name="l01360"></a>01360 <span class="keywordtype">int</span>
<a name="l01361"></a><a class="code" href="classaffx_1_1_tsv_file.html#58258f6510ea556a00ef2f0407cbf954">01361</a> <a class="code" href="classaffx_1_1_tsv_file.html#61507c236e19bcc0b2e6dcbdfd41716d" title="Add a comment to the headers.">affx::TsvFile::addHeaderComment</a>(std::string comment,<span class="keywordtype">int</span> order)
<a name="l01362"></a>01362 {
<a name="l01363"></a>01363   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">addHeader_nocheck</a>(<span class="stringliteral">""</span>,comment,order);
<a name="l01364"></a>01364 }
<a name="l01365"></a>01365 
<a name="l01370"></a>01370 <span class="keywordtype">int</span>
<a name="l01371"></a><a class="code" href="classaffx_1_1_tsv_file.html#61507c236e19bcc0b2e6dcbdfd41716d">01371</a> <a class="code" href="classaffx_1_1_tsv_file.html#61507c236e19bcc0b2e6dcbdfd41716d" title="Add a comment to the headers.">affx::TsvFile::addHeaderComment</a>(std::string comment)
<a name="l01372"></a>01372 {
<a name="l01373"></a>01373   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">addHeader_nocheck</a>(<span class="stringliteral">""</span>,comment,(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size());
<a name="l01374"></a>01374 }
<a name="l01375"></a>01375 
<a name="l01380"></a>01380 <span class="keywordtype">int</span>
<a name="l01381"></a><a class="code" href="classaffx_1_1_tsv_file.html#7f513992ac868961ffc406bd4fcb1d47">01381</a> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">affx::TsvFile::addHeader_nocheck</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keyword">const</span> std::string&amp; val)
<a name="l01382"></a>01382 {
<a name="l01383"></a>01383   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">addHeader_nocheck</a>(key,val,(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size());
<a name="l01384"></a>01384 }
<a name="l01385"></a>01385 
<a name="l01391"></a>01391 <span class="keywordtype">int</span>
<a name="l01392"></a><a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad">01392</a> <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">affx::TsvFile::addHeader_nocheck</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keyword">const</span> std::string&amp; val,<span class="keywordtype">int</span> order)
<a name="l01393"></a>01393 {
<a name="l01394"></a>01394   <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">TsvFileHeaderLine</a>* hdrptr=<span class="keyword">new</span> <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">TsvFileHeaderLine</a>(key,val,order);
<a name="l01395"></a>01395   <span class="comment">//</span>
<a name="l01396"></a>01396   <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.push_back(hdrptr);
<a name="l01397"></a>01397   <a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.insert(make_pair(key,hdrptr));
<a name="l01398"></a>01398   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01399"></a>01399 }
<a name="l01400"></a>01400 
<a name="l01405"></a>01405 <span class="keywordtype">int</span>
<a name="l01406"></a><a class="code" href="classaffx_1_1_tsv_file.html#085eb57e2a7d91aa8e9e47e748e1a2b1">01406</a> <a class="code" href="classaffx_1_1_tsv_file.html#085eb57e2a7d91aa8e9e47e748e1a2b1" title="Add all the headers from another TSV to this one.">affx::TsvFile::addHeadersFrom</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; f_tsv,<span class="keywordtype">int</span> flags)
<a name="l01407"></a>01407 {
<a name="l01408"></a>01408   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#085eb57e2a7d91aa8e9e47e748e1a2b1" title="Add all the headers from another TSV to this one.">addHeadersFrom</a>(f_tsv,<span class="stringliteral">""</span>,flags);
<a name="l01409"></a>01409 }
<a name="l01410"></a>01410 
<a name="l01416"></a>01416 <span class="keywordtype">int</span>
<a name="l01417"></a><a class="code" href="classaffx_1_1_tsv_file.html#d0164c1f84dfb95065dc88e42894fa73">01417</a> <a class="code" href="classaffx_1_1_tsv_file.html#085eb57e2a7d91aa8e9e47e748e1a2b1" title="Add all the headers from another TSV to this one.">affx::TsvFile::addHeadersFrom</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; f_tsv,std::string prefix,<span class="keywordtype">int</span> flags)
<a name="l01418"></a>01418 {
<a name="l01419"></a>01419   <span class="keywordtype">string</span> key;
<a name="l01420"></a>01420   <span class="keywordtype">string</span> val;
<a name="l01421"></a>01421 
<a name="l01422"></a>01422   f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#6aad66cac289e3eeed0bc06ba0e2587b" title="Start at the beginning of the headers.">headersBegin</a>();
<a name="l01423"></a>01423   <span class="keywordflow">while</span> (f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#86c80445dd06ed593e194f85e8ad8946" title="Advance to the next header of the file and set the values.">headersNext</a>(key,val)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01424"></a>01424     <span class="keywordflow">if</span> (key==<span class="stringliteral">""</span>) {
<a name="l01425"></a>01425       <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="namespaceaffx.html#9a97e91d3f603e3c6377f88592ff52844c407d040eff5cccc61660ec85872a0f" title="return keys">TSV_ADD_COMMENTS</a>)!=0) {
<a name="l01426"></a>01426         <a class="code" href="classaffx_1_1_tsv_file.html#61507c236e19bcc0b2e6dcbdfd41716d" title="Add a comment to the headers.">addHeaderComment</a>(val);
<a name="l01427"></a>01427       }
<a name="l01428"></a>01428     } <span class="keywordflow">else</span> {
<a name="l01429"></a>01429       <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="namespaceaffx.html#9a97e91d3f603e3c6377f88592ff52847733bcfccbc768c6fd6f5c6326b9d539" title="just for nothing...">TSV_ADD_KEYS</a>)!=0) {
<a name="l01430"></a>01430         <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">addHeader</a>(prefix+key,val);
<a name="l01431"></a>01431       }
<a name="l01432"></a>01432     }
<a name="l01433"></a>01433   }
<a name="l01434"></a>01434   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01435"></a>01435 }
<a name="l01436"></a>01436 
<a name="l01442"></a>01442 <span class="keywordtype">int</span>
<a name="l01443"></a><a class="code" href="classaffx_1_1_tsv_file.html#6f7ec39db5db37340a3d7e94289fa0d5">01443</a> <a class="code" href="classaffx_1_1_tsv_file.html#085eb57e2a7d91aa8e9e47e748e1a2b1" title="Add all the headers from another TSV to this one.">affx::TsvFile::addHeadersFrom</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; f_tsv,std::string prefix,std::vector&lt;std::string&gt;&amp; key_vec)
<a name="l01444"></a>01444 {
<a name="l01445"></a>01445   <span class="keywordtype">string</span> val;
<a name="l01446"></a>01446 
<a name="l01447"></a>01447   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;(int)key_vec.size();i++) {
<a name="l01448"></a>01448     <span class="keywordflow">if</span> (f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">getHeader</a>(key_vec[i],val)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01449"></a>01449       <a class="code" href="classaffx_1_1_tsv_file.html#11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order.">addHeader</a>(prefix+key_vec[i],val);
<a name="l01450"></a>01450     }
<a name="l01451"></a>01451   }
<a name="l01452"></a>01452   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01457"></a>01457 <span class="keywordtype">int</span>
<a name="l01458"></a><a class="code" href="classaffx_1_1_tsv_file.html#3ac3751d839b77e8e2dc696a93cc5b04">01458</a> <a class="code" href="classaffx_1_1_tsv_file.html#3ac3751d839b77e8e2dc696a93cc5b04" title="Note that the "headerN" lines may not have been generated yet.">affx::TsvFile::headerCount</a>()
<a name="l01459"></a>01459 {
<a name="l01460"></a>01460   <a class="code" href="classaffx_1_1_tsv_file.html#c0bb213119962d8f3ea8fc0632b9fff0" title="Sort the headers of this TSV file by (order,key,value).">resortHeaders</a>(); <span class="comment">// this removes null ptrs as well.</span>
<a name="l01461"></a>01461   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 
<a name="l01468"></a>01468 <span class="keywordtype">int</span>
<a name="l01469"></a><a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561">01469</a> <a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">affx::TsvFile::getHeader</a>(<span class="keyword">const</span> std::string&amp; key,std::string&amp; val)
<a name="l01470"></a>01470 {
<a name="l01471"></a>01471   <a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.find(key);
<a name="l01472"></a>01472   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#191ed09428efd37d2595959bc72fe8f8" title="used for headersNext">m_headers_iter</a>==<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.end()) {
<a name="l01473"></a>01473     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01474"></a>01474   }
<a name="l01475"></a>01475   val=(*m_headers_iter).second-&gt;m_value;
<a name="l01476"></a>01476   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01477"></a>01477 }
<a name="l01478"></a>01478 
<a name="l01483"></a>01483 <span class="keywordtype">int</span>
<a name="l01484"></a><a class="code" href="classaffx_1_1_tsv_file.html#562a9f37d8e19e26e86801815870e1ac">01484</a> <a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">affx::TsvFile::getHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keywordtype">int</span>&amp; val)
<a name="l01485"></a>01485 {
<a name="l01486"></a>01486   std::string tmp_str;
<a name="l01487"></a>01487   <span class="keywordtype">int</span> tmp_val;
<a name="l01488"></a>01488   <span class="keyword">const</span> <span class="keywordtype">char</span>* str_in;
<a name="l01489"></a>01489   <span class="keywordtype">char</span>* str_out;
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">getHeader</a>(key,tmp_str)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01492"></a>01492     str_in=tmp_str.c_str();
<a name="l01493"></a>01493     tmp_val=strtol(str_in,&amp;str_out,0);
<a name="l01494"></a>01494     <span class="keywordflow">if</span> (str_in==str_out) {
<a name="l01495"></a>01495       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>;
<a name="l01496"></a>01496     }
<a name="l01497"></a>01497     val=tmp_val;
<a name="l01498"></a>01498     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01499"></a>01499   }
<a name="l01500"></a>01500   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01501"></a>01501 }
<a name="l01502"></a>01502 
<a name="l01507"></a>01507 <span class="keywordtype">int</span>
<a name="l01508"></a><a class="code" href="classaffx_1_1_tsv_file.html#177a875854388fffa83a5be8018eb0c3">01508</a> <a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">affx::TsvFile::getHeader</a>(<span class="keyword">const</span> std::string&amp; key,<span class="keywordtype">double</span>&amp; val)
<a name="l01509"></a>01509 {
<a name="l01510"></a>01510   std::string tmp_str;
<a name="l01511"></a>01511   <span class="keywordtype">double</span> tmp_val;
<a name="l01512"></a>01512   <span class="keyword">const</span> <span class="keywordtype">char</span>* str_in;
<a name="l01513"></a>01513   <span class="keywordtype">char</span>* str_out;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">getHeader</a>(key,tmp_str)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01516"></a>01516     str_in=tmp_str.c_str();
<a name="l01517"></a>01517     tmp_val=strtod(str_in,&amp;str_out);
<a name="l01518"></a>01518     <span class="keywordflow">if</span> (str_in==str_out) {
<a name="l01519"></a>01519       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>;
<a name="l01520"></a>01520     }
<a name="l01521"></a>01521     val=tmp_val;
<a name="l01522"></a>01522     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01523"></a>01523   }
<a name="l01524"></a>01524   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01528"></a>01528 <span class="keywordtype">void</span>
<a name="l01529"></a><a class="code" href="classaffx_1_1_tsv_file.html#c0bb213119962d8f3ea8fc0632b9fff0">01529</a> <a class="code" href="classaffx_1_1_tsv_file.html#c0bb213119962d8f3ea8fc0632b9fff0" title="Sort the headers of this TSV file by (order,key,value).">affx::TsvFile::resortHeaders</a>()
<a name="l01530"></a>01530 {
<a name="l01531"></a>01531   <span class="comment">// put headers in order</span>
<a name="l01532"></a>01532   sort(<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.begin(),<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.end(),<a class="code" href="namespaceaffx.html#17913c2098709057f108964add3841e6" title="Function for comparing TsvFileHeaderLine pointers.">affx::header_ptr_less</a>);
<a name="l01533"></a>01533   <span class="comment">// removet trailing null pointers</span>
<a name="l01534"></a>01534   <span class="keywordtype">int</span> vi=(int)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l01535"></a>01535   <span class="keywordflow">while</span> ((vi&gt;0)&amp;&amp;(<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[vi-1]==NULL)) {
<a name="l01536"></a>01536     vi--;
<a name="l01537"></a>01537   }
<a name="l01538"></a>01538   <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.resize(vi);
<a name="l01539"></a>01539 }
<a name="l01540"></a>01540 
<a name="l01544"></a>01544 <span class="keywordtype">int</span>
<a name="l01545"></a><a class="code" href="classaffx_1_1_tsv_file.html#e7772b3bcb9a8d1d142db86563490c95">01545</a> <a class="code" href="classaffx_1_1_tsv_file.html#e7772b3bcb9a8d1d142db86563490c95" title="Remove the header pointed to.">affx::TsvFile::deleteHeaderPtr</a>(<a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFileHeaderLine</a>* hdrptr)
<a name="l01546"></a>01546 {
<a name="l01547"></a>01547   <span class="comment">// skip if done...</span>
<a name="l01548"></a>01548   <span class="keywordflow">if</span> (hdrptr==NULL) {
<a name="l01549"></a>01549     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01550"></a>01550   }
<a name="l01551"></a>01551   <span class="comment">// find the header ptrs in the map and erase them</span>
<a name="l01552"></a>01552   <a class="code" href="classaffx_1_1_tsv_file.html#e1c806c4b7707d7fc95c30291338643e">affx::TsvFile::header_iter_t</a> mi;
<a name="l01553"></a>01553   <span class="keywordflow">for</span> (mi=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.begin();mi!=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.end();mi++) {
<a name="l01554"></a>01554     <span class="keywordflow">if</span> ((*mi).second==hdrptr) {
<a name="l01555"></a>01555       <a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.erase(mi);
<a name="l01556"></a>01556     }
<a name="l01557"></a>01557   }
<a name="l01558"></a>01558   <span class="comment">// erase it from the vector</span>
<a name="l01559"></a>01559   <span class="keywordtype">int</span> v_size=(int)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l01560"></a>01560   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vi=0;vi&lt;v_size;vi++) {
<a name="l01561"></a>01561     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[vi]==hdrptr) {
<a name="l01562"></a>01562       <a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[vi]=NULL;
<a name="l01563"></a>01563        <span class="comment">// dealloc</span>
<a name="l01564"></a>01564       <span class="keyword">delete</span> hdrptr;
<a name="l01565"></a>01565       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01566"></a>01566     }
<a name="l01567"></a>01567   }
<a name="l01568"></a>01568   <span class="comment">// didnt find it in the list.</span>
<a name="l01569"></a>01569   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 
<a name="l01573"></a>01573 
<a name="l01577"></a>01577 <span class="keywordtype">int</span>
<a name="l01578"></a><a class="code" href="classaffx_1_1_tsv_file.html#88fdf554a86439c64e7427e084df938f">01578</a> <a class="code" href="classaffx_1_1_tsv_file.html#88fdf554a86439c64e7427e084df938f" title="Read a classic "v1" header from the top of a file.">affx::TsvFile::f_read_header_v1</a>()
<a name="l01579"></a>01579 {
<a name="l01580"></a>01580   <span class="keywordtype">int</span> rv;
<a name="l01581"></a>01581   std::string line;
<a name="l01582"></a>01582   std::vector&lt;std::string&gt; colname_vec;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#19d5e959bf44ce7b2a20a95002fcb27b" title="Read a line from a TsvFile into a string.">f_getline</a>(line))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01585"></a>01585     <span class="keywordflow">return</span> rv;
<a name="l01586"></a>01586   }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588   <span class="comment">// Try and sense what the fieldsep is?</span>
<a name="l01589"></a>01589   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#73f5e00e7784ece25072eff00ccc2015" title="Autosense between tabs and commas.">m_optAutoSenseSep</a>==<span class="keyword">true</span>) {
<a name="l01590"></a>01590     <span class="comment">// split on each</span>
<a name="l01591"></a>01591     std::vector&lt;std::string&gt; colname_tab_vec;
<a name="l01592"></a>01592     <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(line,<span class="charliteral">'\t'</span>,colname_tab_vec);
<a name="l01593"></a>01593     std::vector&lt;std::string&gt; colname_comma_vec;
<a name="l01594"></a>01594     <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(line,<span class="charliteral">','</span>,colname_comma_vec);
<a name="l01595"></a>01595     <span class="comment">//printf("auto: c=%d t=%d ",colname_comma_vec.size(),colname_tab_vec.size());</span>
<a name="l01596"></a>01596     <span class="comment">// Dont autosense if there are both separators present.</span>
<a name="l01597"></a>01597     <span class="keywordflow">if</span> ((colname_tab_vec.size()==1)&amp;&amp;(colname_comma_vec.size()&gt;0)) {
<a name="l01598"></a>01598       <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<span class="charliteral">','</span>;
<a name="l01599"></a>01599       <span class="comment">//printf("commas\n");</span>
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601     <span class="keywordflow">if</span> ((colname_comma_vec.size()==1)&amp;&amp;(colname_tab_vec.size()&gt;0)) {
<a name="l01602"></a>01602       <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<span class="charliteral">'\t'</span>;
<a name="l01603"></a>01603       <span class="comment">//printf("tabs\n");</span>
<a name="l01604"></a>01604     }
<a name="l01605"></a>01605   }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607   <span class="comment">// set the columns</span>
<a name="l01608"></a>01608   <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(line,<a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>,colname_vec);
<a name="l01609"></a>01609   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> col=0;col&lt;colname_vec.size();col++) {
<a name="l01610"></a>01610     <span class="comment">// discard quotes?</span>
<a name="l01611"></a>01611     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#aef4dd51e3fb11b8a8093d5080af1bc2" title="remove quotes when reading?">m_optAutoDequote</a>==<span class="keyword">true</span>) {
<a name="l01612"></a>01612       <a class="code" href="namespaceaffx.html#af1add79d80b3f2800698a791a26a2a6" title="Remove quotes from a string if they are matching.">dequote</a>(colname_vec[col]);
<a name="l01613"></a>01613     }
<a name="l01614"></a>01614     <span class="comment">//</span>
<a name="l01615"></a>01615     <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">defineColumn</a>(0,col,colname_vec[col]);
<a name="l01616"></a>01616   }
<a name="l01617"></a>01617   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01618"></a>01618 }
<a name="l01619"></a>01619 
<a name="l01621"></a>01621 <span class="keywordtype">int</span>
<a name="l01622"></a><a class="code" href="classaffx_1_1_tsv_file.html#937bc055bee36f5701b17bb54cebe55b">01622</a> <a class="code" href="classaffx_1_1_tsv_file.html#937bc055bee36f5701b17bb54cebe55b" title="Read and parse a v2 header line.">affx::TsvFile::f_read_header_v2</a>()
<a name="l01623"></a>01623 {
<a name="l01624"></a>01624   <span class="keywordtype">int</span> rv;
<a name="l01625"></a>01625   fstream::pos_type f_start;
<a name="l01626"></a>01626   <span class="keywordtype">string</span> line;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628   f_start=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.tellg();
<a name="l01629"></a>01629 
<a name="l01630"></a>01630   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#19d5e959bf44ce7b2a20a95002fcb27b" title="Read a line from a TsvFile into a string.">f_getline</a>(line))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01631"></a>01631     <span class="keywordflow">return</span> rv;
<a name="l01632"></a>01632   }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634   <span class="comment">// printf("header: %s\n",line.c_str());</span>
<a name="l01635"></a>01635 
<a name="l01636"></a>01636   <a class="code" href="namespaceaffx.html#9c9d69e0bcf728404dca5a3f8448c90d" title="Trim whitespace from the left of a string.">ltrim</a>(line);
<a name="l01637"></a>01637   <span class="comment">// "#%" An actual header line</span>
<a name="l01638"></a>01638   <span class="keywordflow">if</span> (line.find(<span class="stringliteral">"#%"</span>)==0) {
<a name="l01639"></a>01639     string::size_type pos_equal=line.find(<span class="stringliteral">"="</span>);
<a name="l01640"></a>01640     <span class="keywordflow">if</span> (pos_equal!=string::npos) {
<a name="l01641"></a>01641       <span class="keywordtype">string</span> key(line,2,pos_equal-2);
<a name="l01642"></a>01642       <span class="keywordtype">string</span> val(line,pos_equal+1);
<a name="l01643"></a>01643       <a class="code" href="namespaceaffx.html#54628348fb76ebbdb02a5b9aad4e720d" title="Trim whitespace from both sides of a string.">trim</a>(key);
<a name="l01644"></a>01644       <a class="code" href="namespaceaffx.html#fba51719c7e92c971c7dea4ba1bafd69" title="Trim whitespace from the right of a string.">rtrim</a>(val);
<a name="l01645"></a>01645       <span class="comment">// printf("key=%-20s val=%s\n",key.c_str(),val.c_str());</span>
<a name="l01646"></a>01646       <a class="code" href="classaffx_1_1_tsv_file.html#44fe8683f77734a401e307cd91445aad" title="Add a header to the TSV without checking to see if it is legal.">addHeader_nocheck</a>(key,val);
<a name="l01647"></a>01647       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395cc409e874e299f3b1fe1b69aff2ad32f" title="A header line was read.">TSV_HEADER</a>;
<a name="l01648"></a>01648     }
<a name="l01649"></a>01649     <span class="comment">// should print a warning.</span>
<a name="l01650"></a>01650     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l01651"></a>01651   }
<a name="l01652"></a>01652   <span class="comment">// skip the comment</span>
<a name="l01653"></a>01653   <span class="keywordflow">if</span> (line.find(<span class="stringliteral">"#"</span>)==0) {
<a name="l01654"></a>01654     <a class="code" href="classaffx_1_1_tsv_file.html#61507c236e19bcc0b2e6dcbdfd41716d" title="Add a comment to the headers.">addHeaderComment</a>(<span class="keywordtype">string</span>(line,1));
<a name="l01655"></a>01655     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395cc409e874e299f3b1fe1b69aff2ad32f" title="A header line was read.">TSV_HEADER</a>;
<a name="l01656"></a>01656   }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658   <span class="comment">// not a header line - skip back to start of line to read as data</span>
<a name="l01659"></a>01659   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(f_start);
<a name="l01660"></a>01660   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39583ebef75cfbbe0ee92ff658274d39db5" title="Did not read a header line.">TSV_HEADER_LAST</a>;
<a name="l01661"></a>01661 }
<a name="l01662"></a>01662 
<a name="l01665"></a>01665 <span class="keywordtype">int</span>
<a name="l01666"></a><a class="code" href="classaffx_1_1_tsv_file.html#c3d84299f0ce394df5b5b9fe60c3de34">01666</a> <a class="code" href="classaffx_1_1_tsv_file.html#c3d84299f0ce394df5b5b9fe60c3de34" title="Read all the headers and set up the file.">affx::TsvFile::f_read_headers</a>()
<a name="l01667"></a>01667 {
<a name="l01668"></a>01668   <span class="comment">// skip to start of file.</span>
<a name="l01669"></a>01669   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(0);
<a name="l01670"></a>01670 
<a name="l01671"></a>01671   <span class="comment">// suck in all the v2 headers</span>
<a name="l01672"></a>01672   <span class="keywordflow">while</span> (<a class="code" href="classaffx_1_1_tsv_file.html#937bc055bee36f5701b17bb54cebe55b" title="Read and parse a v2 header line.">f_read_header_v2</a>()==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395cc409e874e299f3b1fe1b69aff2ad32f" title="A header line was read.">TSV_HEADER</a>) {
<a name="l01673"></a>01673     <span class="comment">// null body</span>
<a name="l01674"></a>01674   }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676   <span class="comment">//dump_headers();</span>
<a name="l01677"></a>01677 
<a name="l01678"></a>01678   <span class="comment">// If we dont have any headers at all, then the first line has the header</span>
<a name="l01679"></a>01679   <span class="comment">// read its header line.</span>
<a name="l01680"></a>01680   std::string ignored;
<a name="l01681"></a>01681   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#1c855112ab7f6e4edd1ec25ffd574561" title="Get the value of a header.">getHeader</a>(<a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a>+<span class="stringliteral">"0"</span>,ignored)!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01682"></a>01682     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#f78f63d734799fb71378837d8ef94527" title="read the first line as column headers?">m_optHasColumnHeader</a>==<span class="keyword">true</span>) {
<a name="l01683"></a>01683       <a class="code" href="classaffx_1_1_tsv_file.html#e5addb1c71bd98704ed8f9c381ca5797" title="What version of file was read?">m_fileFormat</a>=<a class="code" href="namespaceaffx.html#eda26073e51acea0f95c3acde01c76ed1ad4ef1b80aac20542a3f6b8279ceb81">TSV_FORMAT_V1</a>;
<a name="l01684"></a>01684       <a class="code" href="classaffx_1_1_tsv_file.html#88fdf554a86439c64e7427e084df938f" title="Read a classic "v1" header from the top of a file.">f_read_header_v1</a>();
<a name="l01685"></a>01685     } <span class="keywordflow">else</span> {
<a name="l01686"></a>01686       <a class="code" href="classaffx_1_1_tsv_file.html#e5addb1c71bd98704ed8f9c381ca5797" title="What version of file was read?">m_fileFormat</a>=<a class="code" href="namespaceaffx.html#eda26073e51acea0f95c3acde01c76edf54bde67514d825416e9dbc666201d1d">TSV_FORMAT_TABLE</a>;
<a name="l01687"></a>01687     }
<a name="l01688"></a>01688   } <span class="keywordflow">else</span> {
<a name="l01689"></a>01689     <a class="code" href="classaffx_1_1_tsv_file.html#e5addb1c71bd98704ed8f9c381ca5797" title="What version of file was read?">m_fileFormat</a>=<a class="code" href="namespaceaffx.html#eda26073e51acea0f95c3acde01c76ed9f549c6c6b901a8864ae37b2e8070c31">TSV_FORMAT_V2</a>;
<a name="l01690"></a>01690     <a class="code" href="classaffx_1_1_tsv_file.html#ab993b0259a6b6690437cadc65eaaffd" title="Parse the "headerN" lines.">headers_to_fields_v2</a>();
<a name="l01691"></a>01691   }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693   <span class="comment">// The rest of the file is data.</span>
<a name="l01694"></a>01694   <a class="code" href="classaffx_1_1_tsv_file.html#91f786ef3961abdb2a6f723a56072167" title="Where the data begins (line 0).">m_fileDataPos</a>=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.tellg();
<a name="l01695"></a>01695   <span class="comment">// sets line counters</span>
<a name="l01696"></a>01696   <a class="code" href="classaffx_1_1_tsv_file.html#05d594ceb54634fb1f39ca768276800e" title="Rewind back to the start of the data and clear the fields.">rewind</a>();
<a name="l01697"></a>01697 
<a name="l01698"></a>01698   <span class="comment">//dump_bindings();</span>
<a name="l01699"></a>01699   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01700"></a>01700 }
<a name="l01701"></a>01701 
<a name="l01703"></a>01703 <span class="keywordtype">void</span>
<a name="l01704"></a><a class="code" href="classaffx_1_1_tsv_file.html#ab993b0259a6b6690437cadc65eaaffd">01704</a> <a class="code" href="classaffx_1_1_tsv_file.html#ab993b0259a6b6690437cadc65eaaffd" title="Parse the "headerN" lines.">affx::TsvFile::headers_to_fields_v2</a>()
<a name="l01705"></a>01705 {
<a name="l01706"></a>01706   <span class="comment">// now set up mappings</span>
<a name="l01707"></a>01707   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;9;clvl++) {
<a name="l01708"></a>01708     <span class="keywordtype">string</span> head_name=<a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a>;
<a name="l01709"></a>01709     head_name.append(1,(<span class="keywordtype">char</span>)(<span class="charliteral">'0'</span>+clvl)); <span class="comment">// +"num"</span>
<a name="l01710"></a>01710     <a class="code" href="classaffx_1_1_tsv_file.html#e1c806c4b7707d7fc95c30291338643e">affx::TsvFile::header_iter_t</a> i=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.find(head_name);
<a name="l01711"></a>01711     <span class="keywordflow">if</span> (i!=<a class="code" href="classaffx_1_1_tsv_file.html#3718610391b1d985a35123c4db2168ef" title="the key=val headers in string form.">m_headers_bykey</a>.end()) {
<a name="l01713"></a>01713       vector&lt;string&gt; colname_vec;
<a name="l01714"></a>01714       <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(i-&gt;second-&gt;m_value,<a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>,colname_vec);
<a name="l01715"></a>01715       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> col=0;col&lt;colname_vec.size();col++) {
<a name="l01716"></a>01716         <span class="keywordflow">if</span> (col&lt;clvl) {
<a name="l01717"></a>01717           <span class="keywordflow">if</span> (colname_vec[col]!=<span class="stringliteral">""</span>) {
<a name="l01718"></a>01718             <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">"==Warning: level="</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(clvl) + <span class="stringliteral">" col="</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(col) +
<a name="l01719"></a>01719                          <span class="stringliteral">" name="</span> + colname_vec[col] +<span class="stringliteral">" not indended correctly=="</span>);
<a name="l01720"></a>01720 <span class="comment">//             printf("==Warning: level=%d col=%d name='%s' not indended correctly\n",</span>
<a name="l01721"></a>01721 <span class="comment">//                    clvl,col,colname_vec[col].c_str());</span>
<a name="l01722"></a>01722           }
<a name="l01723"></a>01723         } <span class="keywordflow">else</span> {
<a name="l01724"></a>01724           <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">defineColumn</a>(clvl,col-clvl,colname_vec[col]);
<a name="l01725"></a>01725         }
<a name="l01726"></a>01726       }
<a name="l01727"></a>01727     }
<a name="l01728"></a>01728   }
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01732"></a>01732 
<a name="l01738"></a>01738 <span class="keywordtype">int</span>
<a name="l01739"></a><a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6">01739</a> <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">affx::TsvFile::defineColumn</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,std::string cname)
<a name="l01740"></a>01740 {
<a name="l01741"></a>01741   <span class="keywordflow">if</span> (clvl&lt;0) {
<a name="l01742"></a>01742     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l01743"></a>01743   }
<a name="l01744"></a>01744   <span class="comment">//printf("colname_set(%d,'%s',%d)\n",clvl,cname.c_str(),cidx); //</span>
<a name="l01745"></a>01745   <span class="keywordflow">if</span> (clvl&gt;=(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size()) {
<a name="l01746"></a>01746     <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.resize(clvl+1);
<a name="l01747"></a>01747     <a class="code" href="classaffx_1_1_tsv_file.html#12a32f0f033ed70cf187ca45de00fc1a" title="Map the columns names to column indexes.">cnametocidx_map</a>.resize(clvl+1);
<a name="l01748"></a>01748   }
<a name="l01749"></a>01749   <span class="comment">// expand the width if needed.</span>
<a name="l01750"></a>01750   <span class="keywordflow">if</span> (cidx&gt;=(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size()) {
<a name="l01751"></a>01751     <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].resize(cidx+1);
<a name="l01752"></a>01752   }
<a name="l01753"></a>01753   <span class="comment">// record info about this column</span>
<a name="l01754"></a>01754   <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_clvl=clvl;
<a name="l01755"></a>01755   <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_cidx=cidx;
<a name="l01756"></a>01756   <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_cname=cname;
<a name="l01757"></a>01757   <span class="comment">// map cname to cidx</span>
<a name="l01758"></a>01758   <a class="code" href="classaffx_1_1_tsv_file.html#12a32f0f033ed70cf187ca45de00fc1a" title="Map the columns names to column indexes.">cnametocidx_map</a>[clvl][cname]=cidx;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760   <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>);
<a name="l01761"></a>01761 }
<a name="l01762"></a>01762 
<a name="l01767"></a>01767 <span class="keywordtype">int</span>
<a name="l01768"></a><a class="code" href="classaffx_1_1_tsv_file.html#2e691e614c37b1adcd2daeffd91bfc65">01768</a> <a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">affx::TsvFile::cname2cidx</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; cname)
<a name="l01769"></a>01769 {
<a name="l01770"></a>01770   <span class="keywordflow">if</span> ((clvl&lt;0)||(clvl&gt;=(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size())) {
<a name="l01771"></a>01771     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>); <span class="comment">// the error codes are negative values</span>
<a name="l01772"></a>01772   }
<a name="l01773"></a>01773   map&lt;string,int&gt;::iterator i;
<a name="l01774"></a>01774   i=<a class="code" href="classaffx_1_1_tsv_file.html#12a32f0f033ed70cf187ca45de00fc1a" title="Map the columns names to column indexes.">cnametocidx_map</a>[clvl].find(cname);
<a name="l01775"></a>01775   <span class="keywordflow">if</span> (i==<a class="code" href="classaffx_1_1_tsv_file.html#12a32f0f033ed70cf187ca45de00fc1a" title="Map the columns names to column indexes.">cnametocidx_map</a>[clvl].end()) {
<a name="l01776"></a>01776     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l01777"></a>01777   }
<a name="l01778"></a>01778   <span class="keywordflow">return</span> ((*i).second);
<a name="l01779"></a>01779 }
<a name="l01780"></a>01780 
<a name="l01781"></a><a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">01781</a> <span class="preprocessor">#define CNAME_FIND(name) { int rv; rv=cname2cidx(clvl,name); if (rv&gt;=0) { return rv; } }</span>
<a name="l01782"></a>01782 <span class="preprocessor"></span>
<a name="l01788"></a>01788 <span class="keywordtype">int</span>
<a name="l01789"></a><a class="code" href="classaffx_1_1_tsv_file.html#7b073b72e876c37ac7cbaca5316ce8b1">01789</a> <a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">affx::TsvFile::cname2cidx</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; alias1,<span class="keyword">const</span> std::string&amp; alias2)
<a name="l01790"></a>01790 {
<a name="l01791"></a>01791   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias1);
<a name="l01792"></a>01792   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias2);
<a name="l01793"></a>01793   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01794"></a>01794 }
<a name="l01801"></a>01801 <span class="keywordtype">int</span>
<a name="l01802"></a><a class="code" href="classaffx_1_1_tsv_file.html#0797ffac1b79408c7fb6ac88823adf1f">01802</a> <a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">affx::TsvFile::cname2cidx</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; alias1,<span class="keyword">const</span> std::string&amp; alias2,<span class="keyword">const</span> std::string&amp; alias3)
<a name="l01803"></a>01803 {
<a name="l01804"></a>01804   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias1);
<a name="l01805"></a>01805   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias2);
<a name="l01806"></a>01806   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias3);
<a name="l01807"></a>01807   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01808"></a>01808 }
<a name="l01816"></a>01816 <span class="keywordtype">int</span>
<a name="l01817"></a><a class="code" href="classaffx_1_1_tsv_file.html#85ea6ace84fbe798dd0a859d7392efa6">01817</a> <a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">affx::TsvFile::cname2cidx</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; alias1,<span class="keyword">const</span> std::string&amp; alias2,<span class="keyword">const</span> std::string&amp; alias3,<span class="keyword">const</span> std::string&amp; alias4)
<a name="l01818"></a>01818 {
<a name="l01819"></a>01819   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias1);
<a name="l01820"></a>01820   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias2);
<a name="l01821"></a>01821   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias3);
<a name="l01822"></a>01822   <a class="code" href="_tsv_file_8cpp.html#b24ba34d45d947869cbfb5e0e047cd9c">CNAME_FIND</a>(alias4);
<a name="l01823"></a>01823   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>;
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a>01826 
<a name="l01832"></a>01832 <span class="keywordtype">int</span>
<a name="l01833"></a><a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500">01833</a> <a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">affx::TsvFile::cname2cidx</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx)
<a name="l01834"></a>01834 {
<a name="l01835"></a>01835   <span class="keywordflow">return</span> cidx;
<a name="l01836"></a>01836 }
<a name="l01837"></a>01837 
<a name="l01839"></a>01839 
<a name="l01844"></a>01844 <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>*
<a name="l01845"></a><a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf">01845</a> <a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">affx::TsvFile::clvlcidx2colptr</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx) {
<a name="l01846"></a>01846   <span class="keywordflow">if</span> ((clvl&lt;0)||
<a name="l01847"></a>01847       (clvl&gt;=(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size())||
<a name="l01848"></a>01848       (cidx&lt;0)||
<a name="l01849"></a>01849       (cidx&gt;=(int)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size())) {
<a name="l01850"></a>01850     <span class="keywordflow">return</span> NULL;
<a name="l01851"></a>01851   }
<a name="l01852"></a>01852   <span class="keywordflow">return</span> &amp;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx];
<a name="l01853"></a>01853 }
<a name="l01854"></a>01854 
<a name="l01859"></a>01859 <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>*
<a name="l01860"></a><a class="code" href="classaffx_1_1_tsv_file.html#1926df2ad34435d67d7c900e5195ed26">01860</a> <a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">affx::TsvFile::clvlcidx2colptr</a>(<span class="keywordtype">int</span> clvl,std::string cname) {
<a name="l01861"></a>01861   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,<a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">cname2cidx</a>(clvl,cname));
<a name="l01862"></a>01862 }
<a name="l01863"></a>01863 
<a name="l01869"></a>01869 <span class="keywordtype">int</span>
<a name="l01870"></a><a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b">01870</a> <a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b" title="Get the name of a column by its level and index.">affx::TsvFile::cidx2cname</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,std::string&amp; cname)
<a name="l01871"></a>01871 {
<a name="l01872"></a>01872   <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* colptr=<a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,cidx);
<a name="l01873"></a>01873   <span class="keywordflow">if</span> (colptr==NULL) {
<a name="l01874"></a>01874     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l01875"></a>01875   }
<a name="l01876"></a>01876   cname=colptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#88acb25bb18e23c3e076c64628f61d08" title="Column name. (Could be blank).">m_cname</a>;
<a name="l01877"></a>01877   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880 <span class="keywordtype">int</span>
<a name="l01881"></a><a class="code" href="classaffx_1_1_tsv_file.html#288146e9d76196c7a6b84d65cd428a3d">01881</a> <a class="code" href="classaffx_1_1_tsv_file.html#0e6698f4828f9182227ca7d2964a8f3e">affx::TsvFile::setPrecision</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span> places)
<a name="l01882"></a>01882 {
<a name="l01883"></a>01883   <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* colptr=<a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,cidx);
<a name="l01884"></a>01884   <span class="keywordflow">if</span> (colptr==NULL) {
<a name="l01885"></a>01885     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l01886"></a>01886   }
<a name="l01887"></a>01887   <span class="keywordflow">return</span> colptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#53ce0151fd54a224b2b67d6423271837">setPrecision</a>(places);
<a name="l01888"></a>01888 }
<a name="l01889"></a>01889 
<a name="l01890"></a>01890 <span class="keywordtype">int</span>
<a name="l01891"></a><a class="code" href="classaffx_1_1_tsv_file.html#0e6698f4828f9182227ca7d2964a8f3e">01891</a> <a class="code" href="classaffx_1_1_tsv_file.html#0e6698f4828f9182227ca7d2964a8f3e">affx::TsvFile::setPrecision</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; cname,<span class="keywordtype">int</span> places)
<a name="l01892"></a>01892 {
<a name="l01893"></a>01893   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#0e6698f4828f9182227ca7d2964a8f3e">setPrecision</a>(clvl,<a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">cname2cidx</a>(clvl,cname),places);
<a name="l01894"></a>01894 }
<a name="l01895"></a>01895 
<a name="l01897"></a>01897 
<a name="l01901"></a>01901 <span class="keywordtype">int</span>
<a name="l01902"></a><a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e">01902</a> <a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">affx::TsvFile::open</a>(std::string fname)
<a name="l01903"></a>01903 {
<a name="l01904"></a>01904   <span class="keywordtype">int</span> rv;
<a name="l01905"></a>01905 
<a name="l01906"></a>01906   <a class="code" href="classaffx_1_1_tsv_file.html#e7932be2156c04a562f327b53833aed7" title="Close the file.">close</a>();
<a name="l01907"></a>01907   <span class="comment">// remeber the name</span>
<a name="l01908"></a>01908   <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>=fname;
<a name="l01909"></a>01909   <span class="comment">//</span>
<a name="l01910"></a>01910   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>.empty()) {
<a name="l01911"></a>01911     <span class="comment">// @todo thow an exception</span>
<a name="l01912"></a>01912     <span class="comment">//assert(0);</span>
<a name="l01913"></a>01913     <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"Cant open an empty filename."</span>)+<span class="stringliteral">" (filename='"</span>+fname+<span class="stringliteral">"')"</span>);
<a name="l01914"></a>01914   }
<a name="l01915"></a>01915 
<a name="l01916"></a>01916   <span class="comment">// clear before opening -- errors are sticky.</span>
<a name="l01917"></a>01917   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.clear();
<a name="l01918"></a>01918   <span class="comment">// hello?!?</span>
<a name="l01919"></a>01919   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.open(<a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>.c_str(),std::fstream::in|std::fstream::binary);
<a name="l01920"></a>01920   <span class="comment">// Check an error opening the file.</span>
<a name="l01921"></a>01921   <span class="keywordflow">if</span>(!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.is_open() || !<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l01922"></a>01922     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>) {
<a name="l01923"></a>01923       <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<a class="code" href="_tsv_file_8cpp.html#0cfaa5f239304f6f279823bdb6bf526f">TSV_ERR_AT</a>(<span class="stringliteral">"open: "</span>)+<span class="stringliteral">"Could not open file: '"</span> + <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a> + <span class="stringliteral">"' to read."</span>);
<a name="l01924"></a>01924     }
<a name="l01925"></a>01925     <span class="keywordflow">else</span> {
<a name="l01926"></a>01926       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928   }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930   <span class="comment">// now throw an exception if something really bad happens.</span>
<a name="l01931"></a>01931   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.exceptions(ios_base::badbit|ios_base::failbit);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 <span class="preprocessor">#ifdef TSV_USE_RDBUF</span>
<a name="l01934"></a>01934 <span class="preprocessor"></span>  <span class="comment">// This appears to be faster than calling ".get()"</span>
<a name="l01935"></a>01935   <a class="code" href="classaffx_1_1_tsv_file.html#8afe2eda9503762e5f89ede00420fd87">m_rdbuf</a>=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.rdbuf();
<a name="l01936"></a>01936 <span class="preprocessor">#endif</span>
<a name="l01937"></a>01937 <span class="preprocessor"></span>
<a name="l01938"></a>01938   <span class="comment">//printf("### opening: '%s' (rdstate=%4d,%s)...\n",</span>
<a name="l01939"></a>01939   <span class="comment">//       m_fileName.c_str(),</span>
<a name="l01940"></a>01940   <span class="comment">//       m_fileStream.rdstate(),</span>
<a name="l01941"></a>01941   <span class="comment">//       (m_fileStream.good()?"good":"not good"));</span>
<a name="l01942"></a>01942   <span class="comment">//file_buf=m_fileStream.rdbuf();</span>
<a name="l01943"></a>01943   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l01944"></a>01944     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l01945"></a>01945   }
<a name="l01946"></a>01946 
<a name="l01947"></a>01947   <span class="comment">// parse the headers</span>
<a name="l01948"></a>01948   <a class="code" href="classaffx_1_1_tsv_file.html#c3d84299f0ce394df5b5b9fe60c3de34" title="Read all the headers and set up the file.">f_read_headers</a>();
<a name="l01949"></a>01949 
<a name="l01950"></a>01950   <span class="comment">// establish the links</span>
<a name="l01951"></a>01951   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#b8765c83cef722427a7b3759ce163732" title="Link variables when calling open().">m_optLinkVarsOnOpen</a>) {
<a name="l01952"></a>01952     rv=<a class="code" href="classaffx_1_1_tsv_file.html#4fc095a3879e307016a7b0510c79b037" title="Is the format of the file ok.">formatOk</a>();
<a name="l01953"></a>01953     <span class="keywordflow">if</span> (rv!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l01954"></a>01954       <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">"TSV: warning: '"</span> + fname + <span class="stringliteral">"': bad format (="</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(rv) + <span class="stringliteral">")"</span>);
<a name="l01955"></a>01955       <span class="comment">//    printf("TSV: warning: '%s': bad format (=%d)\n",fname.c_str(),rv);</span>
<a name="l01956"></a>01956     }
<a name="l01957"></a>01957   }
<a name="l01958"></a>01958 
<a name="l01959"></a>01959   <span class="comment">// redudant with above?</span>
<a name="l01960"></a>01960   <a class="code" href="classaffx_1_1_tsv_file.html#202ae12e0ea6c845e74de9f162d03c6d" title="Dont do anything if the linkages are done, otherwise link.">linkvars_maybe</a>();
<a name="l01961"></a>01961 
<a name="l01962"></a>01962   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l01963"></a>01963 }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965 
<a name="l01969"></a>01969 <span class="keywordtype">int</span>
<a name="l01970"></a><a class="code" href="classaffx_1_1_tsv_file.html#b255f20cbf496416a23ea94d6c55d3e0">01970</a> <a class="code" href="classaffx_1_1_tsv_file.html#b255f20cbf496416a23ea94d6c55d3e0" title="Opens a file as a table.">affx::TsvFile::openTable</a>(std::string fname)
<a name="l01971"></a>01971 {
<a name="l01972"></a>01972   <a class="code" href="classaffx_1_1_tsv_file.html#f78f63d734799fb71378837d8ef94527" title="read the first line as column headers?">m_optHasColumnHeader</a>=<span class="keyword">false</span>;
<a name="l01973"></a>01973   <a class="code" href="classaffx_1_1_tsv_file.html#c617789f4c2845610f82cd41c0d04bc2" title="add more columns as needed.">m_optAutoColumns</a>=<span class="keyword">true</span>;
<a name="l01974"></a>01974   <span class="comment">//</span>
<a name="l01975"></a>01975   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">open</a>(fname);
<a name="l01976"></a>01976 }
<a name="l01977"></a>01977 
<a name="l01981"></a>01981 <span class="keywordtype">int</span>
<a name="l01982"></a><a class="code" href="classaffx_1_1_tsv_file.html#55052fcb2235197a2afaacf7065b4c73">01982</a> <a class="code" href="classaffx_1_1_tsv_file.html#55052fcb2235197a2afaacf7065b4c73" title="Open a Csv file.">affx::TsvFile::openCsv</a>(std::string fname)
<a name="l01983"></a>01983 {
<a name="l01984"></a>01984   <a class="code" href="classaffx_1_1_tsv_file.html#c617789f4c2845610f82cd41c0d04bc2" title="add more columns as needed.">m_optAutoColumns</a>=<span class="keyword">true</span>;
<a name="l01985"></a>01985   <a class="code" href="classaffx_1_1_tsv_file.html#aef4dd51e3fb11b8a8093d5080af1bc2" title="remove quotes when reading?">m_optAutoDequote</a>=<span class="keyword">true</span>;
<a name="l01986"></a>01986   <a class="code" href="classaffx_1_1_tsv_file.html#73f5e00e7784ece25072eff00ccc2015" title="Autosense between tabs and commas.">m_optAutoSenseSep</a>=<span class="keyword">false</span>; <span class="comment">// must be ','</span>
<a name="l01987"></a>01987   <a class="code" href="classaffx_1_1_tsv_file.html#8847f8471648053495d0a3f14004c8ae" title="the escape char to use">m_optEscapeChar</a>=<span class="charliteral">'\\'</span>;    <span class="comment">// The escape char is '\'</span>
<a name="l01988"></a>01988   <a class="code" href="classaffx_1_1_tsv_file.html#3104f733113db8733c335bf425c89a7f" title="Obey the escapechar?">m_optEscapeOk</a>=<span class="keyword">true</span>;
<a name="l01989"></a>01989   <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<span class="charliteral">','</span>;       <span class="comment">// set the field sep char</span>
<a name="l01990"></a>01990   <a class="code" href="classaffx_1_1_tsv_file.html#f78f63d734799fb71378837d8ef94527" title="read the first line as column headers?">m_optHasColumnHeader</a>=<span class="keyword">true</span>;
<a name="l01991"></a>01991   <span class="comment">//</span>
<a name="l01992"></a>01992   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#081c1924daeeb3f815d24fab85b85d2e" title="Opens a file -- attempts to guess some defaults.">open</a>(fname);
<a name="l01993"></a>01993 }
<a name="l01994"></a>01994 
<a name="l01995"></a>01995 
<a name="l01997"></a>01997 <span class="keywordtype">int</span>
<a name="l01998"></a><a class="code" href="classaffx_1_1_tsv_file.html#e7932be2156c04a562f327b53833aed7">01998</a> <a class="code" href="classaffx_1_1_tsv_file.html#e7932be2156c04a562f327b53833aed7" title="Close the file.">affx::TsvFile::close</a>()
<a name="l01999"></a>01999 {
<a name="l02000"></a>02000   <span class="comment">// close an open stream</span>
<a name="l02001"></a>02001   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.is_open()) {
<a name="l02002"></a>02002     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.close();
<a name="l02003"></a>02003   }
<a name="l02004"></a>02004   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02005"></a>02005 }
<a name="l02006"></a>02006 
<a name="l02009"></a>02009 <span class="keywordtype">int</span>
<a name="l02010"></a><a class="code" href="classaffx_1_1_tsv_file.html#bba3dc4a890e572117bbfcab4ceb193c">02010</a> <a class="code" href="classaffx_1_1_tsv_file.html#bba3dc4a890e572117bbfcab4ceb193c" title="Gobble up the tabs without skipping over eol.">affx::TsvFile::f_advance_tabs</a>()
<a name="l02011"></a>02011 {
<a name="l02012"></a>02012   <span class="keywordtype">int</span> c;
<a name="l02013"></a>02013   <span class="keywordtype">int</span> tabcnt=0;
<a name="l02014"></a>02014   <span class="keywordtype">int</span> maxtabs=(int)(<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size()-1);
<a name="l02015"></a>02015 
<a name="l02016"></a>02016   <a class="code" href="classaffx_1_1_tsv_file.html#616159e779c4780d796dcf55fc138ce4" title="Where the current line starts.">m_line_fpos</a>=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.tellg();
<a name="l02017"></a>02017 
<a name="l02018"></a>02018   <span class="comment">// first nibble off expected tabs...</span>
<a name="l02019"></a>02019   <span class="keywordflow">while</span> (tabcnt&lt;maxtabs) {
<a name="l02020"></a>02020     <span class="comment">//c=m_fileStream.get();</span>
<a name="l02021"></a>02021     c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02022"></a>02022     <span class="comment">// printf("!%c",c);</span>
<a name="l02023"></a>02023     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a>) {
<a name="l02024"></a>02024       tabcnt++;
<a name="l02025"></a>02025     }
<a name="l02026"></a>02026     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#3b3196c94ae6effc5a468d04951e89ef" title="Hex code for comment char.">TSV_CHAR_COMMENT</a>) {
<a name="l02027"></a>02027       <span class="comment">//m_fileStream.putback((char)c);</span>
<a name="l02028"></a>02028       <span class="keywordflow">if</span>(tabcnt &gt; 0) {
<a name="l02029"></a>02029         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<span class="stringliteral">"Error file: '"</span> + <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a> + <span class="stringliteral">"' "</span> +
<a name="l02030"></a>02030                       <span class="stringliteral">"at line: "</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(<a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>) + <span class="stringliteral">": "</span> +
<a name="l02031"></a>02031                       <span class="stringliteral">"Not allowed to have comment characters except on first character of line."</span>);
<a name="l02032"></a>02032       }
<a name="l02033"></a>02033       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02034"></a>02034       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395e9f3a2560afe1d10f38055dc29d1bc91" title="The line is a comment line (m_lineLvl).">TSV_LINE_COMMENT</a>;
<a name="l02035"></a>02035     }
<a name="l02036"></a>02036     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>)) {
<a name="l02037"></a>02037       <span class="comment">//m_fileStream.putback((char)c);</span>
<a name="l02038"></a>02038       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02039"></a>02039       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3955680fa649292ef7211c2654c8f2ea99c" title="The line is blank (m_lineLvl).">TSV_LINE_BLANK</a>);
<a name="l02040"></a>02040     }
<a name="l02041"></a>02041     <span class="keywordflow">else</span> {
<a name="l02042"></a>02042       <span class="comment">// m_fileStream.putback((char)c);</span>
<a name="l02043"></a>02043       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02044"></a>02044       <span class="keywordflow">break</span>;
<a name="l02045"></a>02045     }
<a name="l02046"></a>02046   }
<a name="l02047"></a>02047 
<a name="l02048"></a>02048   <span class="comment">// skip possibly extra whitespace</span>
<a name="l02049"></a>02049   <span class="comment">//c=m_fileStream.peek();</span>
<a name="l02050"></a>02050   c=<a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>();
<a name="l02051"></a>02051   <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#3b3196c94ae6effc5a468d04951e89ef" title="Hex code for comment char.">TSV_CHAR_COMMENT</a>) {
<a name="l02052"></a>02052     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395e9f3a2560afe1d10f38055dc29d1bc91" title="The line is a comment line (m_lineLvl).">TSV_LINE_COMMENT</a>);
<a name="l02053"></a>02053   }
<a name="l02054"></a>02054   <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>)||(c==EOF)) {
<a name="l02055"></a>02055     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3955680fa649292ef7211c2654c8f2ea99c" title="The line is blank (m_lineLvl).">TSV_LINE_BLANK</a>);
<a name="l02056"></a>02056   }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058   <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#ee68c7c932b5a2b564037447fcacfe2f" title="Hex code for SPACE char.">TSV_CHAR_SPACE</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a>)) {
<a name="l02059"></a>02059     std::fstream::pos_type skipstart;
<a name="l02060"></a>02060     <span class="keywordtype">int</span> spaceCnt = -1;
<a name="l02061"></a>02061     skipstart=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.tellg();
<a name="l02062"></a>02062     <span class="comment">//</span>
<a name="l02063"></a>02063     <span class="keywordflow">do</span> {
<a name="l02064"></a>02064       <span class="comment">//c=m_fileStream.get();</span>
<a name="l02065"></a>02065       c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02066"></a>02066       spaceCnt++;
<a name="l02067"></a>02067     } <span class="keywordflow">while</span> ((c==<a class="code" href="_tsv_file_8cpp.html#ee68c7c932b5a2b564037447fcacfe2f" title="Hex code for SPACE char.">TSV_CHAR_SPACE</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a>));
<a name="l02068"></a>02068     <span class="comment">// what are we looking at now?</span>
<a name="l02069"></a>02069     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#3b3196c94ae6effc5a468d04951e89ef" title="Hex code for comment char.">TSV_CHAR_COMMENT</a>) {
<a name="l02070"></a>02070       <span class="comment">//m_fileStream.putback(c);</span>
<a name="l02071"></a>02071       <span class="keywordflow">if</span>(spaceCnt &gt; 0) {
<a name="l02072"></a>02072         <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<span class="stringliteral">"Error - file: "</span> + <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a> + <span class="stringliteral">" at line: "</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(<a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>) +
<a name="l02073"></a>02073                       <span class="stringliteral">". Not allowed to have comment characters except on first character of line."</span>);
<a name="l02074"></a>02074       }
<a name="l02075"></a>02075       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02076"></a>02076       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd395e9f3a2560afe1d10f38055dc29d1bc91" title="The line is a comment line (m_lineLvl).">TSV_LINE_COMMENT</a>);
<a name="l02077"></a>02077     }
<a name="l02078"></a>02078     <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>)||(c==EOF)) {
<a name="l02079"></a>02079       <span class="comment">//m_fileStream.putback(c);</span>
<a name="l02080"></a>02080       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02081"></a>02081       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3955680fa649292ef7211c2654c8f2ea99c" title="The line is blank (m_lineLvl).">TSV_LINE_BLANK</a>);
<a name="l02082"></a>02082     }
<a name="l02083"></a>02083     <span class="comment">// found a normal char, rewind to start of skip</span>
<a name="l02084"></a>02084     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(skipstart);
<a name="l02085"></a>02085   }
<a name="l02086"></a>02086 
<a name="l02087"></a>02087   <span class="keywordflow">return</span> tabcnt;
<a name="l02088"></a>02088 }
<a name="l02089"></a>02089 
<a name="l02093"></a>02093 <span class="keywordtype">int</span>
<a name="l02094"></a><a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886">02094</a> <a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886" title="advance over the end of the line (eol)">affx::TsvFile::f_advance_eol</a>()
<a name="l02095"></a>02095 {
<a name="l02096"></a>02096   <span class="keywordtype">int</span> charcnt=0;
<a name="l02097"></a>02097   <span class="keywordtype">int</span> c;
<a name="l02098"></a>02098 
<a name="l02099"></a>02099   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l02100"></a>02100     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02101"></a>02101   }
<a name="l02102"></a>02102 
<a name="l02104"></a>02104   <span class="keywordflow">while</span> (1) {
<a name="l02105"></a>02105     <span class="comment">// get a char...</span>
<a name="l02106"></a>02106     <span class="comment">// c=m_fileStream.get();</span>
<a name="l02107"></a>02107     c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02108"></a>02108     <span class="comment">// eof?</span>
<a name="l02109"></a>02109     <span class="comment">//if (!m_fileStream.good()) {</span>
<a name="l02110"></a>02110     <span class="comment">//  break;</span>
<a name="l02111"></a>02111     <span class="comment">//}</span>
<a name="l02112"></a>02112     <span class="keywordflow">if</span> (c==EOF) {
<a name="l02113"></a>02113       <span class="keywordflow">break</span>;
<a name="l02114"></a>02114     }
<a name="l02115"></a>02115     <span class="comment">// LF ends a line</span>
<a name="l02116"></a>02116     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>) {
<a name="l02117"></a>02117       <span class="keywordflow">break</span>;
<a name="l02118"></a>02118     }
<a name="l02119"></a>02119     <span class="comment">// CR ends a line too.</span>
<a name="l02120"></a>02120     <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>) {
<a name="l02121"></a>02121       <span class="comment">//c=m_fileStream.peek();</span>
<a name="l02122"></a>02122       c=<a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>();
<a name="l02123"></a>02123       <span class="comment">// CR could be followed by a LF</span>
<a name="l02124"></a>02124       <span class="keywordflow">if</span> (c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>) {
<a name="l02125"></a>02125         <span class="comment">//c=m_fileStream.get();</span>
<a name="l02126"></a>02126         c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02127"></a>02127         <span class="keywordflow">break</span>;
<a name="l02128"></a>02128       }
<a name="l02129"></a>02129     }
<a name="l02130"></a>02130     <span class="comment">// count the chars</span>
<a name="l02131"></a>02131     charcnt++;
<a name="l02132"></a>02132   }
<a name="l02133"></a>02133 
<a name="l02134"></a>02134   <span class="comment">// we just went forward a line</span>
<a name="l02135"></a>02135   <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>++;
<a name="l02136"></a>02136 
<a name="l02137"></a>02137   <span class="comment">//</span>
<a name="l02138"></a>02138   <span class="keywordflow">return</span> charcnt;
<a name="l02139"></a>02139 }
<a name="l02140"></a>02140 
<a name="l02141"></a>02141 
<a name="l02147"></a>02147 <span class="keywordtype">int</span>
<a name="l02148"></a><a class="code" href="classaffx_1_1_tsv_file.html#d9fc816065834b233b1af8b0b2923560">02148</a> <a class="code" href="classaffx_1_1_tsv_file.html#d9fc816065834b233b1af8b0b2923560" title="Read data into a column from the file.">affx::TsvFile::f_read_column</a>(<a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* col)
<a name="l02149"></a>02149 {
<a name="l02150"></a>02150   <span class="keywordtype">int</span> c;
<a name="l02151"></a>02151   <span class="comment">//char* buf_ptr;</span>
<a name="l02152"></a>02152   <span class="comment">//int   buf_len;</span>
<a name="l02153"></a>02153   <span class="keywordtype">int</span>   bi;
<a name="l02154"></a>02154   <span class="keywordtype">bool</span>  finished;
<a name="l02155"></a>02155   <span class="keywordtype">char</span>  in_quotes;
<a name="l02156"></a>02156 
<a name="l02157"></a>02157   <span class="comment">//</span>
<a name="l02158"></a>02158   assert(col!=NULL);
<a name="l02159"></a>02159   <span class="comment">// mark this column as being null.</span>
<a name="l02160"></a>02160   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>=<span class="keyword">true</span>;
<a name="l02161"></a>02161   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#7b48a036e802d472010db5ba2e0b2865" title="Has this value been converted?">m_value_int_done</a>=<span class="keyword">false</span>;
<a name="l02162"></a>02162   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#e27796c34485d1686ba8bf20ab6d3a50" title="same as int">m_value_double_done</a>=<span class="keyword">false</span>;
<a name="l02163"></a>02163   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#9c669ccb764d7fca501769672425c675" title="same as int">m_value_uint_done</a>=<span class="keyword">false</span>;
<a name="l02164"></a>02164   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5df0c230a1c20cbf8b6c867737a5039" title="same as int">m_value_ulonglong_done</a>=<span class="keyword">false</span>;
<a name="l02165"></a>02165 
<a name="l02166"></a>02166   <span class="comment">// Nothing to be read.</span>
<a name="l02167"></a>02167   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l02168"></a>02168     col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>=<span class="stringliteral">""</span>;
<a name="l02169"></a>02169     return (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02170"></a>02170   }
<a name="l02171"></a>02171 
<a name="l02172"></a>02172   <span class="comment">// Mark it as not being null.</span>
<a name="l02173"></a>02173   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>=<span class="keyword">false</span>;
<a name="l02174"></a>02174 
<a name="l02175"></a>02175   <span class="comment">// set when the field is finished being read.</span>
<a name="l02176"></a>02176   finished=<span class="keyword">false</span>;
<a name="l02177"></a>02177   in_quotes=0;
<a name="l02178"></a>02178 
<a name="l02179"></a>02179   <span class="comment">// The common case is the field is the same size as last time.</span>
<a name="l02180"></a>02180   <span class="comment">// Copy the chars into an already existing string.</span>
<a name="l02181"></a>02181   bi=0;
<a name="l02182"></a>02182   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.resize(0);
<a name="l02183"></a>02183   <span class="keywordflow">while</span> (1) {
<a name="l02184"></a>02184     <span class="comment">//c=m_fileStream.get();</span>
<a name="l02185"></a>02185     c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02186"></a>02186 
<a name="l02187"></a>02187     <span class="comment">//</span>
<a name="l02188"></a>02188     <span class="keywordflow">if</span> ((<a class="code" href="classaffx_1_1_tsv_file.html#8847f8471648053495d0a3f14004c8ae" title="the escape char to use">m_optEscapeChar</a>==c)&amp;&amp;(<a class="code" href="classaffx_1_1_tsv_file.html#3104f733113db8733c335bf425c89a7f" title="Obey the escapechar?">m_optEscapeOk</a>==<span class="keyword">true</span>)) {
<a name="l02189"></a>02189       <span class="comment">//c=m_fileStream.get();</span>
<a name="l02190"></a>02190       c=<a class="code" href="_tsv_file_8cpp.html#71f0f461bfa8d914e0896763591f13fb">M_GETC</a>();
<a name="l02191"></a>02191       c=<a class="code" href="namespaceaffx.html#c9a7c6ec010d5df798fe0f30e5dc09d2" title="Convert the escaped char to the char which it represents.">unescapechar</a>(c);
<a name="l02192"></a>02192     }
<a name="l02193"></a>02193     <span class="comment">// start or end of quotes?</span>
<a name="l02194"></a>02194     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c==<span class="charliteral">'\''</span>)||(c==<span class="charliteral">'\"'</span>)) {
<a name="l02195"></a>02195       <span class="keywordflow">if</span> (in_quotes==0) { <span class="comment">// open</span>
<a name="l02196"></a>02196         in_quotes=c;
<a name="l02197"></a>02197       }
<a name="l02198"></a>02198       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c==in_quotes) { <span class="comment">// close</span>
<a name="l02199"></a>02199         in_quotes=0;
<a name="l02200"></a>02200       }
<a name="l02201"></a>02201     }
<a name="l02202"></a>02202     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>==c)&amp;&amp;(in_quotes==0)) {
<a name="l02203"></a>02203       col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.resize(bi); <span class="comment">// trunc the buffer to size.</span>
<a name="l02204"></a>02204       <span class="keywordflow">break</span>; <span class="comment">// discard the field-sep-char</span>
<a name="l02205"></a>02205     }
<a name="l02206"></a>02206     <span class="comment">// end of field? (short value)</span>
<a name="l02207"></a>02207     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c==<a class="code" href="_tsv_file_8cpp.html#fecc8df78b81ef8eed2ef1db788592b4" title="Hex code for CR char.">TSV_CHAR_CR</a>)||(c==<a class="code" href="_tsv_file_8cpp.html#ec9e111ea229fe62132fe980ce668634" title="Hex code for LF char.">TSV_CHAR_LF</a>)) {
<a name="l02208"></a>02208       <span class="comment">//m_fileStream.putback(c); // leave eol char</span>
<a name="l02209"></a>02209       <a class="code" href="_tsv_file_8cpp.html#895a814c3da928d7eb841acbd7bd5d5e">M_UNGETC</a>(c);
<a name="l02210"></a>02210       col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.resize(bi); <span class="comment">// trunc</span>
<a name="l02211"></a>02211       <span class="keywordflow">break</span>;
<a name="l02212"></a>02212     }
<a name="l02213"></a>02213     <span class="comment">// ran out of data</span>
<a name="l02214"></a>02214     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c==EOF) {
<a name="l02215"></a>02215       <span class="keywordflow">if</span> (bi==0) {
<a name="l02216"></a>02216         col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>=<span class="keyword">true</span>; <span class="comment">// revise our opinion about this being non-null</span>
<a name="l02217"></a>02217       }
<a name="l02218"></a>02218       col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.resize(bi);
<a name="l02219"></a>02219       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02220"></a>02220     }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222     <span class="comment">// add to our buffer</span>
<a name="l02223"></a>02223     col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>.append(1,(<span class="keywordtype">char</span>)c); <span class="comment">// buffer full, append</span>
<a name="l02224"></a>02224     bi++;
<a name="l02225"></a>02225   }
<a name="l02226"></a>02226 
<a name="l02227"></a>02227   <span class="comment">// dequote the column?</span>
<a name="l02228"></a>02228   <span class="keywordflow">if</span> (col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#626af5e1a7aec6a055e638fcf86c5bdd" title="Automatically strip quotes?">m_optAutoDequote</a>==<span class="keyword">true</span>) {
<a name="l02229"></a>02229     <a class="code" href="namespaceaffx.html#54628348fb76ebbdb02a5b9aad4e720d" title="Trim whitespace from both sides of a string.">trim</a>(col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>);
<a name="l02230"></a>02230     <a class="code" href="namespaceaffx.html#af1add79d80b3f2800698a791a26a2a6" title="Remove quotes from a string if they are matching.">dequote</a>(col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a5f07e1ff3a0d09314329fb644fd30a0" title="Buffer space.">m_buffer</a>);
<a name="l02231"></a>02231   }
<a name="l02232"></a>02232 
<a name="l02233"></a>02233   <span class="comment">//printf("z\n"); fflush(NULL);</span>
<a name="l02234"></a>02234   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02235"></a>02235 }
<a name="l02236"></a>02236 
<a name="l02240"></a>02240 <span class="keywordtype">int</span>
<a name="l02241"></a><a class="code" href="classaffx_1_1_tsv_file.html#eb49e46d02a2e1dc54418b85dd91b223">02241</a> <a class="code" href="classaffx_1_1_tsv_file.html#eb49e46d02a2e1dc54418b85dd91b223" title="Read the columns of this level.">affx::TsvFile::f_read_columns</a>(<span class="keywordtype">int</span> line_clvl)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243   assert(line_clvl&gt;=0);
<a name="l02244"></a>02244 
<a name="l02245"></a>02245   <span class="comment">//clearFieldsBelowClvl(line_clvl+1); // profiling</span>
<a name="l02246"></a>02246 
<a name="l02247"></a>02247   <span class="keywordflow">if</span> (line_clvl&lt;(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size()) {
<a name="l02248"></a>02248     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cidx_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[line_clvl].size();
<a name="l02249"></a>02249     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cidx=0;cidx&lt;cidx_size;cidx++) {
<a name="l02250"></a>02250       <a class="code" href="classaffx_1_1_tsv_file.html#d9fc816065834b233b1af8b0b2923560" title="Read data into a column from the file.">f_read_column</a>(&amp;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[line_clvl][cidx]);
<a name="l02251"></a>02251       <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[line_clvl][cidx].linkedvars_assign(<span class="keyword">this</span>);
<a name="l02252"></a>02252       <span class="comment">//printf("C:'%s'\n",m_column_map[line_clvl][cidx].buffer.c_str());</span>
<a name="l02253"></a>02253     }
<a name="l02254"></a>02254   }
<a name="l02255"></a>02255 
<a name="l02256"></a>02256   <span class="comment">// Read more columns?</span>
<a name="l02257"></a>02257   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#c617789f4c2845610f82cd41c0d04bc2" title="add more columns as needed.">m_optAutoColumns</a>) {
<a name="l02258"></a>02258     <span class="comment">//char colname_buf[100];</span>
<a name="l02259"></a>02259     <span class="keywordflow">while</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#71317671ce0632bb07c16d99550022a9" title="Are we looking at the end of a line?">f_lookingat_eol</a>()) {
<a name="l02260"></a>02260       <span class="keywordtype">int</span> cidx=<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(line_clvl);
<a name="l02261"></a>02261       <span class="comment">// create a column</span>
<a name="l02262"></a>02262       std::ostringstream stream;
<a name="l02263"></a>02263       stream &lt;&lt; <span class="stringliteral">"col"</span> &lt;&lt; cidx;
<a name="l02264"></a>02264       <span class="comment">//snprintf(colname_buf,sizeof(colname_buf),"col%02d",cidx);</span>
<a name="l02265"></a>02265       <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">defineColumn</a>(line_clvl,cidx,stream.str());
<a name="l02266"></a>02266       <span class="comment">//</span>
<a name="l02267"></a>02267       <a class="code" href="classaffx_1_1_tsv_file.html#d9fc816065834b233b1af8b0b2923560" title="Read data into a column from the file.">f_read_column</a>(&amp;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[line_clvl][cidx]);
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269   }
<a name="l02270"></a>02270 
<a name="l02271"></a>02271   <span class="comment">// skip past the end of this line...</span>
<a name="l02272"></a>02272   <a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886" title="advance over the end of the line (eol)">f_advance_eol</a>();
<a name="l02273"></a>02273 
<a name="l02274"></a>02274   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02275"></a>02275 }
<a name="l02276"></a>02276 
<a name="l02278"></a>02278 
<a name="l02281"></a>02281 <a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>*
<a name="l02282"></a><a class="code" href="classaffx_1_1_tsv_file.html#fc1e9c1b14a07eae2fe287d6689c5761">02282</a> <a class="code" href="classaffx_1_1_tsv_file.html#fc1e9c1b14a07eae2fe287d6689c5761" title="Allocate a new binding object.">affx::TsvFile::linkvar_alloc</a>()
<a name="l02283"></a>02283 {
<a name="l02284"></a>02284   <a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>* var=<span class="keyword">new</span> <a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>;
<a name="l02285"></a>02285   <a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.push_back(var);
<a name="l02286"></a>02286   <a class="code" href="classaffx_1_1_tsv_file.html#4702836f9d5426c3d0018a2b8d4b1781" title="The state of the bound and linked vars... Are the links up to date.">m_linkvars_done</a>=<span class="keyword">false</span>;
<a name="l02287"></a>02287   <span class="keywordflow">return</span> var;
<a name="l02288"></a>02288 }
<a name="l02289"></a>02289 
<a name="l02291"></a>02291 <span class="keywordtype">void</span>
<a name="l02292"></a><a class="code" href="classaffx_1_1_tsv_file.html#133f058f2360984318f649f52a39a384">02292</a> <a class="code" href="classaffx_1_1_tsv_file.html#133f058f2360984318f649f52a39a384" title="clear all the linkages from columns to vars">affx::TsvFile::linkvars_clear</a>()
<a name="l02293"></a>02293 {
<a name="l02294"></a>02294   <span class="comment">//</span>
<a name="l02295"></a>02295   <a class="code" href="classaffx_1_1_tsv_file.html#4702836f9d5426c3d0018a2b8d4b1781" title="The state of the bound and linked vars... Are the links up to date.">m_linkvars_done</a>=<span class="keyword">false</span>;
<a name="l02296"></a>02296   <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>=0;
<a name="l02297"></a>02297   <a class="code" href="classaffx_1_1_tsv_file.html#f16d62be5d949c96e068b265b96ce327" title="Count of link warnings.">m_linkvars_warnings</a>=0;
<a name="l02298"></a>02298   <span class="comment">//</span>
<a name="l02299"></a>02299   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m_column_map_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size();
<a name="l02300"></a>02300   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;m_column_map_size;clvl++) {
<a name="l02301"></a>02301     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m_column_map_clvl_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();
<a name="l02302"></a>02302     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cidx=0;cidx&lt;m_column_map_clvl_size;cidx++) {
<a name="l02303"></a>02303       <a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].linkedvars_clear();
<a name="l02304"></a>02304     }
<a name="l02305"></a>02305   }
<a name="l02306"></a>02306 }
<a name="l02307"></a>02307 
<a name="l02308"></a>02308 
<a name="l02313"></a>02313 <span class="keywordtype">void</span>
<a name="l02314"></a><a class="code" href="classaffx_1_1_tsv_file.html#c8872d218fbc848754a9a928153470ef">02314</a> <a class="code" href="classaffx_1_1_tsv_file.html#c8872d218fbc848754a9a928153470ef" title="Link a binding to a column.">affx::TsvFile::linkvar_column</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>* var)
<a name="l02315"></a>02315 {
<a name="l02316"></a>02316   var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#3ffe4b5f3fae287df13ac209b376230c" title="Is this linked to a column?">islinked</a>=<span class="keyword">false</span>;
<a name="l02317"></a>02317   <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* col=<a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,cidx);
<a name="l02318"></a>02318 
<a name="l02319"></a>02319   <span class="keywordflow">if</span> (col==NULL) {
<a name="l02320"></a>02320     <span class="comment">// out of bounds</span>
<a name="l02321"></a>02321     <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>++;
<a name="l02322"></a>02322     <span class="keywordflow">return</span>;
<a name="l02323"></a>02323   }
<a name="l02324"></a>02324   <span class="comment">// found the column, copy over info</span>
<a name="l02325"></a>02325   col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#a21e692c8100fe710697a689307bea1a" title="Add the var to the collection of linked vars.">linkedvar_push</a>(var);
<a name="l02326"></a>02326   var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#3ffe4b5f3fae287df13ac209b376230c" title="Is this linked to a column?">islinked</a>=<span class="keyword">true</span>;
<a name="l02327"></a>02327 }
<a name="l02328"></a>02328 
<a name="l02331"></a>02331 <span class="keywordtype">void</span>
<a name="l02332"></a><a class="code" href="classaffx_1_1_tsv_file.html#c62e24c2775c8d9931b142ba3052daf5">02332</a> <a class="code" href="classaffx_1_1_tsv_file.html#c62e24c2775c8d9931b142ba3052daf5" title="Link a binding var to a column.">affx::TsvFile::linkvar_link</a>(<a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>* var)
<a name="l02333"></a>02333 {
<a name="l02334"></a>02334   assert(var!=NULL);
<a name="l02335"></a>02335 
<a name="l02336"></a>02336   <span class="comment">//printf("link=%p errs=%d\n",var,m_linkvars_errors);</span>
<a name="l02337"></a>02337   <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#c2e68d6dc7ff4cdeadc061c7fccdb24f" title="Is is bound by index or name?">m_bindto_type</a>==<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f77cb60d71ffa9a0dbe3aed31f6f50216d9" title="The binding wont be bound.">TSV_BINDTO_NONE</a>) {
<a name="l02338"></a>02338     <span class="comment">// dead</span>
<a name="l02339"></a>02339   }
<a name="l02340"></a>02340   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#c2e68d6dc7ff4cdeadc061c7fccdb24f" title="Is is bound by index or name?">m_bindto_type</a>==<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f779f53ea209c66c63f7593f763a26cf828" title="Bound to column indexed by number.">TSV_BINDTO_CIDX</a>) { <span class="comment">// by index</span>
<a name="l02341"></a>02341     <a class="code" href="classaffx_1_1_tsv_file.html#c8872d218fbc848754a9a928153470ef" title="Link a binding to a column.">linkvar_column</a>(var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#9a4b0b31ab384e644713d078816466ca" title="The column level.">m_bindto_clvl</a>,var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#e9966ad979ba3dc6f8315cbbebf36681" title="The index of the bound column.">m_bindto_cidx</a>,var);
<a name="l02342"></a>02342   }
<a name="l02343"></a>02343   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#c2e68d6dc7ff4cdeadc061c7fccdb24f" title="Is is bound by index or name?">m_bindto_type</a>==<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f779f57e202ae1434b9ecc5c2230b295d04" title="Bound to a column index by name.">TSV_BINDTO_CNAME</a>) { <span class="comment">// by name</span>
<a name="l02344"></a>02344     <span class="keywordtype">int</span> cidx=<a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">cname2cidx</a>(var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#9a4b0b31ab384e644713d078816466ca" title="The column level.">m_bindto_clvl</a>,var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#ac455f6a60e8b99aabcafecf41c70c90" title="The name of the bound column.">m_bindto_cname</a>);
<a name="l02345"></a>02345     <span class="keywordflow">if</span> (cidx&gt;=0) {
<a name="l02346"></a>02346       <a class="code" href="classaffx_1_1_tsv_file.html#c8872d218fbc848754a9a928153470ef" title="Link a binding to a column.">linkvar_column</a>(var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#9a4b0b31ab384e644713d078816466ca" title="The column level.">m_bindto_clvl</a>,cidx,var);
<a name="l02347"></a>02347     }
<a name="l02348"></a>02348   } <span class="keywordflow">else</span> {
<a name="l02349"></a>02349     assert(0); <span class="comment">// shouldnt get here</span>
<a name="l02350"></a>02350   }
<a name="l02351"></a>02351 
<a name="l02352"></a>02352   <span class="comment">// check the binding condition...</span>
<a name="l02353"></a>02353   <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#3ffe4b5f3fae287df13ac209b376230c" title="Is this linked to a column?">islinked</a>==<span class="keyword">true</span>) {   <span class="comment">// no need to check</span>
<a name="l02354"></a>02354     <span class="keywordflow">return</span>;
<a name="l02355"></a>02355   }
<a name="l02356"></a>02356   <span class="keywordflow">if</span> ((var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#2749a8abf89cece479943fa38110e133" title="What options are flagged?">m_flags</a>&amp;<a class="code" href="namespaceaffx.html#8f36853f1d3b6cfb79edebd82760691df605fbe0e244c4a604d176991d8df2c6" title="warn if not bound">TSV_BIND_REQUIRED</a>)!=0) {
<a name="l02357"></a>02357     <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>++;
<a name="l02358"></a>02358     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>) {
<a name="l02359"></a>02359       <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<span class="stringliteral">"Didn't find required column: '"</span>+<a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#ac455f6a60e8b99aabcafecf41c70c90" title="The name of the bound column.">m_bindto_cname</a>)+
<a name="l02360"></a>02360                     <span class="stringliteral">"' in file: '"</span>+<a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>+<span class="stringliteral">"'."</span>);
<a name="l02361"></a>02361     }
<a name="l02362"></a>02362     <span class="keywordflow">return</span>;
<a name="l02363"></a>02363   }
<a name="l02364"></a>02364   <span class="keywordflow">if</span> ((var-&gt;<a class="code" href="classaffx_1_1_tsv_file_binding.html#2749a8abf89cece479943fa38110e133" title="What options are flagged?">m_flags</a>&amp;<a class="code" href="namespaceaffx.html#8f36853f1d3b6cfb79edebd82760691daa3a445c3a3c184073a88be265f509e1" title="bind if present">TSV_BIND_WARNING</a>)!=0) {
<a name="l02365"></a>02365     <a class="code" href="classaffx_1_1_tsv_file.html#f16d62be5d949c96e068b265b96ce327" title="Count of link warnings.">m_linkvars_warnings</a>++;
<a name="l02366"></a>02366     <span class="keywordflow">return</span>;
<a name="l02367"></a>02367   }
<a name="l02368"></a>02368 }
<a name="l02369"></a>02369 
<a name="l02372"></a>02372 <span class="keywordtype">int</span>
<a name="l02373"></a><a class="code" href="classaffx_1_1_tsv_file.html#c5efe569e1074cf81d65e2ab44ff6e72">02373</a> <a class="code" href="classaffx_1_1_tsv_file.html#c5efe569e1074cf81d65e2ab44ff6e72" title="Examine the list of bindings and establish the linkages.">affx::TsvFile::linkvars_makelinks</a>()
<a name="l02374"></a>02374 {
<a name="l02375"></a>02375   <span class="comment">// zap the current linkages</span>
<a name="l02376"></a>02376   <a class="code" href="classaffx_1_1_tsv_file.html#133f058f2360984318f649f52a39a384" title="clear all the linkages from columns to vars">linkvars_clear</a>();
<a name="l02377"></a>02377   <span class="comment">// walk the vars and link them all</span>
<a name="l02378"></a>02378   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m_linkvars_vec_size=<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.size();
<a name="l02379"></a>02379   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi=0;vi&lt;m_linkvars_vec_size;vi++) {
<a name="l02380"></a>02380     <a class="code" href="classaffx_1_1_tsv_file.html#c62e24c2775c8d9931b142ba3052daf5" title="Link a binding var to a column.">linkvar_link</a>(<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[vi]);
<a name="l02381"></a>02381   }
<a name="l02382"></a>02382   <span class="comment">//</span>
<a name="l02383"></a>02383   <a class="code" href="classaffx_1_1_tsv_file.html#4702836f9d5426c3d0018a2b8d4b1781" title="The state of the bound and linked vars... Are the links up to date.">m_linkvars_done</a>=<span class="keyword">true</span>;
<a name="l02384"></a>02384   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>;
<a name="l02385"></a>02385 }
<a name="l02386"></a>02386 
<a name="l02389"></a>02389 <span class="keywordtype">int</span>
<a name="l02390"></a><a class="code" href="classaffx_1_1_tsv_file.html#202ae12e0ea6c845e74de9f162d03c6d">02390</a> <a class="code" href="classaffx_1_1_tsv_file.html#202ae12e0ea6c845e74de9f162d03c6d" title="Dont do anything if the linkages are done, otherwise link.">affx::TsvFile::linkvars_maybe</a>()
<a name="l02391"></a>02391 {
<a name="l02392"></a>02392   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#4702836f9d5426c3d0018a2b8d4b1781" title="The state of the bound and linked vars... Are the links up to date.">m_linkvars_done</a>) {
<a name="l02393"></a>02393     <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>;
<a name="l02394"></a>02394   }
<a name="l02395"></a>02395   <span class="keywordflow">if</span> (!(<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.is_open())) {
<a name="l02396"></a>02396     <span class="keywordflow">return</span> 0;
<a name="l02397"></a>02397   }
<a name="l02398"></a>02398   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#c5efe569e1074cf81d65e2ab44ff6e72" title="Examine the list of bindings and establish the linkages.">linkvars_makelinks</a>();
<a name="l02399"></a>02399 }
<a name="l02400"></a>02400 
<a name="l02403"></a>02403 <span class="keywordtype">int</span>
<a name="l02404"></a><a class="code" href="classaffx_1_1_tsv_file.html#2fbf95f8509127a5a37b262f8cedf926">02404</a> <a class="code" href="classaffx_1_1_tsv_file.html#2fbf95f8509127a5a37b262f8cedf926" title="The number of binding errors. (vars which couldnt be linked).">affx::TsvFile::bindErrorCnt</a>()
<a name="l02405"></a>02405 {
<a name="l02406"></a>02406   <span class="comment">// make sure the links are in place.</span>
<a name="l02407"></a>02407   <a class="code" href="classaffx_1_1_tsv_file.html#202ae12e0ea6c845e74de9f162d03c6d" title="Dont do anything if the linkages are done, otherwise link.">linkvars_maybe</a>();
<a name="l02408"></a>02408   <span class="comment">// report the number of links we couldnt make</span>
<a name="l02409"></a>02409   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#55f41a613b9bdb6cda2ec1395f92d9e5" title="Count of link errors.">m_linkvars_errors</a>;
<a name="l02410"></a>02410 }
<a name="l02411"></a>02411 
<a name="l02414"></a>02414 <span class="keywordtype">int</span>
<a name="l02415"></a><a class="code" href="classaffx_1_1_tsv_file.html#4fc095a3879e307016a7b0510c79b037">02415</a> <a class="code" href="classaffx_1_1_tsv_file.html#4fc095a3879e307016a7b0510c79b037" title="Is the format of the file ok.">affx::TsvFile::formatOk</a>()
<a name="l02416"></a>02416 {
<a name="l02417"></a>02417   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#2fbf95f8509127a5a37b262f8cedf926" title="The number of binding errors. (vars which couldnt be linked).">bindErrorCnt</a>()==0) {
<a name="l02418"></a>02418     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02419"></a>02419   }
<a name="l02420"></a>02420   <span class="comment">// print the errors</span>
<a name="l02421"></a>02421   <a class="code" href="classaffx_1_1_tsv_file.html#8622c5e3b85aa90d3d15521f6cff8f5e" title="print messages about unbound variables.">printBindingErrors</a>();
<a name="l02422"></a>02422 
<a name="l02423"></a>02423   <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l02424"></a>02424 }
<a name="l02425"></a>02425 
<a name="l02427"></a>02427 <span class="keywordtype">void</span>
<a name="l02428"></a><a class="code" href="classaffx_1_1_tsv_file.html#8622c5e3b85aa90d3d15521f6cff8f5e">02428</a> <a class="code" href="classaffx_1_1_tsv_file.html#8622c5e3b85aa90d3d15521f6cff8f5e" title="print messages about unbound variables.">affx::TsvFile::printBindingErrors</a>()
<a name="l02429"></a>02429 {
<a name="l02430"></a>02430   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.size();i++) {
<a name="l02431"></a>02431     <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[i]-&gt;islinked) { <span class="comment">// oh no!</span>
<a name="l02432"></a>02432       <span class="keywordflow">if</span> ((<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[i]-&gt;m_flags&amp;(<a class="code" href="namespaceaffx.html#8f36853f1d3b6cfb79edebd82760691daa3a445c3a3c184073a88be265f509e1" title="bind if present">TSV_BIND_WARNING</a>|<a class="code" href="namespaceaffx.html#8f36853f1d3b6cfb79edebd82760691df605fbe0e244c4a604d176991d8df2c6" title="warn if not bound">TSV_BIND_REQUIRED</a>))!=0) {
<a name="l02433"></a>02433         <a class="code" href="class_verbose.html#d6c800f45cb331c71305d68b51662225" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">"TSV: warning: did not bind ('"</span> +
<a name="l02434"></a>02434                      <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[i]-&gt;m_bindto_clvl) + <span class="stringliteral">","</span> +
<a name="l02435"></a>02435                      <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[i]-&gt;m_bindto_cidx) + <span class="stringliteral">",'"</span> +
<a name="l02436"></a>02436                      <a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[i]-&gt;m_bindto_cname +<span class="stringliteral">"')"</span>);
<a name="l02437"></a>02437       }
<a name="l02438"></a>02438     }
<a name="l02439"></a>02439   }
<a name="l02440"></a>02440 }
<a name="l02441"></a>02441 
<a name="l02443"></a>02443 <span class="keywordtype">void</span>
<a name="l02444"></a><a class="code" href="classaffx_1_1_tsv_file.html#bddb7e525495cedf064e221536026de0">02444</a> <a class="code" href="classaffx_1_1_tsv_file.html#bddb7e525495cedf064e221536026de0" title="Remove all the bindings.">affx::TsvFile::unbindAll</a>()
<a name="l02445"></a>02445 {
<a name="l02446"></a>02446   <a class="code" href="classaffx_1_1_tsv_file.html#22998fcabd807ea874ee58c37e224b15" title="Clear the bindings of columns to variables.">clearBindings</a>();
<a name="l02447"></a>02447 }
<a name="l02448"></a>02448 
<a name="l02450"></a>02450 
<a name="l02452"></a><a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b">02452</a> <span class="preprocessor">#define TSV_DEFUN_BIND(Xtype,Xfield) \</span>
<a name="l02453"></a>02453 <span class="preprocessor">int \</span>
<a name="l02454"></a>02454 <span class="preprocessor">affx::TsvFile::bind(int clvl,int cidx,Xtype* ptr,tsv_bindopt_t flags,int interncache_size) \</span>
<a name="l02455"></a>02455 <span class="preprocessor">{ \</span>
<a name="l02456"></a>02456 <span class="preprocessor">  TsvFileBinding* var=linkvar_alloc(); \</span>
<a name="l02457"></a>02457 <span class="preprocessor">  var-&gt;m_bindto_type=TSV_BINDTO_CIDX; \</span>
<a name="l02458"></a>02458 <span class="preprocessor">  var-&gt;m_bindto_clvl=clvl; \</span>
<a name="l02459"></a>02459 <span class="preprocessor">  var-&gt;m_bindto_cidx=cidx; \</span>
<a name="l02460"></a>02460 <span class="preprocessor">  var-&gt;m_flags=flags; \</span>
<a name="l02461"></a>02461 <span class="preprocessor">  var-&gt;m_interncache_size=interncache_size; \</span>
<a name="l02462"></a>02462 <span class="preprocessor">  var-&gt;Xfield=ptr; \</span>
<a name="l02463"></a>02463 <span class="preprocessor">\</span>
<a name="l02464"></a>02464 <span class="preprocessor">  linkvars_maybe(); \</span>
<a name="l02465"></a>02465 <span class="preprocessor">\</span>
<a name="l02466"></a>02466 <span class="preprocessor">  return TSV_OK; \</span>
<a name="l02467"></a>02467 <span class="preprocessor">} \</span>
<a name="l02468"></a>02468 <span class="preprocessor">int \</span>
<a name="l02469"></a>02469 <span class="preprocessor">affx::TsvFile::bind(int clvl,const std::string&amp; cname,Xtype* ptr,tsv_bindopt_t flags,int interncache_size) \</span>
<a name="l02470"></a>02470 <span class="preprocessor">{ \</span>
<a name="l02471"></a>02471 <span class="preprocessor">  TsvFileBinding* var=linkvar_alloc(); \</span>
<a name="l02472"></a>02472 <span class="preprocessor">  var-&gt;m_bindto_type=TSV_BINDTO_CNAME; \</span>
<a name="l02473"></a>02473 <span class="preprocessor">  var-&gt;m_bindto_clvl=clvl; \</span>
<a name="l02474"></a>02474 <span class="preprocessor">  var-&gt;m_bindto_cname=cname; \</span>
<a name="l02475"></a>02475 <span class="preprocessor">  var-&gt;m_flags=flags; \</span>
<a name="l02476"></a>02476 <span class="preprocessor">  var-&gt;m_interncache_size=interncache_size; \</span>
<a name="l02477"></a>02477 <span class="preprocessor">  var-&gt;Xfield=ptr; \</span>
<a name="l02478"></a>02478 <span class="preprocessor">\</span>
<a name="l02479"></a>02479 <span class="preprocessor">  linkvars_maybe(); \</span>
<a name="l02480"></a>02480 <span class="preprocessor">\</span>
<a name="l02481"></a>02481 <span class="preprocessor">  return TSV_OK; \</span>
<a name="l02482"></a>02482 <span class="preprocessor">}</span>
<a name="l02483"></a>02483 <span class="preprocessor"></span>
<a name="l02484"></a>02484 <span class="comment">// Expand the above</span>
<a name="l02485"></a>02485 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(std::string,m_ptr_string);
<a name="l02486"></a>02486 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(<span class="keywordtype">int</span>,m_ptr_int);
<a name="l02487"></a>02487 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(<span class="keywordtype">double</span>,m_ptr_double);
<a name="l02488"></a>02488 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(<span class="keywordtype">float</span>,m_ptr_float);
<a name="l02489"></a>02489 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>,m_ptr_uint);
<a name="l02490"></a>02490 <a class="code" href="_tsv_file_8cpp.html#3006cc6794153d7d31216092fe979c7b" title="macro to define code">TSV_DEFUN_BIND</a>(uint64_t,m_ptr_ulonglong);
<a name="l02491"></a>02491 
<a name="l02492"></a>02492 <span class="comment">// dont need this any more.</span>
<a name="l02493"></a>02493 <span class="preprocessor">#undef TSV_DEFUN_BIND</span>
<a name="l02494"></a>02494 <span class="preprocessor"></span>
<a name="l02496"></a>02496 
<a name="l02499"></a>02499 <span class="keywordtype">int</span>
<a name="l02500"></a><a class="code" href="classaffx_1_1_tsv_file.html#05d594ceb54634fb1f39ca768276800e">02500</a> <a class="code" href="classaffx_1_1_tsv_file.html#05d594ceb54634fb1f39ca768276800e" title="Rewind back to the start of the data and clear the fields.">affx::TsvFile::rewind</a>()
<a name="l02501"></a>02501 {
<a name="l02502"></a>02502   <a class="code" href="classaffx_1_1_tsv_file.html#31aaf0d13dab55322b5c1904cca41cfe" title="Clear all the fields. (set them all to null).">clearFields</a>();
<a name="l02503"></a>02503   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.clear();
<a name="l02504"></a>02504   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(<a class="code" href="classaffx_1_1_tsv_file.html#91f786ef3961abdb2a6f723a56072167" title="Where the data begins (line 0).">m_fileDataPos</a>);
<a name="l02505"></a>02505   <span class="comment">//</span>
<a name="l02506"></a>02506   <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>=0;
<a name="l02507"></a>02507   <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>=0;
<a name="l02508"></a>02508   <span class="comment">//</span>
<a name="l02509"></a>02509   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l02510"></a>02510     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02511"></a>02511   }
<a name="l02512"></a>02512   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02513"></a>02513 }
<a name="l02514"></a>02514 
<a name="l02517"></a>02517 <span class="keywordtype">int</span>
<a name="l02518"></a><a class="code" href="classaffx_1_1_tsv_file.html#232aa58909f1bac888dfcec7d2694d99">02518</a> <a class="code" href="classaffx_1_1_tsv_file.html#232aa58909f1bac888dfcec7d2694d99" title="advance to the next line and bind the values">affx::TsvFile::nextLine</a>()
<a name="l02519"></a>02519 {
<a name="l02520"></a>02520   <span class="comment">// insure the vars are inplace</span>
<a name="l02521"></a>02521   <span class="comment">// we do this after the bind calls</span>
<a name="l02522"></a>02522   <span class="comment">// linkvars_maybe();</span>
<a name="l02523"></a>02523 
<a name="l02524"></a>02524   <span class="comment">// some sort of error or eof?</span>
<a name="l02525"></a>02525   <span class="comment">//if ((!m_fileStream.good())||(m_fileStream.peek()==EOF)) {</span>
<a name="l02526"></a>02526   <span class="keywordflow">if</span> ((!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good())||(<a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>()==EOF)) {
<a name="l02527"></a>02527     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02528"></a>02528   }
<a name="l02529"></a>02529 
<a name="l02530"></a>02530   <span class="comment">// insure the vars are inplace</span>
<a name="l02531"></a>02531   <span class="comment">//linkvars_maybe();</span>
<a name="l02532"></a>02532 
<a name="l02533"></a>02533   <span class="comment">// count the tabs to figure out what level it is at</span>
<a name="l02534"></a>02534   <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>=<a class="code" href="classaffx_1_1_tsv_file.html#bba3dc4a890e572117bbfcab4ceb193c" title="Gobble up the tabs without skipping over eol.">f_advance_tabs</a>();
<a name="l02535"></a>02535   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>&lt;0) {
<a name="l02536"></a>02536     <a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886" title="advance over the end of the line (eol)">f_advance_eol</a>();
<a name="l02537"></a>02537     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02538"></a>02538   }
<a name="l02539"></a>02539 
<a name="l02540"></a>02540   <span class="comment">// Read the data into the columns</span>
<a name="l02541"></a>02541   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#eb49e46d02a2e1dc54418b85dd91b223" title="Read the columns of this level.">f_read_columns</a>(<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>);
<a name="l02542"></a>02542 }
<a name="l02543"></a>02543 
<a name="l02549"></a>02549 <span class="keywordtype">int</span>
<a name="l02550"></a><a class="code" href="classaffx_1_1_tsv_file.html#2022895d082d1d635e7f59fccab12afb">02550</a> <a class="code" href="classaffx_1_1_tsv_file.html#2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl.">affx::TsvFile::nextLevel</a>(<span class="keywordtype">int</span> seek_clvl)
<a name="l02551"></a>02551 {
<a name="l02552"></a>02552   <span class="keywordtype">char</span> c = <span class="charliteral">'\0'</span>;
<a name="l02553"></a>02553   <span class="comment">// insure the vars are inplace</span>
<a name="l02554"></a>02554   <span class="comment">// linkvars_maybe();</span>
<a name="l02555"></a>02555 
<a name="l02556"></a>02556   <span class="comment">// Read lines until we find a line of the correct level.</span>
<a name="l02557"></a>02557   <span class="keywordflow">while</span> (1) {
<a name="l02558"></a>02558     <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l02559"></a>02559       <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l02560"></a>02560     }
<a name="l02561"></a>02561     c = <a class="code" href="_tsv_file_8cpp.html#97f228d5804e953788fac2a354586e2b">M_PEEK</a>();
<a name="l02562"></a>02562     <span class="comment">// speed tweak to avoid uncessary seek. Unless this is the 0 level</span>
<a name="l02563"></a>02563     <span class="comment">// the first character should be a tab. This handles a common case</span>
<a name="l02564"></a>02564     <span class="comment">// in pgf files.</span>
<a name="l02565"></a>02565     <span class="keywordflow">if</span>(seek_clvl != 0 &amp;&amp; c != <a class="code" href="_tsv_file_8cpp.html#2a9bc25f56bf061237669a2da31ed908" title="Hex code for TAB char.">TSV_CHAR_TAB</a> &amp;&amp; c != <a class="code" href="_tsv_file_8cpp.html#3b3196c94ae6effc5a468d04951e89ef" title="Hex code for comment char.">TSV_CHAR_COMMENT</a>) {
<a name="l02566"></a>02566       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3956f44b283cb980eed331f696ddf155a54" title="Did not read a line of the correct level.">TSV_LEVEL_LAST</a>;
<a name="l02567"></a>02567     }
<a name="l02568"></a>02568     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == EOF) {
<a name="l02569"></a>02569       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39585e3e6ac404da4ef29fb002bc92880d2" title="Hit the end of the file.">TSV_ERR_EOF</a>;
<a name="l02570"></a>02570     }
<a name="l02571"></a>02571 
<a name="l02572"></a>02572     <span class="comment">// what level is this line at?</span>
<a name="l02573"></a>02573     <a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>=<a class="code" href="classaffx_1_1_tsv_file.html#bba3dc4a890e572117bbfcab4ceb193c" title="Gobble up the tabs without skipping over eol.">f_advance_tabs</a>();
<a name="l02574"></a>02574 
<a name="l02575"></a>02575     <span class="comment">// skip the line if it isnt a data line.</span>
<a name="l02576"></a>02576     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>&lt;0) {
<a name="l02577"></a>02577       <a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886" title="advance over the end of the line (eol)">f_advance_eol</a>();
<a name="l02578"></a>02578       <span class="keywordflow">continue</span>;
<a name="l02579"></a>02579     }
<a name="l02580"></a>02580 
<a name="l02581"></a>02581     <span class="comment">// a match; bind and return</span>
<a name="l02582"></a>02582     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>==seek_clvl) {
<a name="l02583"></a>02583       <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#eb49e46d02a2e1dc54418b85dd91b223" title="Read the columns of this level.">f_read_columns</a>(<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>);
<a name="l02584"></a>02584     }
<a name="l02585"></a>02585     <span class="comment">// a master; dont skip it</span>
<a name="l02586"></a>02586     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>&lt;seek_clvl) {
<a name="l02587"></a>02587       <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(<a class="code" href="classaffx_1_1_tsv_file.html#616159e779c4780d796dcf55fc138ce4" title="Where the current line starts.">m_line_fpos</a>);
<a name="l02588"></a>02588       <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3956f44b283cb980eed331f696ddf155a54" title="Did not read a line of the correct level.">TSV_LEVEL_LAST</a>;
<a name="l02589"></a>02589     }
<a name="l02590"></a>02590     <span class="comment">// a child; skip it</span>
<a name="l02591"></a>02591     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>&gt;seek_clvl) {
<a name="l02592"></a>02592       <a class="code" href="classaffx_1_1_tsv_file.html#d20a9655256e6a11867e797e84021886" title="advance over the end of the line (eol)">f_advance_eol</a>();
<a name="l02593"></a>02593     }
<a name="l02594"></a>02594   }
<a name="l02595"></a>02595   <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3956da9440b3dacaf83f00b29b50f00d7ef" title="An otherwise unknown error.">TSV_ERR_UNKNOWN</a>);
<a name="l02596"></a>02596 }
<a name="l02597"></a>02597 
<a name="l02599"></a>02599 
<a name="l02601"></a><a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5">02601</a> <span class="preprocessor">#define TSV_GET_VALUE_CIDX() \</span>
<a name="l02602"></a>02602 <span class="preprocessor">  TsvFileField* col=clvlcidx2colptr(clvl,cidx); \</span>
<a name="l02603"></a>02603 <span class="preprocessor">  if ((col==NULL)||(col-&gt;isNull())) { \</span>
<a name="l02604"></a>02604 <span class="preprocessor">    return (TSV_ERR_NOTFOUND); \</span>
<a name="l02605"></a>02605 <span class="preprocessor">  } \</span>
<a name="l02606"></a>02606 <span class="preprocessor">  return col-&gt;get(val);</span>
<a name="l02607"></a>02607 <span class="preprocessor"></span>
<a name="l02613"></a>02613 <span class="keywordtype">int</span>
<a name="l02614"></a><a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1">02614</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,std::string&amp; val)
<a name="l02615"></a>02615 {
<a name="l02616"></a>02616   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02617"></a>02617 }
<a name="l02618"></a>02618 
<a name="l02624"></a>02624 <span class="keywordtype">int</span>
<a name="l02625"></a><a class="code" href="classaffx_1_1_tsv_file.html#eb4e23661027ca84538a8558b092e218">02625</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span>&amp; val)
<a name="l02626"></a>02626 {
<a name="l02627"></a>02627   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02628"></a>02628 }
<a name="l02634"></a>02634 <span class="keywordtype">int</span>
<a name="l02635"></a><a class="code" href="classaffx_1_1_tsv_file.html#8b8d2461bb35f55652480633f748a130">02635</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">double</span>&amp; val)
<a name="l02636"></a>02636 {
<a name="l02637"></a>02637   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02638"></a>02638 }
<a name="l02639"></a>02639 
<a name="l02645"></a>02645 <span class="keywordtype">int</span>
<a name="l02646"></a><a class="code" href="classaffx_1_1_tsv_file.html#4d130c8618eb124e156bb894606adedd">02646</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">float</span>&amp; val)
<a name="l02647"></a>02647 {
<a name="l02648"></a>02648   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02649"></a>02649 }
<a name="l02655"></a>02655 <span class="keywordtype">int</span>
<a name="l02656"></a><a class="code" href="classaffx_1_1_tsv_file.html#13dd1086b565ba02ea4dfa43e4e376d8">02656</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; val)
<a name="l02657"></a>02657 {
<a name="l02658"></a>02658   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02659"></a>02659 }
<a name="l02665"></a>02665 <span class="keywordtype">int</span>
<a name="l02666"></a><a class="code" href="classaffx_1_1_tsv_file.html#1978924115f3c70c1b8792c5faf7bf05">02666</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,uint64_t&amp; val)
<a name="l02667"></a>02667 {
<a name="l02668"></a>02668   <a class="code" href="_tsv_file_8cpp.html#f72d1c9fa6e18e24c2b27f330d51f6d5" title="Handy snippet of code.">TSV_GET_VALUE_CIDX</a>();
<a name="l02669"></a>02669 }
<a name="l02670"></a>02670 
<a name="l02671"></a>02671 <span class="preprocessor">#undef TSV_GET_VALUE_CIDX</span>
<a name="l02672"></a>02672 <span class="preprocessor"></span>
<a name="l02674"></a><a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d">02674</a> <span class="preprocessor">#define TSV_GET_VALUE_CNAME() \</span>
<a name="l02675"></a>02675 <span class="preprocessor">  TsvFileField* col=clvlcidx2colptr(clvl,cname); \</span>
<a name="l02676"></a>02676 <span class="preprocessor">  if ((col==NULL)||(col-&gt;isNull())) { \</span>
<a name="l02677"></a>02677 <span class="preprocessor">    return (TSV_ERR_NOTFOUND); \</span>
<a name="l02678"></a>02678 <span class="preprocessor">  } \</span>
<a name="l02679"></a>02679 <span class="preprocessor">  return col-&gt;get(val);</span>
<a name="l02680"></a>02680 <span class="preprocessor"></span>
<a name="l02686"></a>02686 <span class="keywordtype">int</span>
<a name="l02687"></a><a class="code" href="classaffx_1_1_tsv_file.html#17f051ec52e40eb7baf4c2858dc9e9cc">02687</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,std::string&amp; val)
<a name="l02688"></a>02688 {
<a name="l02689"></a>02689   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02690"></a>02690 }
<a name="l02691"></a>02691 
<a name="l02697"></a>02697 <span class="keywordtype">int</span>
<a name="l02698"></a><a class="code" href="classaffx_1_1_tsv_file.html#e34d86211b177360387bf8e9746e4786">02698</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,<span class="keywordtype">int</span>&amp; val)
<a name="l02699"></a>02699 {
<a name="l02700"></a>02700   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02701"></a>02701 }
<a name="l02707"></a>02707 <span class="keywordtype">int</span>
<a name="l02708"></a><a class="code" href="classaffx_1_1_tsv_file.html#9263bc7f13a22b2ad32aff15047fc748">02708</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,<span class="keywordtype">double</span>&amp; val)
<a name="l02709"></a>02709 {
<a name="l02710"></a>02710   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02711"></a>02711 }
<a name="l02712"></a>02712 
<a name="l02718"></a>02718 <span class="keywordtype">int</span>
<a name="l02719"></a><a class="code" href="classaffx_1_1_tsv_file.html#2d61c3c21939f0eb3fdd219b563e8904">02719</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,<span class="keywordtype">float</span>&amp; val)
<a name="l02720"></a>02720 {
<a name="l02721"></a>02721   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02722"></a>02722 }
<a name="l02723"></a>02723 
<a name="l02729"></a>02729 <span class="keywordtype">int</span>
<a name="l02730"></a><a class="code" href="classaffx_1_1_tsv_file.html#a3e85a393d560a8e2da45d433864f222">02730</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; val)
<a name="l02731"></a>02731 {
<a name="l02732"></a>02732   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02733"></a>02733 }
<a name="l02734"></a>02734 
<a name="l02740"></a>02740 <span class="keywordtype">int</span>
<a name="l02741"></a><a class="code" href="classaffx_1_1_tsv_file.html#6c0414635660d75dcbbfaea3b77f1633">02741</a> <a class="code" href="classaffx_1_1_tsv_file.html#7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field.">affx::TsvFile::get</a>(<span class="keywordtype">int</span> clvl,std::string cname,uint64_t&amp; val)
<a name="l02742"></a>02742 {
<a name="l02743"></a>02743   <a class="code" href="_tsv_file_8cpp.html#d83ccd7ace2f294030aebbfd1ea7173d" title="Handy code to get the value of a column.">TSV_GET_VALUE_CNAME</a>();
<a name="l02744"></a>02744 }
<a name="l02745"></a>02745 
<a name="l02746"></a>02746 <span class="comment">// cleanup</span>
<a name="l02747"></a>02747 <span class="preprocessor">#undef TSV_GET_VALUE_CNAME</span>
<a name="l02748"></a>02748 <span class="preprocessor"></span>
<a name="l02750"></a>02750 
<a name="l02752"></a><a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307">02752</a> <span class="preprocessor">#define TSV_SET_VALUE() \</span>
<a name="l02753"></a>02753 <span class="preprocessor">  TsvFileField* col=clvlcidx2colptr(clvl,cidx); \</span>
<a name="l02754"></a>02754 <span class="preprocessor">  if (col==NULL) { \</span>
<a name="l02755"></a>02755 <span class="preprocessor">    return (TSV_ERR_NOTFOUND); \</span>
<a name="l02756"></a>02756 <span class="preprocessor">  } \</span>
<a name="l02757"></a>02757 <span class="preprocessor">  return col-&gt;set(val);</span>
<a name="l02758"></a>02758 <span class="preprocessor"></span>
<a name="l02759"></a>02759 <span class="keywordtype">int</span>
<a name="l02760"></a><a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">02760</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,std::string val)
<a name="l02761"></a>02761 {
<a name="l02762"></a>02762   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02763"></a>02763 }
<a name="l02764"></a>02764 <span class="keywordtype">int</span>
<a name="l02765"></a><a class="code" href="classaffx_1_1_tsv_file.html#982414b380fbb24893c5a2bb5d8c7035">02765</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span> val)
<a name="l02766"></a>02766 {
<a name="l02767"></a>02767   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02768"></a>02768 }
<a name="l02769"></a>02769 <span class="keywordtype">int</span>
<a name="l02770"></a><a class="code" href="classaffx_1_1_tsv_file.html#edac2a25e010d6dafdc2fd181edefa1a">02770</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">double</span> val)
<a name="l02771"></a>02771 {
<a name="l02772"></a>02772   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02773"></a>02773 }
<a name="l02774"></a>02774 <span class="keywordtype">int</span>
<a name="l02775"></a><a class="code" href="classaffx_1_1_tsv_file.html#d48fffe7f1da96a74aa5904b36eed2b8">02775</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)
<a name="l02776"></a>02776 {
<a name="l02777"></a>02777   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02778"></a>02778 }
<a name="l02779"></a>02779 <span class="keywordtype">int</span>
<a name="l02780"></a><a class="code" href="classaffx_1_1_tsv_file.html#25ecd895ae746d7e5046e51e0ca8e7e3">02780</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,uint64_t val)
<a name="l02781"></a>02781 {
<a name="l02782"></a>02782   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02783"></a>02783 }
<a name="l02784"></a>02784 <span class="keywordtype">int</span>
<a name="l02785"></a><a class="code" href="classaffx_1_1_tsv_file.html#9825ae0ef08ddf8283c9c0dd93b4f0d1">02785</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,std::string cidx,std::string val)
<a name="l02786"></a>02786 {
<a name="l02787"></a>02787   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02788"></a>02788 }
<a name="l02789"></a>02789 <span class="keywordtype">int</span>
<a name="l02790"></a><a class="code" href="classaffx_1_1_tsv_file.html#6ed1ca1704a0d019975a8550022223ae">02790</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,std::string cidx,<span class="keywordtype">int</span> val)
<a name="l02791"></a>02791 {
<a name="l02792"></a>02792   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02793"></a>02793 }
<a name="l02794"></a>02794 <span class="keywordtype">int</span>
<a name="l02795"></a><a class="code" href="classaffx_1_1_tsv_file.html#920952cf4bd32745dc7c9d7e9c1f43fb">02795</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,std::string cidx,<span class="keywordtype">double</span> val)
<a name="l02796"></a>02796 {
<a name="l02797"></a>02797   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02798"></a>02798 }
<a name="l02799"></a>02799 <span class="keywordtype">int</span>
<a name="l02800"></a><a class="code" href="classaffx_1_1_tsv_file.html#3ff4df94b13030b4d83e507fc5461f53">02800</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,std::string cidx,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)
<a name="l02801"></a>02801 {
<a name="l02802"></a>02802   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02803"></a>02803 }
<a name="l02804"></a>02804 <span class="keywordtype">int</span>
<a name="l02805"></a><a class="code" href="classaffx_1_1_tsv_file.html#078f0859e689ee23b2a100f9d62339c7">02805</a> <a class="code" href="classaffx_1_1_tsv_file.html#db7f110e1ed25b8c5ae6ca964fbdf02e">affx::TsvFile::set</a>(<span class="keywordtype">int</span> clvl,std::string cidx,uint64_t val)
<a name="l02806"></a>02806 {
<a name="l02807"></a>02807   <a class="code" href="_tsv_file_8cpp.html#6c42f3d3b6ace4b9616403abe7b83307" title="Handy code to get the value of a column.">TSV_SET_VALUE</a>();
<a name="l02808"></a>02808 }
<a name="l02809"></a>02809 
<a name="l02810"></a>02810 <span class="comment">// dont need it any more.</span>
<a name="l02811"></a>02811 <span class="preprocessor">#undef TSV_SET_VALUE</span>
<a name="l02812"></a>02812 <span class="preprocessor"></span>
<a name="l02814"></a>02814 
<a name="l02819"></a>02819 <span class="keywordtype">bool</span>
<a name="l02820"></a><a class="code" href="classaffx_1_1_tsv_file.html#a44d15cf6b769e48a429d26c0cf6a183">02820</a> <a class="code" href="classaffx_1_1_tsv_file.html#a44d15cf6b769e48a429d26c0cf6a183" title="Is the field set?">affx::TsvFile::isNull</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx)
<a name="l02821"></a>02821 {
<a name="l02822"></a>02822   <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* col=<a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,cidx);
<a name="l02823"></a>02823   <span class="keywordflow">if</span> (col==NULL) {
<a name="l02824"></a>02824     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02825"></a>02825   }
<a name="l02826"></a>02826   <span class="keywordflow">return</span> col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>;
<a name="l02827"></a>02827 }
<a name="l02832"></a>02832 <span class="keywordtype">bool</span>
<a name="l02833"></a><a class="code" href="classaffx_1_1_tsv_file.html#708842fead24ec7f80c3fc342d61c94f">02833</a> <a class="code" href="classaffx_1_1_tsv_file.html#a44d15cf6b769e48a429d26c0cf6a183" title="Is the field set?">affx::TsvFile::isNull</a>(<span class="keywordtype">int</span> clvl,<span class="keyword">const</span> std::string&amp; cname)
<a name="l02834"></a>02834 {
<a name="l02835"></a>02835   <a class="code" href="classaffx_1_1_tsv_file_field.html">TsvFileField</a>* col=<a class="code" href="classaffx_1_1_tsv_file.html#b3ba9d0fb98a8d6e10aa17c244314caf" title="Get a pointer to a column given clvl and cidx.">clvlcidx2colptr</a>(clvl,cname);
<a name="l02836"></a>02836   <span class="keywordflow">if</span> (col==NULL) {
<a name="l02837"></a>02837     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02838"></a>02838   }
<a name="l02839"></a>02839   <span class="keywordflow">return</span> col-&gt;<a class="code" href="classaffx_1_1_tsv_file_field.html#d07b4cd7c58abde9bbb55b50aec60185" title="True if null.">m_isnull</a>;
<a name="l02840"></a>02840 }
<a name="l02841"></a>02841 
<a name="l02843"></a>02843 
<a name="l02846"></a>02846 <span class="keywordtype">void</span>
<a name="l02847"></a><a class="code" href="classaffx_1_1_tsv_file.html#810a372fdb6a99851201ea72d5e63b35">02847</a> <a class="code" href="classaffx_1_1_tsv_file.html#810a372fdb6a99851201ea72d5e63b35" title="used for debugging">affx::TsvFile::dump</a>()
<a name="l02848"></a>02848 {
<a name="l02849"></a>02849   <span class="comment">//</span>
<a name="l02850"></a>02850   printf(<span class="stringliteral">"TsvDump====================\n"</span>);
<a name="l02851"></a>02851   printf(<span class="stringliteral">"== tsv: filename='%s'\n"</span>,<a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>.c_str());
<a name="l02852"></a>02852   <a class="code" href="classaffx_1_1_tsv_file.html#f3fbb02ae6a5a7c7cd889b6e0700be7d" title="Dump the header values of the tsvfile Used for debugging.">dump_headers</a>();
<a name="l02853"></a>02853   <a class="code" href="classaffx_1_1_tsv_file.html#a3cf3d7e47888ee1c57d05d94c57b5f8" title="Dump the bindings of the tsvfile Used for debugging.">dump_bindings</a>();
<a name="l02854"></a>02854   printf(<span class="stringliteral">"====================\n"</span>);
<a name="l02855"></a>02855 }
<a name="l02856"></a>02856 
<a name="l02859"></a>02859 <span class="keywordtype">void</span>
<a name="l02860"></a><a class="code" href="classaffx_1_1_tsv_file.html#f3fbb02ae6a5a7c7cd889b6e0700be7d">02860</a> <a class="code" href="classaffx_1_1_tsv_file.html#f3fbb02ae6a5a7c7cd889b6e0700be7d" title="Dump the header values of the tsvfile Used for debugging.">affx::TsvFile::dump_headers</a>()
<a name="l02861"></a>02861 {
<a name="l02862"></a>02862   printf(<span class="stringliteral">"=== headers:\n"</span>);
<a name="l02863"></a>02863   <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFile::header_t</a>* h_ptr;
<a name="l02864"></a>02864   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> hi=0;hi&lt;(int)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();hi++) {
<a name="l02865"></a>02865     h_ptr=<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[hi];
<a name="l02866"></a>02866     printf(<span class="stringliteral">"==header: "</span>);
<a name="l02867"></a>02867     <span class="keywordflow">if</span> (h_ptr==NULL) {
<a name="l02868"></a>02868       printf(<span class="stringliteral">"NULL\n"</span>);
<a name="l02869"></a>02869       <span class="keywordflow">continue</span>;
<a name="l02870"></a>02870     }
<a name="l02871"></a>02871     <span class="keywordflow">if</span> (h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>==<span class="stringliteral">""</span>) {
<a name="l02872"></a>02872       printf(<span class="stringliteral">"%2d:#%s\n"</span>,h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>,h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a>.c_str());
<a name="l02873"></a>02873     } <span class="keywordflow">else</span> {
<a name="l02874"></a>02874       printf(<span class="stringliteral">"%2d:#%%%s=%s\n"</span>,h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#30831dfd569414efc6669bf406fb726c">m_order</a>,h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>.c_str(),h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a>.c_str());
<a name="l02875"></a>02875     }
<a name="l02876"></a>02876   }
<a name="l02877"></a>02877 
<a name="l02878"></a>02878   <span class="comment">//</span>
<a name="l02879"></a>02879   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size();++clvl) {
<a name="l02880"></a>02880     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> col=0;col&lt;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();col++) {
<a name="l02881"></a>02881       printf(<span class="stringliteral">"==map: %3d: %3d : %s\n"</span>,clvl,col,<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][col].m_cname.c_str());
<a name="l02882"></a>02882     }
<a name="l02883"></a>02883   }
<a name="l02884"></a>02884 }
<a name="l02885"></a>02885 
<a name="l02888"></a>02888 <span class="keywordtype">void</span>
<a name="l02889"></a><a class="code" href="classaffx_1_1_tsv_file.html#a3cf3d7e47888ee1c57d05d94c57b5f8">02889</a> <a class="code" href="classaffx_1_1_tsv_file.html#a3cf3d7e47888ee1c57d05d94c57b5f8" title="Dump the bindings of the tsvfile Used for debugging.">affx::TsvFile::dump_bindings</a>()
<a name="l02890"></a>02890 {
<a name="l02891"></a>02891   printf(<span class="stringliteral">"==bindings:\n"</span>);
<a name="l02892"></a>02892 
<a name="l02893"></a>02893   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi=0;vi&lt;<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>.size();vi++) {
<a name="l02894"></a>02894     <a class="code" href="classaffx_1_1_tsv_file_binding.html">TsvFileBinding</a>* var=<a class="code" href="classaffx_1_1_tsv_file.html#cd47b2c025f8133985c0162d5db7f2c4" title="Vector of bindings linked to us.">m_linkvars_vec</a>[vi];
<a name="l02895"></a>02895     printf(<span class="stringliteral">"%3d : %p : bound to clvl=%2d cidx=%2d cname='%s')\n"</span>,
<a name="l02896"></a>02896            vi,var,
<a name="l02897"></a>02897            var-&gt;m_bindto_clvl,var-&gt;m_bindto_cidx,var-&gt;m_bindto_cname.c_str());
<a name="l02898"></a>02898   }
<a name="l02899"></a>02899 }
<a name="l02900"></a>02900 
<a name="l02903"></a>02903 <span class="keywordtype">void</span>
<a name="l02904"></a><a class="code" href="classaffx_1_1_tsv_file.html#144f0dff562c7341f09b66f9731b8975">02904</a> <a class="code" href="classaffx_1_1_tsv_file.html#144f0dff562c7341f09b66f9731b8975" title="Dump the data of the tsvfile Used for debugging.">affx::TsvFile::dump_data</a>()
<a name="l02905"></a>02905 {
<a name="l02906"></a>02906   <span class="keywordtype">string</span> tmpstr;
<a name="l02907"></a>02907 
<a name="l02908"></a>02908   <span class="keywordflow">while</span> (<a class="code" href="classaffx_1_1_tsv_file.html#232aa58909f1bac888dfcec7d2694d99" title="advance to the next line and bind the values">nextLine</a>()==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l02909"></a>02909     <span class="keywordtype">int</span> clvl=<a class="code" href="classaffx_1_1_tsv_file.html#0bc68ccdf8993fd46b812c7743f8ab1d" title="The indentation level of the line just read.">lineLevel</a>();
<a name="l02910"></a>02910     printf(<span class="stringliteral">"%02d :"</span>,clvl);
<a name="l02911"></a>02911     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cidx=0;cidx&lt;<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(clvl);cidx++) {
<a name="l02912"></a>02912       <span class="keywordflow">if</span> (cidx!=0) {
<a name="l02913"></a>02913         <span class="comment">//printf("%c",m_optFieldSep);</span>
<a name="l02914"></a>02914         printf(<span class="stringliteral">"|"</span>);
<a name="l02915"></a>02915       }
<a name="l02916"></a>02916       <span class="keyword">get</span>(clvl,cidx,tmpstr);
<a name="l02917"></a>02917       printf(<span class="stringliteral">"%d='%s'"</span>,cidx,tmpstr.c_str());
<a name="l02918"></a>02918     }
<a name="l02919"></a>02919     printf(<span class="stringliteral">"\n"</span>);
<a name="l02920"></a>02920   }
<a name="l02921"></a>02921   printf(<span class="stringliteral">"== Read %6d lines\n"</span>,<a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>);
<a name="l02922"></a>02922 }
<a name="l02923"></a>02923 
<a name="l02924"></a>02924 
<a name="l02927"></a>02927 <span class="keywordtype">void</span>
<a name="l02928"></a><a class="code" href="classaffx_1_1_tsv_file.html#47fd71b7a76c08fbe8bbc113d16d6a2e">02928</a> <a class="code" href="classaffx_1_1_tsv_file.html#47fd71b7a76c08fbe8bbc113d16d6a2e" title="Dump the indexes Used for debugging.">affx::TsvFile::dump_indexes</a>()
<a name="l02929"></a>02929 {
<a name="l02930"></a>02930   printf(<span class="stringliteral">"indexes ------------------------------\n"</span>);
<a name="l02931"></a>02931   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.size();i++) {
<a name="l02932"></a>02932     <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l02933"></a>02933     <span class="keywordflow">if</span> (idx!=NULL) {
<a name="l02934"></a>02934       idx-&gt;dump();
<a name="l02935"></a>02935     }
<a name="l02936"></a>02936   }
<a name="l02937"></a>02937 }
<a name="l02938"></a>02938 
<a name="l02940"></a>02940 
<a name="l02943"></a>02943 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l02944"></a><a class="code" href="classaffx_1_1_tsv_file.html#26a8014deae67b0da529a4b01002a2f3">02944</a> <a class="code" href="classaffx_1_1_tsv_file.html#26a8014deae67b0da529a4b01002a2f3" title="Allocate a TsvFileIndex.">affx::TsvFile::index_alloc</a>()
<a name="l02945"></a>02945 {
<a name="l02946"></a>02946   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<span class="keyword">new</span> <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>;
<a name="l02947"></a>02947   <a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.push_back(idx);
<a name="l02948"></a>02948   <span class="comment">// we will need to index</span>
<a name="l02949"></a>02949   <a class="code" href="classaffx_1_1_tsv_file.html#aeaef7bc8e0d7ad6c99ecc164fd76e6f" title="Have the indexing been done?">m_index_done</a>=<span class="keyword">false</span>;
<a name="l02950"></a>02950   <span class="keywordflow">return</span> idx;
<a name="l02951"></a>02951 }
<a name="l02952"></a>02952 
<a name="l02960"></a>02960 <span class="keywordtype">int</span>
<a name="l02961"></a><a class="code" href="classaffx_1_1_tsv_file.html#bc70cebd4314ec2e324179b5cf08e365">02961</a> <a class="code" href="classaffx_1_1_tsv_file.html#bc70cebd4314ec2e324179b5cf08e365" title="Creates an index object.">affx::TsvFile::defineIndex</a>(<span class="keywordtype">int</span> clvl,std::string cname,<span class="keywordtype">int</span> kind,<span class="keywordtype">int</span> flags)
<a name="l02962"></a>02962 {
<a name="l02963"></a>02963   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#26a8014deae67b0da529a4b01002a2f3" title="Allocate a TsvFileIndex.">index_alloc</a>();
<a name="l02964"></a>02964   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#857dff7db112983051637e63606887ff" title="Is is bound by index or name?">m_bindto_type</a>=<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f779f57e202ae1434b9ecc5c2230b295d04" title="Bound to a column index by name.">TSV_BINDTO_CNAME</a>;
<a name="l02965"></a>02965   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>=clvl;
<a name="l02966"></a>02966   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262b51aaf06c8c90645986c670981843" title="The name of the bound column.">m_bindto_cname</a>=cname;
<a name="l02967"></a>02967   <span class="comment">//</span>
<a name="l02968"></a>02968   assert(kind!=0);
<a name="l02969"></a>02969   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>=kind;
<a name="l02970"></a>02970   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#c7c7485653fb1767e5dc83078ff5941d" title="flags for the index (unused)">m_flags</a>=flags;
<a name="l02971"></a>02971   <span class="comment">//</span>
<a name="l02972"></a>02972   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02973"></a>02973 }
<a name="l02974"></a>02974 
<a name="l02981"></a>02981 <span class="keywordtype">int</span>
<a name="l02982"></a><a class="code" href="classaffx_1_1_tsv_file.html#161d966b89656737c56616872d276d2e">02982</a> <a class="code" href="classaffx_1_1_tsv_file.html#bc70cebd4314ec2e324179b5cf08e365" title="Creates an index object.">affx::TsvFile::defineIndex</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span> kind,<span class="keywordtype">int</span> flags)
<a name="l02983"></a>02983 {
<a name="l02984"></a>02984   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#26a8014deae67b0da529a4b01002a2f3" title="Allocate a TsvFileIndex.">index_alloc</a>();
<a name="l02985"></a>02985   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#857dff7db112983051637e63606887ff" title="Is is bound by index or name?">m_bindto_type</a>=<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f779f53ea209c66c63f7593f763a26cf828" title="Bound to column indexed by number.">TSV_BINDTO_CIDX</a>;
<a name="l02986"></a>02986   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>=clvl;
<a name="l02987"></a>02987   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>=cidx;
<a name="l02988"></a>02988   <span class="comment">//</span>
<a name="l02989"></a>02989   assert(kind!=0);
<a name="l02990"></a>02990   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>=kind;
<a name="l02991"></a>02991   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#c7c7485653fb1767e5dc83078ff5941d" title="flags for the index (unused)">m_flags</a>=flags;
<a name="l02992"></a>02992   <span class="comment">//</span>
<a name="l02993"></a>02993   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l02994"></a>02994 }
<a name="l02995"></a>02995 
<a name="l02999"></a>02999 <span class="keywordtype">int</span>
<a name="l03000"></a><a class="code" href="classaffx_1_1_tsv_file.html#1ad0664966f4e32c40c121ae1c2415da">03000</a> <a class="code" href="classaffx_1_1_tsv_file.html#1ad0664966f4e32c40c121ae1c2415da" title="Seek to the start of a line but dont read it.">affx::TsvFile::seekLine</a>(<a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a> line)
<a name="l03001"></a>03001 {
<a name="l03002"></a>03002   <span class="comment">//</span>
<a name="l03003"></a>03003   <a class="code" href="classaffx_1_1_tsv_file.html#0b78a25d7cd2bf4da27f61d9b12c1604" title="build the indexes if needed">indexBuildMaybe</a>();
<a name="l03004"></a>03004   <span class="comment">// off the end?</span>
<a name="l03005"></a>03005   <span class="keywordflow">if</span> (line&gt;<a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>.size()) {
<a name="l03006"></a>03006     assert(0);
<a name="l03007"></a>03007     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03008"></a>03008   }
<a name="l03009"></a>03009   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.clear();
<a name="l03010"></a>03010   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(<a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>[line]);
<a name="l03011"></a>03011   <span class="comment">// we seeked to this line, but did not read it.</span>
<a name="l03012"></a>03012   <a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>=line;
<a name="l03013"></a>03013   <span class="comment">//</span>
<a name="l03014"></a>03014   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l03015"></a>03015     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l03016"></a>03016   }
<a name="l03017"></a>03017   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03018"></a>03018 }
<a name="l03019"></a>03019 
<a name="l03026"></a>03026 <span class="keywordtype">int</span>
<a name="l03027"></a><a class="code" href="classaffx_1_1_tsv_file.html#d820da0133284ff076ae1fe23a07053c">03027</a> <a class="code" href="classaffx_1_1_tsv_file.html#d820da0133284ff076ae1fe23a07053c" title="goto a line reading the parent lines and then the line itself">affx::TsvFile::gotoLine</a>(<a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a> line)
<a name="l03028"></a>03028 {
<a name="l03029"></a>03029   vector&lt;linenum_t&gt;::iterator lb;
<a name="l03030"></a>03030   <a class="code" href="namespaceaffx.html#02a4b3a5a70d459d675eec00d3731f2d" title="line numbers cant be negative">linenum_t</a> sline;
<a name="l03031"></a>03031 
<a name="l03032"></a>03032   <span class="comment">// do some bookkeeping first</span>
<a name="l03033"></a>03033   <a class="code" href="classaffx_1_1_tsv_file.html#31aaf0d13dab55322b5c1904cca41cfe" title="Clear all the fields. (set them all to null).">clearFields</a>();
<a name="l03034"></a>03034   <a class="code" href="classaffx_1_1_tsv_file.html#0b78a25d7cd2bf4da27f61d9b12c1604" title="build the indexes if needed">indexBuildMaybe</a>();
<a name="l03035"></a>03035   <span class="comment">//printf("gotoLine(%d)===\n",line);</span>
<a name="l03036"></a>03036 
<a name="l03037"></a>03037   <span class="keywordflow">if</span> (line&gt;=<a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>.size()) {
<a name="l03038"></a>03038     <span class="keywordtype">int</span> maxLine = (<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>.size();
<a name="l03039"></a>03039         <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>)
<a name="l03040"></a>03040       <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<span class="stringliteral">"TSV:ERROR: cant goto line "</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(line) + <span class="stringliteral">" of "</span> + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(maxLine));
<a name="l03041"></a>03041     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03042"></a>03042   }
<a name="l03043"></a>03043 
<a name="l03044"></a>03044   <span class="comment">// Goto each parent lines first</span>
<a name="l03045"></a>03045   <span class="comment">// This will bind the parent values so the view of the data is consistent</span>
<a name="l03046"></a>03046   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;<a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>.size();clvl++) {
<a name="l03047"></a>03047     lb=lower_bound(<a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>[clvl].begin(),<a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>[clvl].end(),line);
<a name="l03048"></a>03048     <span class="comment">// Is this a parent line?</span>
<a name="l03049"></a>03049     <span class="keywordflow">if</span> ((lb==<a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>[clvl].end())||(*lb&gt;line)) {
<a name="l03050"></a>03050       sline=*(lb-1);
<a name="l03051"></a>03051     } <span class="keywordflow">else</span> {
<a name="l03052"></a>03052       sline=*lb;
<a name="l03053"></a>03053     }
<a name="l03054"></a>03054     <span class="comment">// move and parse</span>
<a name="l03055"></a>03055     <span class="comment">//printf("%2d : seek(%d)\n",clvl,sline);</span>
<a name="l03056"></a>03056     <a class="code" href="classaffx_1_1_tsv_file.html#1ad0664966f4e32c40c121ae1c2415da" title="Seek to the start of a line but dont read it.">seekLine</a>(sline);
<a name="l03057"></a>03057     <a class="code" href="classaffx_1_1_tsv_file.html#232aa58909f1bac888dfcec7d2694d99" title="advance to the next line and bind the values">nextLine</a>();
<a name="l03058"></a>03058     <span class="comment">// done?</span>
<a name="l03059"></a>03059     <span class="keywordflow">if</span> (sline==line) {
<a name="l03060"></a>03060       <span class="keywordflow">break</span>;
<a name="l03061"></a>03061     }
<a name="l03062"></a>03062   }
<a name="l03063"></a>03063 
<a name="l03064"></a>03064   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03065"></a>03065 }
<a name="l03066"></a>03066 
<a name="l03069"></a>03069 <span class="keywordtype">int</span>
<a name="l03070"></a><a class="code" href="classaffx_1_1_tsv_file.html#40d7e021ab69df52e3ec0019320d552a">03070</a> <a class="code" href="classaffx_1_1_tsv_file.html#40d7e021ab69df52e3ec0019320d552a" title="build the indexes for a file">affx::TsvFile::indexBuild</a>()
<a name="l03071"></a>03071 {
<a name="l03072"></a>03072   std::fstream::pos_type excursion_fpos;
<a name="l03073"></a>03073   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx;
<a name="l03074"></a>03074 
<a name="l03075"></a>03075   <span class="comment">//</span>
<a name="l03076"></a>03076   <a class="code" href="classaffx_1_1_tsv_file.html#aeaef7bc8e0d7ad6c99ecc164fd76e6f" title="Have the indexing been done?">m_index_done</a>=<span class="keyword">false</span>;
<a name="l03077"></a>03077 
<a name="l03078"></a>03078   <span class="comment">// force building the line index  // DEBUGGING</span>
<a name="l03079"></a>03079   <span class="comment">//option_lineindex=true;</span>
<a name="l03080"></a>03080   <span class="comment">// neednt bother building the indexes.</span>
<a name="l03081"></a>03081   <span class="comment">//if ((option_lineindex==false)&amp;&amp;(m_index_vec.size()==0)) {</span>
<a name="l03082"></a>03082   <span class="comment">//return TSV_OK;</span>
<a name="l03083"></a>03083   <span class="comment">//}</span>
<a name="l03084"></a>03084 
<a name="l03085"></a>03085   <span class="comment">// clear out the line mappings</span>
<a name="l03086"></a>03086   <a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>.clear();
<a name="l03087"></a>03087   <a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>.resize(<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size());
<a name="l03088"></a>03088   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;<a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>.size();clvl++) {
<a name="l03089"></a>03089     <a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>[clvl].<a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l03090"></a>03090   }
<a name="l03091"></a>03091 
<a name="l03092"></a>03092   <span class="comment">// clear out the indexes.</span>
<a name="l03093"></a>03093   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.size();i++) {
<a name="l03094"></a>03094     idx=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l03095"></a>03095     <span class="keywordflow">if</span> (idx!=NULL) {
<a name="l03096"></a>03096       idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#0de3ff913576f001420ec842b9536da6" title="Clear the contents of the index.">clear</a>();
<a name="l03097"></a>03097       <span class="comment">// pre-compute the cidxes of the indexes which are by name</span>
<a name="l03098"></a>03098       <span class="keywordflow">if</span> (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#857dff7db112983051637e63606887ff" title="Is is bound by index or name?">m_bindto_type</a>==<a class="code" href="namespaceaffx.html#27bf433b7084d006aef794a5238a4f779f57e202ae1434b9ecc5c2230b295d04" title="Bound to a column index by name.">TSV_BINDTO_CNAME</a>) {
<a name="l03099"></a>03099         idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>=<a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">cname2cidx</a>(idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>,idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262b51aaf06c8c90645986c670981843" title="The name of the bound column.">m_bindto_cname</a>);
<a name="l03100"></a>03100       }
<a name="l03101"></a>03101     }
<a name="l03102"></a>03102   }
<a name="l03103"></a>03103 
<a name="l03104"></a>03104   <span class="comment">// remember where we are before we rewind</span>
<a name="l03105"></a>03105   excursion_fpos=<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.tellg();
<a name="l03106"></a>03106   <a class="code" href="classaffx_1_1_tsv_file.html#05d594ceb54634fb1f39ca768276800e" title="Rewind back to the start of the data and clear the fields.">rewind</a>();
<a name="l03107"></a>03107 
<a name="l03108"></a>03108   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m_index_vec_size=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.size();
<a name="l03109"></a>03109 
<a name="l03110"></a>03110   <span class="keywordtype">int</span> l_num;
<a name="l03111"></a>03111   <span class="keywordflow">while</span> (<a class="code" href="classaffx_1_1_tsv_file.html#232aa58909f1bac888dfcec7d2694d99" title="advance to the next line and bind the values">nextLine</a>()==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l03112"></a>03112     l_num=<a class="code" href="classaffx_1_1_tsv_file.html#687c61f6c31c68e430a46a9b4252178a" title="The current line number.">m_lineNum</a>-1; <span class="comment">// because nextLine went past it.</span>
<a name="l03113"></a>03113     <span class="comment">// line-&gt;fpos</span>
<a name="l03114"></a>03114     <a class="code" href="classaffx_1_1_tsv_file.html#ffe21fdfdaed852331dcb366176ccaec" title="A map of line numbers to file postions.">m_index_linefpos</a>.push_back(<a class="code" href="classaffx_1_1_tsv_file.html#616159e779c4780d796dcf55fc138ce4" title="Where the current line starts.">m_line_fpos</a>);
<a name="l03115"></a>03115     <span class="comment">// if m_lineLvl is &lt;0, then it was a comment or blank line</span>
<a name="l03116"></a>03116     <span class="comment">// and there no need to do the rest</span>
<a name="l03117"></a>03117     <span class="comment">//printf("L1: %4d : %4d : %u\n",l_num,m_lineLvl,(unsigned int)m_line_fpos);</span>
<a name="l03118"></a>03118     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>&lt;0) {
<a name="l03119"></a>03119       <span class="comment">// skip this line</span>
<a name="l03120"></a>03120       <span class="keywordflow">continue</span>;
<a name="l03121"></a>03121     }
<a name="l03122"></a>03122     <span class="comment">// parent-child lines</span>
<a name="l03123"></a>03123     <a class="code" href="classaffx_1_1_tsv_file.html#c2801991fef70e9df6fbd06f92010cb7" title="A map of line numbers by level so we can find the parent lines.">m_index_lineclvl</a>[<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>].push_back(l_num);
<a name="l03124"></a>03124     <span class="comment">//std::string key;</span>
<a name="l03125"></a>03125     <span class="comment">//std::string val;</span>
<a name="l03126"></a>03126     <span class="comment">//get(0,0,key);</span>
<a name="l03127"></a>03127     <span class="comment">//get(0,1,val);</span>
<a name="l03128"></a>03128     <span class="comment">//printf("L2: K:'%s' V:'%s'\n",key.c_str(),val.c_str());</span>
<a name="l03129"></a>03129 
<a name="l03130"></a>03130     <span class="comment">//</span>
<a name="l03131"></a>03131     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;m_index_vec_size;i++) {
<a name="l03132"></a>03132       <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l03133"></a>03133       <span class="keywordflow">if</span> ((idx!=NULL)&amp;&amp;
<a name="l03134"></a>03134           (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>==<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>)&amp;&amp;
<a name="l03135"></a>03135           (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>&gt;=0)) {
<a name="l03136"></a>03136         idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#84f008400f7208f86b35272f29590036" title="Add the data from field to the index.">data_add</a>(&amp;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[<a class="code" href="classaffx_1_1_tsv_file.html#d42dbdba229befe7315f296ff4844935" title="The level of the current line.">m_lineLvl</a>][idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>],l_num);
<a name="l03137"></a>03137       }
<a name="l03138"></a>03138     }
<a name="l03139"></a>03139   }
<a name="l03140"></a>03140 
<a name="l03141"></a>03141   <span class="comment">//</span>
<a name="l03142"></a>03142   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.clear();
<a name="l03143"></a>03143   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.seekg(excursion_fpos);
<a name="l03144"></a>03144 
<a name="l03145"></a>03145   <span class="comment">// mark the indexes as done</span>
<a name="l03146"></a>03146   <a class="code" href="classaffx_1_1_tsv_file.html#aeaef7bc8e0d7ad6c99ecc164fd76e6f" title="Have the indexing been done?">m_index_done</a>=<span class="keyword">true</span>;
<a name="l03147"></a>03147   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;m_index_vec_size;i++) {
<a name="l03148"></a>03148     <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l03149"></a>03149     <span class="keywordflow">if</span> (idx!=NULL) {
<a name="l03150"></a>03150       idx-&gt;m_done=<span class="keyword">true</span>;
<a name="l03151"></a>03151     }
<a name="l03152"></a>03152   }
<a name="l03153"></a>03153 
<a name="l03154"></a>03154   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03155"></a>03155 }
<a name="l03156"></a>03156 
<a name="l03159"></a>03159 <span class="keywordtype">int</span>
<a name="l03160"></a><a class="code" href="classaffx_1_1_tsv_file.html#0b78a25d7cd2bf4da27f61d9b12c1604">03160</a> <a class="code" href="classaffx_1_1_tsv_file.html#0b78a25d7cd2bf4da27f61d9b12c1604" title="build the indexes if needed">affx::TsvFile::indexBuildMaybe</a>()
<a name="l03161"></a>03161 {
<a name="l03162"></a>03162   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#aeaef7bc8e0d7ad6c99ecc164fd76e6f" title="Have the indexing been done?">m_index_done</a>) {
<a name="l03163"></a>03163     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03164"></a>03164   }
<a name="l03165"></a>03165   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#40d7e021ab69df52e3ec0019320d552a" title="build the indexes for a file">indexBuild</a>();
<a name="l03166"></a>03166 }
<a name="l03167"></a>03167 
<a name="l03173"></a>03173 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03174"></a><a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa">03174</a> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">affx::TsvFile::index_matching</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span> kind)
<a name="l03175"></a>03175 {
<a name="l03176"></a>03176   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx;
<a name="l03177"></a>03177 
<a name="l03178"></a>03178   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>.size();i++) {
<a name="l03179"></a>03179     idx=<a class="code" href="classaffx_1_1_tsv_file.html#6881e025959a1a35b8ece5350b46114c" title="A vector of indexes which are defined.">m_index_vec</a>[i];
<a name="l03180"></a>03180     <span class="keywordflow">if</span> ((idx!=NULL)&amp;&amp;
<a name="l03181"></a>03181         (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#262f31f860e1061211fb06499480b1c8" title="Maybe we should inherit The column level.">m_bindto_clvl</a>==clvl)&amp;&amp;
<a name="l03182"></a>03182         (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#6880fc2229b4500cd961422bed5eaa1b" title="The index of the bound column.">m_bindto_cidx</a>==cidx)&amp;&amp;
<a name="l03183"></a>03183         (idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#83577d46ddccf51dd8dee4a244a145d6" title="The datatype being indexed (string,int,double).">m_kind</a>==kind)) {
<a name="l03184"></a>03184       <span class="keywordflow">return</span> idx;
<a name="l03185"></a>03185     }
<a name="l03186"></a>03186   }
<a name="l03187"></a>03187   <span class="keywordflow">return</span> NULL;
<a name="l03188"></a>03188 }
<a name="l03189"></a>03189 
<a name="l03195"></a>03195 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03196"></a><a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab">03196</a> <a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">affx::TsvFile::index_matching_1</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,std::string&amp; val)
<a name="l03197"></a>03197 {
<a name="l03198"></a>03198   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">index_matching</a>(clvl,cidx,<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde0752a4477d57a28231801839cff95671">TSV_INDEX_STRING</a>);
<a name="l03199"></a>03199 }
<a name="l03205"></a>03205 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03206"></a><a class="code" href="classaffx_1_1_tsv_file.html#130f539477c0741f6409ba820a1fe763">03206</a> <a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">affx::TsvFile::index_matching_1</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">int</span> val)
<a name="l03207"></a>03207 {
<a name="l03208"></a>03208   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">index_matching</a>(clvl,cidx,<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde39cd17e4abd754e8a89d12696f884dcd">TSV_INDEX_INT</a>);
<a name="l03209"></a>03209 }
<a name="l03215"></a>03215 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03216"></a><a class="code" href="classaffx_1_1_tsv_file.html#6d09ce1376b9c1c8ad87e9bfe8544dcf">03216</a> <a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">affx::TsvFile::index_matching_1</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">double</span> val)
<a name="l03217"></a>03217 {
<a name="l03218"></a>03218   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">index_matching</a>(clvl,cidx,<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fded10c38eff0744c579861fd8fc8d28be7">TSV_INDEX_DOUBLE</a>);
<a name="l03219"></a>03219 }
<a name="l03225"></a>03225 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03226"></a><a class="code" href="classaffx_1_1_tsv_file.html#02c2332c73cf294bb18082d1730c2915">03226</a> <a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">affx::TsvFile::index_matching_1</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)
<a name="l03227"></a>03227 {
<a name="l03228"></a>03228   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">index_matching</a>(clvl,cidx,<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fdea1d767928435e2bd1ef9fc8a6c5648a0">TSV_INDEX_UINT</a>);
<a name="l03229"></a>03229 }
<a name="l03235"></a>03235 <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>*
<a name="l03236"></a><a class="code" href="classaffx_1_1_tsv_file.html#fd021e3175ecf89748b49697a0e01adc">03236</a> <a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">affx::TsvFile::index_matching_1</a>(<span class="keywordtype">int</span> clvl,<span class="keywordtype">int</span> cidx,uint64_t val)
<a name="l03237"></a>03237 {
<a name="l03238"></a>03238   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#6e0a5bcfe38150343bdae3395a551afa" title="Find an index which matches what we need.">index_matching</a>(clvl,cidx,<a class="code" href="namespaceaffx.html#03434280a6467bb8c1782af585c92fde2508bed5b4f250e5a0ef3fc94b300130">TSV_INDEX_ULONGLONG</a>);
<a name="l03239"></a>03239 }
<a name="l03240"></a>03240 
<a name="l03243"></a>03243 <span class="keywordtype">int</span>
<a name="l03244"></a><a class="code" href="classaffx_1_1_tsv_file.html#ff4dcfb6c96a8f777314192f9dc4a754">03244</a> <a class="code" href="classaffx_1_1_tsv_file.html#ff4dcfb6c96a8f777314192f9dc4a754" title="Clear the results of the last findBegin.">affx::TsvFile::findResultsClear</a>()
<a name="l03245"></a>03245 {
<a name="l03246"></a>03246   <a class="code" href="classaffx_1_1_tsv_file.html#5b3d9d8e1ac6b11d4b2cd108794c2cc7" title="The postition we are at in the returned results.">m_findresults_pos</a>=0;
<a name="l03247"></a>03247   <a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>.clear();
<a name="l03248"></a>03248   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03249"></a>03249 }
<a name="l03250"></a>03250 
<a name="l03258"></a>03258 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1,<span class="keyword">typename</span> T2&gt;
<a name="l03259"></a>03259 <span class="keywordtype">int</span>
<a name="l03260"></a><a class="code" href="classaffx_1_1_tsv_file.html#bb2c2105bce5d7cf854eb60e4e5af1dd">03260</a> <a class="code" href="classaffx_1_1_tsv_file.html#bb2c2105bce5d7cf854eb60e4e5af1dd" title="Handy template.">affx::TsvFile::findBegin_tmpl</a>(<span class="keywordtype">int</span> clvl,T1 cidx,<span class="keywordtype">int</span> op,T2 val,<span class="keywordtype">int</span> flags)
<a name="l03261"></a>03261 {
<a name="l03262"></a>03262   <span class="comment">// discard the old</span>
<a name="l03263"></a>03263   <a class="code" href="classaffx_1_1_tsv_file.html#ff4dcfb6c96a8f777314192f9dc4a754" title="Clear the results of the last findBegin.">findResultsClear</a>();
<a name="l03264"></a>03264 
<a name="l03265"></a>03265   <span class="comment">// gotta be there</span>
<a name="l03266"></a>03266   <span class="keywordtype">int</span> cidx_int=<a class="code" href="classaffx_1_1_tsv_file.html#2dbd33415a815e221ae61cf3feac5500" title="Covert a column index to a column index.">cname2cidx</a>(clvl,cidx);
<a name="l03267"></a>03267   <span class="keywordflow">if</span> ((clvl&lt;0)||(cidx_int&lt;0)) {
<a name="l03268"></a>03268     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03269"></a>03269   }
<a name="l03270"></a>03270 
<a name="l03271"></a>03271   <span class="comment">//</span>
<a name="l03272"></a>03272   <a class="code" href="classaffx_1_1_tsv_file.html#0b78a25d7cd2bf4da27f61d9b12c1604" title="build the indexes if needed">indexBuildMaybe</a>();
<a name="l03273"></a>03273 
<a name="l03274"></a>03274   <span class="comment">// which index to use?</span>
<a name="l03275"></a>03275   <a class="code" href="classaffx_1_1_tsv_file_index.html" title="TsvFileIndex maps values to line positions.">TsvFileIndex</a>* idx=<a class="code" href="classaffx_1_1_tsv_file.html#c69005cdefaf066881feed91c5135aab" title="Do we have a index on this column for strings?">index_matching_1</a>(clvl,cidx_int,val);
<a name="l03276"></a>03276   <span class="keywordflow">if</span> (idx==NULL) {
<a name="l03278"></a>03278     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03279"></a>03279   }
<a name="l03280"></a>03280 
<a name="l03281"></a>03281   <span class="comment">//</span>
<a name="l03282"></a>03282   <span class="comment">//if (idx-&gt;done==false) {</span>
<a name="l03283"></a>03283   <span class="comment">//indexBuild();</span>
<a name="l03284"></a>03284   <span class="comment">//}</span>
<a name="l03285"></a>03285 
<a name="l03286"></a>03286   <span class="comment">//</span>
<a name="l03287"></a>03287   idx-&gt;<a class="code" href="classaffx_1_1_tsv_file_index.html#ee60005a96ba38a670f3f036d8ae443b" title="Append the matching string results to the vec.">results_append</a>(<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>,op,val);
<a name="l03288"></a>03288 
<a name="l03289"></a>03289   <span class="comment">// should we sort by line position?</span>
<a name="l03290"></a>03290   <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="namespaceaffx.html#029aaa27f93ef8a94646fcbf424c0652679ce346e55ddbd6f4ca081a3f2d73d6">TSV_ORDERBY_LINE</a>)!=0) {
<a name="l03291"></a>03291     sort(<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>.begin(),<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>.end());
<a name="l03292"></a>03292   }
<a name="l03293"></a>03293 
<a name="l03294"></a>03294   <span class="comment">// dont go to the first result -- findNext will do the movement.</span>
<a name="l03295"></a>03295   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03296"></a>03296 }
<a name="l03297"></a>03297 
<a name="l03299"></a><a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d">03299</a> <span class="preprocessor">#define TSV_DEFUN_FIND_BEGIN(Xtype1,Xtype2) \</span>
<a name="l03300"></a>03300 <span class="preprocessor">int \</span>
<a name="l03301"></a>03301 <span class="preprocessor">affx::TsvFile::findBegin(int clvl,Xtype1 cidx,int op,Xtype2 val,int flags)  \</span>
<a name="l03302"></a>03302 <span class="preprocessor">{ \</span>
<a name="l03303"></a>03303 <span class="preprocessor">  return findBegin_tmpl(clvl,cidx,op,val,flags);    \</span>
<a name="l03304"></a>03304 <span class="preprocessor">}</span>
<a name="l03305"></a>03305 <span class="preprocessor"></span>
<a name="l03307"></a>03307 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(<span class="keywordtype">int</span>        ,std::string);
<a name="l03308"></a>03308 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(std::string,std::string);
<a name="l03309"></a>03309 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(<span class="keywordtype">int</span>        ,<span class="keywordtype">int</span>);
<a name="l03310"></a>03310 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(std::string,<span class="keywordtype">int</span>);
<a name="l03311"></a>03311 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(<span class="keywordtype">int</span>        ,<span class="keywordtype">double</span>);
<a name="l03312"></a>03312 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(std::string,<span class="keywordtype">double</span>);
<a name="l03313"></a>03313 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(<span class="keywordtype">int</span>        ,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<a name="l03314"></a>03314 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(std::string,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<a name="l03315"></a>03315 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(<span class="keywordtype">int</span>        ,uint64_t);
<a name="l03316"></a>03316 <a class="code" href="_tsv_file_8cpp.html#704cb5df14f6b1e417a21c4b365e4f4d" title="! Crank out the different types we want to expose to the programmer">TSV_DEFUN_FIND_BEGIN</a>(std::string,uint64_t);
<a name="l03317"></a>03317 
<a name="l03319"></a>03319 
<a name="l03322"></a>03322 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l03323"></a><a class="code" href="classaffx_1_1_tsv_file.html#28f87c82d8f1dd34cda9e6d8a662fb8e">03323</a> <a class="code" href="classaffx_1_1_tsv_file.html#28f87c82d8f1dd34cda9e6d8a662fb8e" title="Return the count of found lines.">affx::TsvFile::findResultsCount</a>()
<a name="l03324"></a>03324 {
<a name="l03325"></a>03325   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>.size();
<a name="l03326"></a>03326 }
<a name="l03327"></a>03327 
<a name="l03330"></a>03330 <span class="keywordtype">int</span>
<a name="l03331"></a><a class="code" href="classaffx_1_1_tsv_file.html#ddf2db55002ceaf2ccabbdc6dc07037f">03331</a> <a class="code" href="classaffx_1_1_tsv_file.html#ddf2db55002ceaf2ccabbdc6dc07037f" title="Goto the next result.">affx::TsvFile::findNext</a>()
<a name="l03332"></a>03332 {
<a name="l03333"></a>03333   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#5b3d9d8e1ac6b11d4b2cd108794c2cc7" title="The postition we are at in the returned results.">m_findresults_pos</a>&gt;=<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>.size()) {
<a name="l03334"></a>03334     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3956d15f90fef786bfa82fbec86d563d552" title="Found the last matching value.">TSV_FIND_LAST</a>;
<a name="l03335"></a>03335   }
<a name="l03336"></a>03336   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#d820da0133284ff076ae1fe23a07053c" title="goto a line reading the parent lines and then the line itself">gotoLine</a>(<a class="code" href="classaffx_1_1_tsv_file.html#ffe4f182dfd6c3f0057b185c5ec4b56d" title="A vector of lines which match the last "findBegin".">m_findresults</a>[<a class="code" href="classaffx_1_1_tsv_file.html#5b3d9d8e1ac6b11d4b2cd108794c2cc7" title="The postition we are at in the returned results.">m_findresults_pos</a>++]);
<a name="l03337"></a>03337 }
<a name="l03338"></a>03338 
<a name="l03339"></a>03339 
<a name="l03341"></a>03341 
<a name="l03345"></a>03345 <span class="keywordtype">int</span>
<a name="l03346"></a><a class="code" href="classaffx_1_1_tsv_file.html#31a970fb2fdda97a1fc0b1ef8f4b3ca5">03346</a> <a class="code" href="classaffx_1_1_tsv_file.html#31a970fb2fdda97a1fc0b1ef8f4b3ca5" title="Define a TSV file from a string of field names.">affx::TsvFile::defineFile</a>(std::string definition)
<a name="l03347"></a>03347 {
<a name="l03348"></a>03348   <span class="comment">// clear out the old state</span>
<a name="l03349"></a>03349   <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l03350"></a>03350   <span class="comment">// and define the new...</span>
<a name="l03351"></a>03351   <span class="keywordflow">return</span> <a class="code" href="classaffx_1_1_tsv_file.html#08f84266d65d50d915f26c056fd8da71" title="Overlay the definition on top of the current file.">defineFileParse</a>(definition);
<a name="l03352"></a>03352 }
<a name="l03353"></a>03353 
<a name="l03360"></a>03360 <span class="keywordtype">int</span>
<a name="l03361"></a><a class="code" href="classaffx_1_1_tsv_file.html#08f84266d65d50d915f26c056fd8da71">03361</a> <a class="code" href="classaffx_1_1_tsv_file.html#08f84266d65d50d915f26c056fd8da71" title="Overlay the definition on top of the current file.">affx::TsvFile::defineFileParse</a>(std::string definition)
<a name="l03362"></a>03362 {
<a name="l03363"></a>03363   std::vector&lt;std::string&gt; split_line;
<a name="l03364"></a>03364   std::vector&lt;std::string&gt; split_col;
<a name="l03365"></a>03365   std::vector&lt;std::string&gt; split_coldef;
<a name="l03366"></a>03366 
<a name="l03367"></a>03367   <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(definition,<span class="charliteral">'\n'</span>,split_line);
<a name="l03368"></a>03368   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> li=0;li&lt;split_line.size();li++) {
<a name="l03369"></a>03369     <span class="keywordflow">if</span> (split_line[li]!=<span class="stringliteral">""</span>) {
<a name="l03370"></a>03370       <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(split_line[li],<span class="charliteral">'\t'</span>,split_col);
<a name="l03371"></a>03371       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ci=0;ci&lt;split_col.size();ci++) {
<a name="l03372"></a>03372         <span class="comment">// name,options</span>
<a name="l03373"></a>03373         <a class="code" href="namespaceaffx.html#93107a366f9ac3e78e84dbbb0d858951" title="Split a string into a vector.">splitstr</a>(split_col[ci],<span class="charliteral">','</span>,split_coldef);
<a name="l03374"></a>03374         <span class="comment">//</span>
<a name="l03375"></a>03375         <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">defineColumn</a>(li,ci,split_coldef[0]);
<a name="l03376"></a>03376       }
<a name="l03377"></a>03377     }
<a name="l03378"></a>03378   }
<a name="l03379"></a>03379   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03380"></a>03380 }
<a name="l03381"></a>03381 
<a name="l03383"></a>03383 
<a name="l03386"></a>03386 <span class="keywordtype">void</span>
<a name="l03387"></a><a class="code" href="classaffx_1_1_tsv_file.html#20603c8caf898bc64559eb87827d8e71">03387</a> <a class="code" href="classaffx_1_1_tsv_file.html#20603c8caf898bc64559eb87827d8e71" title="Write a number of Field seperators to the file.">affx::TsvFile::writeFieldSep</a>(<span class="keywordtype">int</span> cnt)
<a name="l03388"></a>03388 {
<a name="l03389"></a>03389   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;cnt;i++) {
<a name="l03390"></a>03390     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>;
<a name="l03391"></a>03391   }
<a name="l03392"></a>03392 }
<a name="l03393"></a>03393 
<a name="l03397"></a>03397 <span class="keywordtype">int</span>
<a name="l03398"></a><a class="code" href="classaffx_1_1_tsv_file.html#55e3144665df17dedeefcadd28d9201b">03398</a> <a class="code" href="classaffx_1_1_tsv_file.html#55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed.">affx::TsvFile::write_str</a>(<span class="keyword">const</span> std::string&amp; str)
<a name="l03399"></a>03399 {
<a name="l03400"></a>03400   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#4dccec8a785c650f376be8702043a984" title="Put quotes on output?">m_optDoQuote</a>==<span class="keyword">true</span>) {
<a name="l03401"></a>03401     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>&lt;&lt;<a class="code" href="classaffx_1_1_tsv_file.html#8818359ce7433b2d0d9bf1cbd3850306" title="Quote char to use.">m_optQuoteChar</a>&lt;&lt;str&lt;&lt;<a class="code" href="classaffx_1_1_tsv_file.html#8818359ce7433b2d0d9bf1cbd3850306" title="Quote char to use.">m_optQuoteChar</a>;
<a name="l03402"></a>03402   } <span class="keywordflow">else</span> {
<a name="l03403"></a>03403     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>&lt;&lt;str;
<a name="l03404"></a>03404   }
<a name="l03405"></a>03405   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03406"></a>03406 }
<a name="l03407"></a>03407 
<a name="l03409"></a>03409 <span class="keywordtype">void</span>
<a name="l03410"></a><a class="code" href="classaffx_1_1_tsv_file.html#4699d53e8576189ecd26fb0f6ed5a19e">03410</a> <a class="code" href="classaffx_1_1_tsv_file.html#4699d53e8576189ecd26fb0f6ed5a19e" title="Write the keyval headers to the file.">affx::TsvFile::writeKeyValHeaders</a>()
<a name="l03411"></a>03411 {
<a name="l03412"></a>03412   <span class="keywordtype">int</span> h_size;
<a name="l03413"></a>03413   <span class="keywordtype">int</span> h_i;
<a name="l03414"></a>03414   <a class="code" href="classaffx_1_1_tsv_file_header_line.html" title="This is a key-value pair with sort order.">affx::TsvFile::header_t</a>* h_ptr;
<a name="l03415"></a>03415 
<a name="l03416"></a>03416   <span class="comment">// want to write them in order.</span>
<a name="l03417"></a>03417   <a class="code" href="classaffx_1_1_tsv_file.html#c0bb213119962d8f3ea8fc0632b9fff0" title="Sort the headers of this TSV file by (order,key,value).">resortHeaders</a>();
<a name="l03418"></a>03418 
<a name="l03419"></a>03419   h_size=(int)<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>.size();
<a name="l03420"></a>03420   <span class="keywordflow">for</span> (h_i=0;h_i&lt;h_size;h_i++) {
<a name="l03421"></a>03421     h_ptr=<a class="code" href="classaffx_1_1_tsv_file.html#94af48140e927ce7fae78c01018272bd">m_headers_vec</a>[h_i];
<a name="l03422"></a>03422     <span class="keywordflow">if</span> (h_ptr==NULL) {
<a name="l03423"></a>03423       <span class="keywordflow">continue</span>;
<a name="l03424"></a>03424     }
<a name="l03425"></a>03425     <span class="comment">// Dont output bad headers which got stuck in with "addHeader_nocheck"</span>
<a name="l03427"></a>03427 <span class="comment"></span>    <span class="comment">// a comment?</span>
<a name="l03428"></a>03428     <span class="keywordflow">if</span> (h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>==<span class="stringliteral">""</span>) {
<a name="l03429"></a>03429       <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="_tsv_file_8cpp.html#3c0e67c8dabd0e0c9bee6968768ae42c" title="Comment string.">TSV_STRING_COMMENT</a> &lt;&lt; h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#089c5efc9860fa56096672366b0afc1d" title="End of line sequence to use.">m_optEndl</a>;
<a name="l03430"></a>03430     }
<a name="l03431"></a>03431     <span class="comment">// key=value</span>
<a name="l03432"></a>03432     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#6d7fa43cb3c63790357f2be44ce1560e" title="Is the key a legal key to have in a header?">headerKeyLegal</a>(h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a>)==<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l03433"></a>03433       <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="_tsv_file_8cpp.html#01c57b92ec758290af280577d7e8ca1e" title="Meta string.">TSV_STRING_META</a> &lt;&lt; h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#13b36da3c69ba1e03ade9924001b91eb">m_key</a> &lt;&lt; <span class="stringliteral">"="</span> &lt;&lt; h_ptr-&gt;<a class="code" href="classaffx_1_1_tsv_file_header_line.html#9f8255079ec0d23c66fde4355b3f98ff">m_value</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#089c5efc9860fa56096672366b0afc1d" title="End of line sequence to use.">m_optEndl</a>;
<a name="l03434"></a>03434     }
<a name="l03435"></a>03435   }
<a name="l03436"></a>03436 }
<a name="l03437"></a>03437 
<a name="l03440"></a>03440 <span class="keywordtype">void</span>
<a name="l03441"></a><a class="code" href="classaffx_1_1_tsv_file.html#66ed73cf2b8086a68b398d71e4bccf27">03441</a> <a class="code" href="classaffx_1_1_tsv_file.html#66ed73cf2b8086a68b398d71e4bccf27" title="Write the headers for a given level.">affx::TsvFile::writeColumnHeaders_clvl</a>(<span class="keywordtype">int</span> clvl)
<a name="l03442"></a>03442 {
<a name="l03443"></a>03443   <span class="keywordtype">size_t</span> cidx_size=<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();
<a name="l03444"></a>03444   <span class="keywordtype">size_t</span> cidx_size_1=cidx_size-1;
<a name="l03445"></a>03445   <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> cidx=0;cidx&lt;cidx_size;cidx++) {
<a name="l03446"></a>03446     <a class="code" href="classaffx_1_1_tsv_file.html#55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed.">write_str</a>(<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_cname);
<a name="l03447"></a>03447     <span class="keywordflow">if</span> (cidx&lt;cidx_size_1) {
<a name="l03448"></a>03448       <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>;
<a name="l03449"></a>03449     }
<a name="l03450"></a>03450   }
<a name="l03451"></a>03451   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#089c5efc9860fa56096672366b0afc1d" title="End of line sequence to use.">m_optEndl</a>;
<a name="l03452"></a>03452 }
<a name="l03453"></a>03453 
<a name="l03455"></a>03455 <span class="keywordtype">void</span>
<a name="l03456"></a><a class="code" href="classaffx_1_1_tsv_file.html#30ca524741f32710c020c85b2a95328a">03456</a> <a class="code" href="classaffx_1_1_tsv_file.html#30ca524741f32710c020c85b2a95328a" title="Write the "headerN" lines which define the Columns.">affx::TsvFile::writeColumnHeaders</a>()
<a name="l03457"></a>03457 {
<a name="l03458"></a>03458   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clvl=0;clvl&lt;<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size();clvl++) {
<a name="l03459"></a>03459     <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <span class="stringliteral">"#%"</span> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#88a6606cf964f28ab5a24145c94ef73d" title="Tag name of column header.">m_headName</a> &lt;&lt; clvl &lt;&lt; <span class="stringliteral">"="</span>;
<a name="l03460"></a>03460     <a class="code" href="classaffx_1_1_tsv_file.html#20603c8caf898bc64559eb87827d8e71" title="Write a number of Field seperators to the file.">writeFieldSep</a>(clvl);
<a name="l03461"></a>03461     <a class="code" href="classaffx_1_1_tsv_file.html#66ed73cf2b8086a68b398d71e4bccf27" title="Write the headers for a given level.">writeColumnHeaders_clvl</a>(clvl);
<a name="l03462"></a>03462   }
<a name="l03463"></a>03463 }
<a name="l03464"></a>03464 
<a name="l03466"></a>03466 <span class="keywordtype">void</span>
<a name="l03467"></a><a class="code" href="classaffx_1_1_tsv_file.html#97ba35da4aa8431e668b4cf4f0b06696">03467</a> <a class="code" href="classaffx_1_1_tsv_file.html#97ba35da4aa8431e668b4cf4f0b06696" title="Write the file headers.">affx::TsvFile::writeHeaders</a>()
<a name="l03468"></a>03468 {
<a name="l03469"></a>03469   <a class="code" href="classaffx_1_1_tsv_file.html#4699d53e8576189ecd26fb0f6ed5a19e" title="Write the keyval headers to the file.">writeKeyValHeaders</a>();
<a name="l03470"></a>03470   <a class="code" href="classaffx_1_1_tsv_file.html#30ca524741f32710c020c85b2a95328a" title="Write the "headerN" lines which define the Columns.">writeColumnHeaders</a>();
<a name="l03471"></a>03471 }
<a name="l03472"></a>03472 
<a name="l03476"></a>03476 <span class="keywordtype">int</span>
<a name="l03477"></a><a class="code" href="classaffx_1_1_tsv_file.html#bfaafe24eb0478081d2e23b692ffa46e">03477</a> <a class="code" href="classaffx_1_1_tsv_file.html#bfaafe24eb0478081d2e23b692ffa46e" title="open the stream for writing">affx::TsvFile::writeOpen</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l03478"></a>03478 {
<a name="l03479"></a>03479   <span class="comment">// finish off the old stream</span>
<a name="l03480"></a>03480   <a class="code" href="classaffx_1_1_tsv_file.html#e7932be2156c04a562f327b53833aed7" title="Close the file.">close</a>();
<a name="l03481"></a>03481   <span class="comment">// clear the error conditions before trying the open</span>
<a name="l03482"></a>03482   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.clear();
<a name="l03483"></a>03483   <span class="comment">// start</span>
<a name="l03484"></a>03484   <a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>=filename;
<a name="l03485"></a>03485   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.open(<a class="code" href="classaffx_1_1_tsv_file.html#585ab9e007bac70829c56517f0124976" title="The filename being visited.">m_fileName</a>.c_str(),std::ios::out|std::ios::binary);
<a name="l03486"></a>03486   <span class="comment">// throw if something really bad happens.</span>
<a name="l03487"></a>03487   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.exceptions(ios_base::badbit|ios_base::failbit);
<a name="l03488"></a>03488   <span class="comment">//</span>
<a name="l03489"></a>03489   <span class="keywordflow">if</span> ((!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.is_open())||(!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good())) {
<a name="l03490"></a>03490     <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#a18784fc0de86f03a8d503509d5c4db6" title="?">m_optAbortOnError</a>)
<a name="l03491"></a>03491           <a class="code" href="class_err.html#208879400571760f92fe2e428964b34d">Err::errAbort</a>(<span class="stringliteral">"Couldn't open file: "</span> + filename + <span class="stringliteral">" to write."</span>);
<a name="l03492"></a>03492     <span class="comment">//    printf("open of '%s' failed!\n",filename.c_str());</span>
<a name="l03493"></a>03493     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l03494"></a>03494   }
<a name="l03495"></a>03495   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03496"></a>03496 }
<a name="l03497"></a>03497 
<a name="l03501"></a>03501 <span class="keywordtype">int</span>
<a name="l03502"></a><a class="code" href="classaffx_1_1_tsv_file.html#1c2c3fb972bc9027261dc85001340aff">03502</a> <a class="code" href="classaffx_1_1_tsv_file.html#1c2c3fb972bc9027261dc85001340aff" title="Set the options up for "tsv" format and write the tsv-v1 header.">affx::TsvFile::writeTsv_v1</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l03503"></a>03503 {
<a name="l03504"></a>03504   <span class="comment">// this file format only supports one level.</span>
<a name="l03505"></a>03505   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">getLevelCount</a>()!=1) {
<a name="l03506"></a>03506     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l03507"></a>03507   }
<a name="l03508"></a>03508 
<a name="l03509"></a>03509   <span class="comment">// set the personality</span>
<a name="l03510"></a>03510   <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<span class="charliteral">'\t'</span>;
<a name="l03511"></a>03511   <a class="code" href="classaffx_1_1_tsv_file.html#4dccec8a785c650f376be8702043a984" title="Put quotes on output?">m_optDoQuote</a>=<span class="keyword">false</span>;
<a name="l03512"></a>03512   <a class="code" href="classaffx_1_1_tsv_file.html#8818359ce7433b2d0d9bf1cbd3850306" title="Quote char to use.">m_optQuoteChar</a>=<span class="charliteral">'"'</span>;
<a name="l03513"></a>03513 
<a name="l03514"></a>03514   <span class="comment">//</span>
<a name="l03515"></a>03515   <span class="keywordtype">int</span> rv;
<a name="l03516"></a>03516   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#bfaafe24eb0478081d2e23b692ffa46e" title="open the stream for writing">writeOpen</a>(filename))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l03517"></a>03517     <span class="keywordflow">return</span> rv;
<a name="l03518"></a>03518   }
<a name="l03519"></a>03519 
<a name="l03520"></a>03520   <span class="comment">// dump_headers();</span>
<a name="l03521"></a>03521 
<a name="l03522"></a>03522   <a class="code" href="classaffx_1_1_tsv_file.html#4699d53e8576189ecd26fb0f6ed5a19e" title="Write the keyval headers to the file.">writeKeyValHeaders</a>();
<a name="l03523"></a>03523   <a class="code" href="classaffx_1_1_tsv_file.html#66ed73cf2b8086a68b398d71e4bccf27" title="Write the headers for a given level.">writeColumnHeaders_clvl</a>(0);
<a name="l03524"></a>03524 
<a name="l03525"></a>03525   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03526"></a>03526 }
<a name="l03527"></a>03527 
<a name="l03531"></a>03531 <span class="keywordtype">int</span>
<a name="l03532"></a><a class="code" href="classaffx_1_1_tsv_file.html#443381815413f69d7effd6321911cc60">03532</a> <a class="code" href="classaffx_1_1_tsv_file.html#443381815413f69d7effd6321911cc60" title="Set the options up for "csv" format and write the CSV header.">affx::TsvFile::writeCsv</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l03533"></a>03533 {
<a name="l03534"></a>03534   <span class="comment">// this file format only supports one level.</span>
<a name="l03535"></a>03535   <span class="keywordflow">if</span> (<a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">getLevelCount</a>()!=1) {
<a name="l03536"></a>03536     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3950b7423f80e75fcae840f9826ac9f6e85" title="The format of the file is bad.">TSV_ERR_FORMAT</a>);
<a name="l03537"></a>03537   }
<a name="l03538"></a>03538 
<a name="l03539"></a>03539   <span class="comment">// set the personality</span>
<a name="l03540"></a>03540   <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>=<span class="charliteral">','</span>;
<a name="l03541"></a>03541   <a class="code" href="classaffx_1_1_tsv_file.html#4dccec8a785c650f376be8702043a984" title="Put quotes on output?">m_optDoQuote</a>=<span class="keyword">true</span>;
<a name="l03542"></a>03542   <a class="code" href="classaffx_1_1_tsv_file.html#8818359ce7433b2d0d9bf1cbd3850306" title="Quote char to use.">m_optQuoteChar</a>=<span class="charliteral">'"'</span>;
<a name="l03543"></a>03543 
<a name="l03544"></a>03544   <span class="comment">//</span>
<a name="l03545"></a>03545   <span class="keywordtype">int</span> rv;
<a name="l03546"></a>03546   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#bfaafe24eb0478081d2e23b692ffa46e" title="open the stream for writing">writeOpen</a>(filename))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l03547"></a>03547     <span class="keywordflow">return</span> rv;
<a name="l03548"></a>03548   }
<a name="l03549"></a>03549   <span class="comment">//</span>
<a name="l03550"></a>03550   <a class="code" href="classaffx_1_1_tsv_file.html#4699d53e8576189ecd26fb0f6ed5a19e" title="Write the keyval headers to the file.">writeKeyValHeaders</a>();
<a name="l03551"></a>03551   <a class="code" href="classaffx_1_1_tsv_file.html#66ed73cf2b8086a68b398d71e4bccf27" title="Write the headers for a given level.">writeColumnHeaders_clvl</a>(0);
<a name="l03552"></a>03552 
<a name="l03553"></a>03553   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03554"></a>03554 }
<a name="l03555"></a>03555 
<a name="l03564"></a>03564 <span class="keywordtype">int</span>
<a name="l03565"></a><a class="code" href="classaffx_1_1_tsv_file.html#3e30b8af1ea63ec401dd7a6a44a6d4b3">03565</a> <a class="code" href="classaffx_1_1_tsv_file.html#3e30b8af1ea63ec401dd7a6a44a6d4b3" title="Open the file and write the headers.">affx::TsvFile::writeTsv</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l03566"></a>03566 {
<a name="l03567"></a>03567   <span class="keywordtype">int</span> rv;
<a name="l03568"></a>03568   <span class="keywordflow">if</span> ((rv=<a class="code" href="classaffx_1_1_tsv_file.html#bfaafe24eb0478081d2e23b692ffa46e" title="open the stream for writing">writeOpen</a>(filename))!=<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>) {
<a name="l03569"></a>03569     <span class="keywordflow">return</span> rv;
<a name="l03570"></a>03570   }
<a name="l03571"></a>03571 
<a name="l03572"></a>03572   <a class="code" href="classaffx_1_1_tsv_file.html#97ba35da4aa8431e668b4cf4f0b06696" title="Write the file headers.">writeHeaders</a>();
<a name="l03573"></a>03573 
<a name="l03574"></a>03574   <span class="comment">//</span>
<a name="l03575"></a>03575   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03576"></a>03576 }
<a name="l03577"></a>03577 
<a name="l03581"></a>03581 <span class="keywordtype">int</span>
<a name="l03582"></a><a class="code" href="classaffx_1_1_tsv_file.html#2a459be42bea9ea3f180773370ec0de7">03582</a> <a class="code" href="classaffx_1_1_tsv_file.html#2a459be42bea9ea3f180773370ec0de7" title="Write a level of data to the file.">affx::TsvFile::writeLevel</a>(<span class="keywordtype">int</span> clvl)
<a name="l03583"></a>03583 {
<a name="l03584"></a>03584   <span class="keywordflow">if</span> ((clvl&lt;0)||(clvl&gt;=(<span class="keywordtype">int</span>)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>.size())) {
<a name="l03585"></a>03585     <span class="comment">// no levels to be written.</span>
<a name="l03586"></a>03586     assert(0);
<a name="l03587"></a>03587     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03588"></a>03588   }
<a name="l03589"></a>03589 
<a name="l03590"></a>03590   <span class="comment">// indent for the current level</span>
<a name="l03591"></a>03591   <a class="code" href="classaffx_1_1_tsv_file.html#20603c8caf898bc64559eb87827d8e71" title="Write a number of Field seperators to the file.">writeFieldSep</a>(clvl);
<a name="l03592"></a>03592 
<a name="l03593"></a>03593   <span class="keywordtype">size_t</span> cidx_size=(int)<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl].size();
<a name="l03594"></a>03594   <span class="keywordtype">size_t</span> cidx_size_1=cidx_size-1;
<a name="l03595"></a>03595   <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> cidx=0;cidx&lt;cidx_size;cidx++) {
<a name="l03596"></a>03596     <a class="code" href="classaffx_1_1_tsv_file.html#55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed.">write_str</a>(<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_buffer);
<a name="l03597"></a>03597     <span class="keywordflow">if</span> (cidx&lt;cidx_size_1) {
<a name="l03598"></a>03598       <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#e354828ee927c3aee72d847bad8a9699" title="Field seperator defaults to TAB.">m_optFieldSep</a>;
<a name="l03599"></a>03599     }
<a name="l03600"></a>03600   }
<a name="l03601"></a>03601   <a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a> &lt;&lt; <a class="code" href="classaffx_1_1_tsv_file.html#089c5efc9860fa56096672366b0afc1d" title="End of line sequence to use.">m_optEndl</a>;
<a name="l03602"></a>03602 
<a name="l03603"></a>03603   <span class="keywordflow">if</span> (!<a class="code" href="classaffx_1_1_tsv_file.html#b1e9e5391e97174a40c28b219d41c348">m_fileStream</a>.good()) {
<a name="l03604"></a>03604     assert(0); <span class="comment">// barf for now</span>
<a name="l03605"></a>03605     <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3951688e738c6c7a6641cddfe038c3e5f80" title="Some sort of file IO error.">TSV_ERR_FILEIO</a>);
<a name="l03606"></a>03606   }
<a name="l03607"></a>03607 
<a name="l03608"></a>03608   <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03609"></a>03609 }
<a name="l03610"></a>03610 
<a name="l03613"></a>03613 <span class="keywordtype">void</span>
<a name="l03614"></a><a class="code" href="classaffx_1_1_tsv_file.html#95d83e1f73169d587e65845fcbba8c9a">03614</a> <a class="code" href="classaffx_1_1_tsv_file.html#95d83e1f73169d587e65845fcbba8c9a" title="Copy the "format" of the file.">affx::TsvFile::copyFormat</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; f_tsv)
<a name="l03615"></a>03615 {
<a name="l03616"></a>03616   <a class="code" href="classaffx_1_1_tsv_file.html#6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l03617"></a>03617   <span class="comment">//</span>
<a name="l03618"></a>03618   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> clvl=0;clvl&lt;f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">getLevelCount</a>();clvl++) {
<a name="l03619"></a>03619     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cidx=0;cidx&lt;f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(clvl);cidx++) {
<a name="l03620"></a>03620       std::string cname;
<a name="l03621"></a>03621       f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#0958f996be8dea8c5e5d2a0bac36819b" title="Get the name of a column by its level and index.">cidx2cname</a>(clvl,cidx,cname);
<a name="l03622"></a>03622       <a class="code" href="classaffx_1_1_tsv_file.html#dd620070cbd68b6623a25b1b0e74d7a6" title="User methods.">defineColumn</a>(clvl,cidx,cname);
<a name="l03623"></a>03623     }
<a name="l03624"></a>03624   }
<a name="l03625"></a>03625 }
<a name="l03626"></a>03626 
<a name="l03631"></a>03631 <span class="keywordtype">int</span>
<a name="l03632"></a><a class="code" href="classaffx_1_1_tsv_file.html#d3a2fd6c099709b3f3442a866ea656ba">03632</a> <a class="code" href="classaffx_1_1_tsv_file.html#d3a2fd6c099709b3f3442a866ea656ba" title="copy the fields from one tsv to another tsv">affx::TsvFile::copyLevel</a>(<a class="code" href="classaffx_1_1_tsv_file.html" title="A class for reading and writing Tab Seperated Value (TSV) files. See the TsvFile...">affx::TsvFile</a>&amp; f_tsv,<span class="keywordtype">int</span> clvl)
<a name="l03633"></a>03633 {
<a name="l03634"></a>03634   <span class="keywordflow">if</span> ((clvl&lt;<a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">getLevelCount</a>())&amp;&amp;(clvl&lt;f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#979bb45cfdd5754d84b8859c3c3ab102" title="The number of levels defined.">getLevelCount</a>())) {
<a name="l03635"></a>03635     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cidx=0;cidx&lt;f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level.">getColumnCount</a>(clvl);cidx++) {
<a name="l03636"></a>03636       <span class="keyword">set</span>(clvl,cidx,f_tsv.<a class="code" href="classaffx_1_1_tsv_file.html#3be19064814fd6231cd24a24d896863c" title="The columns by column level and column index.">m_column_map</a>[clvl][cidx].m_buffer);
<a name="l03637"></a>03637     }
<a name="l03638"></a>03638     <span class="keywordflow">return</span> <a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd39505b4d7241e83bd24a318f4caa49b284e" title="No Error.">TSV_OK</a>;
<a name="l03639"></a>03639   }
<a name="l03640"></a>03640   <span class="keywordflow">return</span> (<a class="code" href="namespaceaffx.html#d00847b6f358e7269f493808ee6bd3958de9b9f4b38e163987bfe315dba4c63e" title="The value was not found.">TSV_ERR_NOTFOUND</a>);
<a name="l03641"></a>03641 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 14 09:01:15 2007 for Affymetrix Fusion SDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
